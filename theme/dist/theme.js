"use strict";(()=>{var ee=1,Ye={setControlHeight(e){ee=e||1},init(){if(Spicetify.Config.extensions.includes("noControls.js")){Spicetify.showNotification("[WMPotify] Incompatible extension 'No Controls' detected! Some features of WMPotify will be disabled.");return}let e=o=>{o&&(o._updateUiClient?.updateTitlebarHeight&&o._updateUiClient.updateTitlebarHeight({height:ee}),o._updateUiClient?.setButtonsVisibility&&ee<=1&&o._updateUiClient.setButtonsVisibility(!1),window.addEventListener("beforeunload",()=>{o._updateUiClient?.setButtonsVisibility&&o._updateUiClient.setButtonsVisibility({showButtons:!0})})),Spicetify.CosmosAsync.post("sp://messages/v1/container/control",{type:"update_titlebar",height:ee+"px"})};e(Spicetify.Platform.ControlMessageAPI),e(Spicetify.Platform.UpdateAPI);async function t(){e(Spicetify.Platform.ControlMessageAPI),e(Spicetify.Platform.UpdateAPI)}let i=setInterval(t,100);setTimeout(()=>{clearInterval(i)},1e4);let n=()=>{e(Spicetify.Platform.ControlMessageAPI),e(Spicetify.Platform.UpdateAPI)};document.addEventListener("fullscreenchange",n),window.addEventListener("resize",()=>{setTimeout(()=>{n()},100)})}},z=Ye;var pe=document.createElement("canvas");pe.width=1;pe.height=1;var te=pe.getContext("2d");function Je(e,t){return te.fillStyle="#EEF3FA",te.filter=`hue-rotate(${e}deg) saturate(${t}%)`,te.fillRect(0,0,1,1),"rgba("+te.getImageData(0,0,1,1).data+")"}function X(e,t,i){if(!e&&!t){document.documentElement.style.setProperty("--spice-main","#EEF3FA"),document.documentElement.style.removeProperty("--wmpotify-tint-hue"),document.documentElement.style.removeProperty("--wmpotify-tint-sat");return}let n=document.querySelector(".main-nowPlayingBar-nowPlayingBar");n&&(i?n.classList.add("tinted"):n.classList.remove("tinted")),document.documentElement.style.setProperty("--spice-main",Je(e,t)),document.documentElement.style.setProperty("--wmpotify-tint-hue",e+"deg"),document.documentElement.style.setProperty("--wmpotify-tint-sat",t/100)}var p=null,fe=1,Ze={init(){return et()},query(){return p?p.query():null},extendFrame(e,t,i,n){p?.extendFrame&&([e,t,i,n]=[e,t,i,n].map(o=>Math.round(o*window.devicePixelRatio)),fe>1&&([e,t]=[e&&e-1,t&&t-1],[i,n]=[i&&i-1,n&&n-1]),p.extendFrame(e,t,i,n))},minimize(){p?.minimize&&p.minimize()},maximizeRestore(){p?.maximizeRestore&&p.maximizeRestore()},close(){p?.close&&p.close()},setLayered(e,t,i){p?.setLayered&&p.setLayered(e,t,i)},setBackdrop(e){p?.setBackdrop&&p.setBackdrop(e)},resizeTo(e,t){p?.resizeTo&&p.resizeTo(e,t)},setMinSize(e,t){p?.setMinSize&&([e,t]=[e,t].map(i=>Math.round(i*window.devicePixelRatio)),p.setMinSize(e,t))},setTopMost(e){p?.setTopMost&&p.setTopMost(e)},setTitle(e){p?.setTitle&&p.setTitle(e)},lockTitle(e){p?.lockTitle&&p.lockTitle(e)},openSpotifyMenu(){p?.openSpotifyMenu&&p.openSpotifyMenu()},setPlaybackSpeed(e){p?.setPlaybackSpeed&&p.setPlaybackSpeed(parseFloat(e))},available(){return!!p},getModule(){return p}};function et(){if(navigator.userAgent.includes("Windows"))try{p=window._getSpotifyModule("ctewh"),fe=p.query().dpi/96;let{version:e,initialOptions:t}=p;return console.log(`CEF/Spotify Tweaks Windhawk mod available, Version: ${e}`),window.addEventListener("resize",()=>{fe=p.query().dpi/96}),{version:e,initialOptions:t}}catch{p=null,console.log("Windhawk mod not available")}}var u=Ze;async function Ae(e){let t=u.query();switch(e){case"native":z.setControlHeight(0);break;case"custom":z.setControlHeight(0);case"keepmenu":let i=document.createElement("div");if(i.id="wmpotify-title-buttons",window.SpotEx||t){let s=document.createElement("button");s.id="wmpotify-minimize-button",s.addEventListener("click",()=>{window.SpotEx?SpotEx.updateWindow({state:"minimized"}):u.minimize()}),i.appendChild(s);let l=document.createElement("button");l.id="wmpotify-maximize-button",l.addEventListener("click",async()=>{window.SpotEx?(await SpotEx.getWindow()).state==="maximized"?SpotEx.updateWindow({state:"normal"}):SpotEx.updateWindow({state:"maximized"}):u.maximizeRestore()}),i.appendChild(l),window.addEventListener("resize",async()=>{window.SpotEx?(await SpotEx.getWindow()).state==="maximized"?l.dataset.maximized=!0:delete l.dataset.maximized:u.query().isMaximized?l.dataset.maximized=!0:delete l.dataset.maximized})}let n=document.createElement("button");n.id="wmpotify-close-button",n.addEventListener("click",()=>{Be()}),i.appendChild(n);case"spotify":let o=document.createElement("div");o.id="wmpotify-title-bar";let a=document.createElement("div");a.id="wmpotify-title-icon",a.addEventListener("dblclick",()=>{Be()}),o.appendChild(a);let r=document.createElement("span");r.id="wmpotify-title-text",r.textContent=await Spicetify.AppTitle.get(),o.appendChild(r),(e==="custom"||e==="keepmenu")&&o.appendChild(i),(e==="keepmenu"||e==="spotify")&&z.setControlHeight(25),document.body.appendChild(o),Spicetify.AppTitle.sub(s=>{r.textContent=s});break}}async function Be(){u.available()?u.close():window.close()}var H=class{constructor(t=[],i=[]){this.menuOrder=t,this.submenus=i,this.openedMenu=null,this.mouseOverMenu=!1,this.mouseOverSubmenu=!1,this.handlingPointerEvent=!1,this.handlingKeyEvent=!1,this.boundMenuNavigationHandler=this.menuNavigationHandler.bind(this),this.submenuOpenTimer=null,this.submenuCloseTimer=null,this.shouldNotCloseSubmenu=!1,this.menuHierarchy={},this.beforeMenuOpenEvent=new Event("beforemenuopen"),this.afterMenuCloseEvent=new Event("aftermenuclose");for(let n of t){this.menuHierarchy[n]=[];let o=document.getElementById(n+"MenuBg"),a=o.querySelectorAll(".contextMenuItem");for(let r of a)r.dataset.submenu&&this.menuHierarchy[n].push(r.dataset.submenu),r.addEventListener("pointerover",()=>{for(let s of a)delete s.dataset.active;r.dataset.active=!0,clearTimeout(this.submenuOpenTimer),r.dataset.submenu?this.submenuOpenTimer=setTimeout(()=>{this.openMenu(r.dataset.submenu)},300):this.menuHierarchy[n].length>0&&this.delayedCloseMenu(this.menuHierarchy[n][0])}),r.addEventListener("pointerleave",()=>{this.mouseOverSubmenu||(delete r.dataset.active,clearTimeout(this.submenuOpenTimer),r.dataset.submenu&&this.delayedCloseMenu(r.dataset.submenu))}),r.addEventListener("click",()=>{r.dataset.submenu&&!r.classList.contains("disabled")?this.openedMenu.id!==r.dataset.submenu+"MenuBg"?this.openMenu(r.dataset.submenu):document.getElementById(r.dataset.submenu+"MenuBg").focus():r.dataset.noClose||this.closeMenu(n)});o.addEventListener("focusout",r=>{top.ignoreFocusLoss||r.relatedTarget&&r.relatedTarget.dataset.submenuOf===n||this.closeMenu(n)}),o.addEventListener("pointermove",r=>{(r.clientX>0||r.clientY>0)&&(o.style.animation="none")})}for(let n of i){let o=document.getElementById(n+"MenuBg"),a=o.querySelectorAll(".contextMenuItem"),r=document.getElementById(o.dataset.submenuOf+"MenuBg"),s=Array.from(r.querySelectorAll(".contextMenuItem")).findIndex(c=>c.dataset.submenu===n),l=r.querySelectorAll(".contextMenuItem")[s];for(let c of a)c.addEventListener("pointerover",()=>{for(let d of a)delete d.dataset.active;c.dataset.active=!0}),c.addEventListener("pointerleave",()=>{delete c.dataset.active}),c.addEventListener("click",()=>{this.shouldNotCloseSubmenu=!1,this.closeMenu(n),this.closeMenu(o.dataset.submenuOf)});o.addEventListener("pointerover",()=>{this.mouseOverMenu=!0,this.mouseOverSubmenu=!0,this.shouldNotCloseSubmenu=!0,clearTimeout(this.submenuCloseTimer),l.dataset.active=!0}),o.addEventListener("pointerleave",()=>{this.mouseOverMenu=!1,this.mouseOverSubmenu=!1,this.shouldNotCloseSubmenu=!1}),o.addEventListener("focusout",c=>{if(top.ignoreFocusLoss||o.style.display==="none")return;this.shouldNotCloseSubmenu=!1;let d=!!o.dataset.openStandalone;c.relatedTarget&&c.relatedTarget.id&&c.relatedTarget.id===r.id||(this.closeMenu(n),!(c.relatedTarget&&c.relatedTarget.id&&c.relatedTarget.dataset.submenuOf===o.dataset.submenuOf)&&(d||this.closeMenu(o.dataset.submenuOf)))})}}openMenu(t,i){let n=document.getElementById(t+"MenuBg"),o=document.getElementById(t+"Menu"),a=!!n.dataset.submenuOf,r,s,l,c=n.querySelectorAll(".contextMenuItem.debug");if(localStorage.wmpotifyDebugMode){l=n.querySelectorAll(".contextMenuItem:not([data-hidden])");for(let m of c)m.style.display=""}else{l=n.querySelectorAll(".contextMenuItem:not([data-hidden]):not(.debug)");for(let m of c)m.style.display="none"}if(n.dispatchEvent(this.beforeMenuOpenEvent),i)n.dataset.openStandalone=!0;else{if(a){if(this.menuHierarchy[n.dataset.submenuOf].length>1)for(let b of this.menuHierarchy[n.dataset.submenuOf])b!==t&&this.closeMenu(b);if(r=document.getElementById(n.dataset.submenuOf+"MenuBg"),r.style.display==="none")return;let m=Array.from(r.querySelectorAll(".contextMenuItem")).findIndex(b=>b.dataset.submenu===t);if(s=r.querySelectorAll(".contextMenuItem")[m],s.classList.contains("disabled"))return}else for(let m of this.menuOrder)m!==t&&document.getElementById(m+"MenuBg").style.display==="block"&&this.closeMenu(m);delete n.dataset.openStandalone}n.style.animation="";for(let m of l)delete m.dataset.active;if(i)i.top&&(n.style.top=i.top),i.left&&(n.style.left=i.left),i.right&&(n.style.right=i.right),i.bottom&&(n.style.bottom=i.bottom);else{let m="",b=0;a&&(m=r.offsetTop+s.offsetTop,b=r.offsetLeft+r.offsetWidth-6),n.style.top=m+"px",n.style.left=b+"px"}n.style.display="block";let d=this.calcMenuWidth(t);n.style.width=d+")",n.style.minWidth=0,o.style.width=d+" - 2px)",n.style.height=this.calcMenuHeight(t)+"px",i||a&&(s.dataset.active=!0),n.focus(),this.openedMenu=n,document.addEventListener("keydown",this.boundMenuNavigationHandler)}closeMenu(t){let i=document.getElementById(t+"MenuBg"),n=!!i.dataset.openStandalone,o=!!i.dataset.submenuOf&&!n;if(o&&this.shouldNotCloseSubmenu)return;let a,r;if(!n&&o){a=document.getElementById(i.dataset.submenuOf+"MenuBg");let s=Array.from(a.querySelectorAll(".contextMenuItem")).findIndex(l=>l.dataset.submenu===t);r=a.querySelectorAll(".contextMenuItem")[s]}this.submenuCloseTimer&&clearTimeout(this.submenuCloseTimer),i.style.display="none",n?delete i.dataset.openStandalone:o&&delete r.dataset.active,i.dispatchEvent(this.afterMenuCloseEvent),o&&a.style.display!=="none"?(a.focus(),this.openedMenu=a):(this.openedMenu=null,document.removeEventListener("keydown",this.boundMenuNavigationHandler))}delayedCloseMenu(t){this.submenuCloseTimer=setTimeout(()=>{this.closeMenu(t)},300)}menuNavigationHandler(t){if(!this.openedMenu)return;let i;localStorage.wmpotifyDebugMode?i=this.openedMenu.querySelectorAll(".contextMenuItem"):i=this.openedMenu.querySelectorAll(".contextMenuItem:not(.debug)");let n=this.openedMenu.querySelector(".contextMenuItem[data-active]"),o=Array.from(i).indexOf(n),a;switch(this.openedMenu.dataset.submenuOf&&(a=document.getElementById(this.openedMenu.dataset.submenuOf+"MenuBg").querySelector(".contextMenuItem[data-active]")),this.handlingKeyEvent=!0,this.openedMenu.style.animation="none",t.key){case"Escape":this.mouseOverMenu=!1,this.openedMenu.blur();break;case"ArrowUp":n?(delete n.dataset.active,o>0?i[o-1].dataset.active=!0:i[i.length-1].dataset.active=!0):i[i.length-1].dataset.active=!0;break;case"ArrowDown":n?(delete n.dataset.active,o<i.length-1?i[o+1].dataset.active=!0:i[0].dataset.active=!0):i[0].dataset.active=!0;break;case"ArrowLeft":if(this.openedMenu.dataset.submenuOf){this.closeMenu(this.openedMenu.id.slice(0,-6),!0),a.dataset.active=!0;break}if(this.menuOrder.length===1)break;let r=this.menuOrder[(this.menuOrder.indexOf(this.openedMenu.id.slice(0,-6))+this.menuOrder.length-1)%this.menuOrder.length];this.closeMenu(this.openedMenu.id.slice(0,-6)),this.openMenu(r),this.openedMenu.querySelector(".contextMenuItem").dataset.active=!0;break;case"ArrowRight":if(n&&n.dataset.submenu){this.openMenu(n.dataset.submenu),this.openedMenu.querySelector(".contextMenuItem").dataset.active=!0;break}if(this.menuOrder.length===1)break;let s;this.openedMenu.dataset.submenuOf?(s=this.menuOrder[(this.menuOrder.indexOf(this.openedMenu.dataset.submenuOf)+1)%this.menuOrder.length],this.closeMenu(this.openedMenu.id.slice(0,-6))):(s=this.menuOrder[(this.menuOrder.indexOf(this.openedMenu.id.slice(0,-6))+1)%this.menuOrder.length],this.closeMenu(this.openedMenu.id.slice(0,-6))),this.openMenu(s),this.openedMenu.querySelector(".contextMenuItem").dataset.active=!0;break;case"Enter":if(n)n.click();else{this.openedMenu.blur();break}break;default:let l=this.openedMenu.getElementsByTagName("u");for(let c of l)if(t.key===c.textContent.toLowerCase()){c.parentElement.click();break}}this.handlingKeyEvent=!1,t.preventDefault(),t.stopPropagation()}calcMenuWidth(t){let i=document.getElementById(t+"MenuBg"),n;localStorage.wmpotifyDebugMode?n=i.querySelectorAll(".contextMenuItem:not([data-hidden])"):n=i.querySelectorAll(".contextMenuItem:not([data-hidden]):not(.debug)"),i.style.minWidth="";let o=parseInt(getComputedStyle(i).minWidth)||0;return`calc(${Array.from(n).reduce((r,s)=>{let l=s.textContent,c=ye(l);return Math.max(o,r,c)},0)}px + 4.5em`}calcMenuHeight(t){let i=document.getElementById(t+"MenuBg"),n=i.querySelectorAll("hr"),o;localStorage.wmpotifyDebugMode?o=i.querySelectorAll(".contextMenuItem:not([data-hidden])"):o=i.querySelectorAll(".contextMenuItem:not([data-hidden]):not(.debug)");let a=o[0].offsetHeight,r=0;if(n.length>0){let l=getComputedStyle(n[0]);r=n[0].offsetHeight+parseFloat(l.marginTop)+parseFloat(l.marginBottom)}return parseInt(o.length*a+n.length*r)}};function ne(e,t,i){let n=document.createElement("div");return n.id=e+"MenuBg",n.className="contextMenuBg",n.tabIndex=-1,n.style.display="none",n.innerHTML=`<div id="${e}Menu" class="contextMenu"></div>`,i&&(n.dataset.submenuOf=i),t.forEach(o=>{if(o.hr){let r=document.createElement("hr");n.querySelector(".contextMenu").appendChild(r);return}let a=document.createElement("div");a.className="contextMenuItem",o.args?a.innerHTML="<p>"+Oe(o.text,...o.args)+"</p>":a.innerHTML="<p>"+Oe(o.text)+"</p>",o.classList&&a.classList.add(...o.classList),o.disabled&&a.classList.add("disabled"),o.hidden&&(a.dataset.hidden=!0),o.submenu&&(a.dataset.submenu=o.submenu,a.innerHTML+='<p class="submenuMark">\u23F5</p>'),o.noClose&&(a.dataset.noClose=!0),a.addEventListener("click",o.click),n.querySelector(".contextMenu").appendChild(a)}),document.body.appendChild(n),{menuBg:n,menu:n.querySelector(".contextMenu"),menuItems:n.querySelectorAll(".contextMenuItem")}}function ye(e,t=getComputedStyle(document.documentElement).getPropertyValue("--menu-font")){let n=(ye.canvas||(ye.canvas=document.createElement("canvas"))).getContext("2d");return n.font=t,n.measureText(e).width}function Oe(e){if(e=e.replace(/&([^&])/g,"<u>$1</u>").replace(/\\&/g,"&"),arguments.length>1)for(let t=1;t<arguments.length;t++)e=e.replace(/%s/,arguments[t]),e=e.replace(`%${t}s`,arguments[t]);return e}var tt={getItem(e){let t=Spicetify._platform?.initialUser?.username,i=localStorage.getItem(t+":"+e);return isNaN(i)?i:parseFloat(i)},setItem(e,t){let i=Spicetify._platform?.initialUser?.username;localStorage.setItem(i+":"+e,t)},removeItem(e){let t=Spicetify._platform?.initialUser?.username;localStorage.removeItem(t+":"+e)}},k=tt;var A,T=[],N,nt={"Friend Activity":"Friends"};function _e(){let e=document.querySelector(".Root__globalNav");A=document.createElement("div"),A.id="wmpotify-tabs-container",e.insertBefore(A,e.querySelector(".main-globalNav-searchSection"));let t=document.querySelector('.custom-navlinks-scrollable_container div[role="presentation"] > button[aria-label="Now Playing"]');t||(t=document.createElement("button"),t.setAttribute("aria-label","Now Playing"),t.addEventListener("click",()=>{window.open("https://github.com/Ingan121/WMPotify/tree/master/CustomApps/wmpvis"),Spicetify.showNotification("Please install this!")})),t.dataset.identifier="now-playing",F(t);let i=document.querySelector(".main-globalNav-searchContainer > button");i.dataset.identifier="home",F(i);let n=document.querySelector(".main-globalNav-searchContainer div form button");n.dataset.identifier="search",n.addEventListener("click",h=>{window.open("spotify:search"),h.preventDefault(),h.stopPropagation()}),F(n);let o=document.createElement("button");o.id="wmpotify-library-button",o.dataset.identifier="library",o.setAttribute("aria-label","Library"),o.addEventListener("click",()=>{Spicetify.Platform.History.push({pathname:"/wmpotify-standalone-libx"})}),F(o),T=[t,i,n,o];let a=document.querySelectorAll('.custom-navlinks-scrollable_container div[role="presentation"] > button');for(let h of a)F(h),T.push(h);let r=document.querySelectorAll(".main-topBar-topbarContentRight > .main-actionButtons > button");for(let h of r)F(h),T.push(h);let s=[];for(let h of T)s.push({text:h.querySelector(".wmpotify-tab-label").textContent,click:()=>h.click()});ne("wmpotifyTab",s);let l=new H(["wmpotifyTab"]);N=document.createElement("button"),N.id="wmpotify-tabs-overflow-button",N.addEventListener("click",()=>{l.openMenu("wmpotifyTab",{top:"0",left:N.getBoundingClientRect().left+"px"})}),A.appendChild(N),ie(),setTimeout(ie,1e3),window.addEventListener("resize",ie),document.addEventListener("fullscreenchange",ie);let c=document.querySelector(".main-topBar-topbarContentRight > button:last-child"),d=document.createElement("span");d.textContent=c.getAttribute("aria-label"),d.classList.add("wmpotify-user-label"),c.appendChild(d);let m=document.createElement("div");m.id="wmpotify-search-container";let b=document.createElement("div");b.id="wmpotify-search-wrapper";let P=document.querySelector('.main-globalNav-searchContainer div form input[type="search"]');b.appendChild(P);let q=document.createElement("button");q.id="wmpotify-search-clear-button",q.setAttribute("aria-label","Clear search"),q.addEventListener("click",()=>{P.value="",P.focus(),window.open("spotify:search")}),b.appendChild(q),m.appendChild(b),e.appendChild(m),e.addEventListener("pointerdown",h=>{h.button===2&&!h.target.closest("input")&&u.openSpotifyMenu()});let w=getComputedStyle(document.documentElement).getPropertyValue("--right-sidebar-width");w&&document.documentElement.style.setProperty("--panel-width",w)}function F(e){A.appendChild(e);let t=document.createElement("span"),i=e.getAttribute("aria-label");t.textContent=nt[i]||i,t.classList.add("wmpotify-tab-label"),e.appendChild(t)}function ie(){let e=document.querySelector(".main-globalNav-historyButtons").getBoundingClientRect().right,t=window.innerWidth-document.querySelector(".main-topBar-topbarContentRight").getBoundingClientRect().left,i=160,n=0;for(;window.innerWidth-e-t-i<A.getBoundingClientRect().width&&n<T.length;)T[T.length-1-n++].dataset.hidden=!0;for(n=document.querySelectorAll("#wmpotify-tabs-container button[data-hidden]").length;n>0&&window.innerWidth-e-t-i>A.getBoundingClientRect().width;)delete T[T.length-n--].dataset.hidden;N.style.display=n>0?"block":""}function oe(e,t){if(!e||isNaN(e))return"00:00";let i=Math.floor(e/1e3),n=Math.floor(i/60);if(i=String(i%60).padStart(2,"0"),n<60)return t&&(n=String(n).padStart(2,"0")),`${n}:${i}`;let o=Math.floor(n/60);return n=String(n%60).padStart(2,"0"),t&&(o=String(o).padStart(2,"0")),`${o}:${n}:${i}`}var be,V,he,ae,O,S,We=null,ze=null,U=!1;function Re(){let e=document.querySelector(".main-nowPlayingBar-nowPlayingBar");be=document.querySelector(".player-controls__buttons button[data-testid='control-button-playpause']"),Spicetify.Player.addEventListener("onplaypause",$),new MutationObserver($).observe(be,{attributes:!0,attributeFilter:["aria-label"]}),He(),new MutationObserver(He).observe(document.querySelector(".main-nowPlayingBar-left"),{childList:!0});let t=document.querySelector(".player-controls__left"),i=document.querySelector('.player-controls__buttons button[data-testid="control-button-skip-back"]'),n=document.querySelector('.player-controls__buttons button[data-testid="control-button-skip-forward"]'),o=document.querySelector('.player-controls__buttons button[data-testid="control-button-repeat"]');t.appendChild(o);let a=u.query();a?.speedModSupported&&a.immediateSpeedChange&&(n.addEventListener("pointerdown",()=>{n.disabled||Spicetify.Platform.ConnectAPI.state.connectionStatus==="connected"||(We=setTimeout(()=>{n.dataset.fastForward=!0,u.setPlaybackSpeed(5),Spicetify.Player.play()},1e3))}),n.addEventListener("click",E=>{clearTimeout(We),n.dataset.fastForward&&(delete n.dataset.fastForward,u.setPlaybackSpeed(1),E.preventDefault(),E.stopPropagation())}));let r=document.createElement("button");r.setAttribute("aria-label","Stop"),r.id="wmpotify-stop-button",r.addEventListener("click",()=>{Spicetify.Platform.PlayerAPI.clearQueue(),Spicetify.Player.playUri("")}),t.insertBefore(r,i);let s=document.querySelector(".player-controls__right"),l=document.querySelector(".volume-bar");V=l.querySelector(".volume-bar__icon-button"),he=l.querySelector(".progress-bar"),Fe(),new MutationObserver(Fe).observe(he,{attributes:!0,attributeFilter:["style"]}),s.appendChild(l);let c=document.querySelector(".volume-bar__slider-container"),d=c.children[0];c.addEventListener("click",()=>{if(window.innerWidth<750){d.dataset.visible=!0;let E=setTimeout(()=>{delete d.dataset.visible},5e3);d.addEventListener("pointerup",()=>{clearTimeout(E),setTimeout(()=>{delete d.dataset.visible},100)},{once:!0})}}),ae=document.querySelectorAll(".playback-bar .encore-text");let m=document.createElement("div");m.classList.add("wmpotify-time-text-container"),S=document.createElement("span"),S.classList.add("wmpotify-time-text"),O=parseInt(localStorage.wmpotifyTimeTextMode||0),Ne(),S.dataset.mode=O,S.addEventListener("click",()=>{O=(O+1)%3,S.dataset.mode=O,localStorage.wmpotifyTimeTextMode=O}),m.appendChild(S),e.insertAdjacentElement("afterbegin",m),Spicetify.Player.addEventListener("onprogress",Ne);let b=document.querySelector("#wmpotify-title-bar"),P=document.querySelector("#wmpotify-title-buttons");if(b&&(w(),window.addEventListener("resize",w)),a){let E=document.querySelector('.main-nowPlayingBar-extraControls button[data-testid="pip-toggle-button"]');E&&E.addEventListener("click",Ie=>{if(window.innerWidth<360&&window.innerHeight<262){let Z=localStorage.wmpotifyPreMiniModeSize?.split(",");Z&&Z.length===2&&window.resizeTo(parseInt(Z[0]),parseInt(Z[1]))}else document.fullscreenElement&&document.exitFullscreen(),localStorage.wmpotifyPreMiniModeSize=[window.innerWidth,window.innerHeight],u.resizeTo(358,60);Ie.preventDefault(),Ie.stopPropagation()})}let q=document.querySelector('.main-nowPlayingBar-extraControls button[data-testid="fullscreen-mode-button"]');q&&q.addEventListener("click",E=>{document.fullscreenElement?(document.exitFullscreen(),J()):(Spicetify.Config.custom_apps.includes("wmpvis")?Spicetify.Platform.History.push("/wmpvis"):lyricsButton&&lyricsButton.click(),document.documentElement.requestFullscreen(),document.body.classList.add("wmpotify-playerbar-visible"),setTimeout(()=>{document.addEventListener("pointermove",h),h()},200)),document.addEventListener("fullscreenchange",()=>{document.fullscreenElement||J()},{once:!0}),document.addEventListener("resize",()=>{J()},{once:!0}),E.preventDefault(),E.stopPropagation()});function w(){window.innerWidth<750?b.contains(S)||(P?b.insertBefore(S,P):b.appendChild(S)):e.contains(S)||m.appendChild(S)}function h(){if(!document.fullscreenElement){J();return}document.body.classList.add("wmpotify-playerbar-visible"),clearTimeout(ze),ze=setTimeout(()=>{document.body.classList.remove("wmpotify-playerbar-visible")},2e3)}function J(){document.body.classList.remove("wmpotify-playerbar-visible"),document.removeEventListener("pointermove",h)}}async function He(){$();let e=!!document.querySelector("#wmpotify-title-bar"),t=u.available(),i=await Spicetify.AppTitle.get(),n=document.querySelector("#wmpotify-title-text"),o=document.querySelector(".main-nowPlayingWidget-trackInfo");if(!o||document.querySelector(".wmpotify-track-info"))return;let a=document.createElement("p");a.classList.add("wmpotify-track-info"),a.textContent=document.querySelector(".main-trackInfo-name")?.textContent||"",o.appendChild(a),window.innerWidth<420&&window.innerHeight<(e?92:62)&&(e?n.textContent=a.textContent:t&&u.setTitle(a.textContent),U=!0);let r=1;setInterval(()=>{if(!Spicetify.Player.isPlaying())return;let s=Spicetify.Player.data?.item.metadata;s&&(r===0?a.textContent=s.title:r===1?a.textContent=s.artist_name:r===2&&(a.textContent=s.album_title),r=(r+1)%3,window.innerWidth<420&&window.innerHeight<(e?92:62)?(e?n.textContent=a.textContent:t&&(u.lockTitle(!0),u.setTitle(a.textContent)),U=!0):U&&(U=!1,e&&(n.textContent=i),u.lockTitle(!1),Spicetify.Player.isPlaying()?u.setTitle(s.artist_name+" - "+s.title):u.setTitle(i)))},3e3),Spicetify.Player.addEventListener("songchange",()=>{r=0,a.textContent=Spicetify.Player.data?.item.metadata.title,window.innerWidth<420&&window.innerHeight<(e?92:62)&&(e?n.textContent=a.textContent:t&&u.setTitle(a.textContent),U=!0)})}function $(){be?.classList.toggle("playing",Spicetify.Player.isPlaying());let e=document.querySelector(`.playlist-playlist-playlist[data-test-uri="${Spicetify.Player.data?.context?.uri}"]`);e&&e.classList.toggle("playing",Spicetify.Player.isPlaying())}function Fe(){let e=getComputedStyle(he).getPropertyValue("--progress-bar-transform").replace("%","")/100;e===0?V.dataset.vol="muted":e<=.3?V.dataset.vol="low":e<=.6?V.dataset.vol="mid":V.dataset.vol="high"}function Ne(){switch(O){case 0:{let e=Spicetify.Player.data?.item?.metadata?.duration-Spicetify.Player.getProgress();S.textContent=oe(e,!0)}break;case 1:{let e=ae[0].textContent;(e.length===4||e.length===7)&&(e="0"+e),S.textContent=e}break;case 2:{let e=ae[0].textContent;(e.length===4||e.length===7)&&(e="0"+e);let t=ae[1].textContent;(t.length===4||t.length===7)&&(t="0"+t),S.textContent=`${e} / ${t}`}break}}var f=document.createElement("div"),I=null,we=0,re=null,y={title:null,hue:null,sat:null};function it(){if(document.getElementById("wmpotify-config"))return;let e=document.querySelector(".Root__main-view");if(f.id="wmpotify-config",f.innerHTML=`
        <div id="wmpotify-config-topborder" class="wmpotify-tintable"></div>
        <button id="wmpotify-config-prev"></button>
        <button id="wmpotify-config-next"></button>
        <p id="wmpotify-config-title">Color Chooser</p>
        <button id="wmpotify-config-close"></button>
        <section class="wmpotify-config-tab-content" data-tab-title="Color Chooser" style="display: block;">
            <a href="#" id="wmpotify-config-color-reset">Reset</a><br>
            <label>Hue</label><br>
            <input type="range" id="wmpotify-config-hue" class="wmpotify-aero no-track" min="0" max="360" step="1" value="180"><br>
            <label>Saturation</label><br>
            <input type="range" id="wmpotify-config-sat" class="wmpotify-aero no-track" min="0" max="354" step="1" value="121"><br>
            <input type="checkbox" id="wmpotify-config-tint-playerbar" class="wmpotify-aero">
            <label for="wmpotify-config-tint-playerbar">Apply color to the now playing bar buttons</label>
        </section>
        <section class="wmpotify-config-tab-content" data-tab-title="General">
            <label for="wmpotify-config-style">Style</label>
            <select id="wmpotify-config-style" class="wmpotify-aero">
                <option value="auto">Auto</option>
                <option value="xp">XP</option>
                <option value="aero">Aero</option>
                <option value="basic">Basic</option>
            </select><br>
            <label for="wmpotify-config-title-style">Title style</label>
            <select id="wmpotify-config-title-style" class="wmpotify-aero">
                <option value="auto">Auto</option>
                <option value="native">Native</option>
                <option value="custom">Custom</option>
                <option value="spotify">Spotify</option>
                <option value="keepmenu">Keep Menu</option>
            </select><br>
            <input type="checkbox" id="wmpotify-config-show-libx" class="wmpotify-aero">
            <label for="wmpotify-config-show-libx">Show Your Library X on the left sidebar</label><br>
            <button id="wmpotify-config-apply" class="wmpotify-aero">Apply</button>
        </section>
        <section class="wmpotify-config-tab-content" data-tab-title="Play speed settings" data-wh-speedmod-required="true">
            <a href="#" id="wmpotify-config-speed-slow">Slow</a>
            <a href="#" id="wmpotify-config-speed-normal">Normal</a>
            <a href="#" id="wmpotify-config-speed-fast">Fast</a><br>
            <input type="range" id="wmpotify-config-speed" class="wmpotify-aero" min="0.5" max="2.0" step="0.1" value="1"><br>
            Play speed: <span id="wmpotify-config-speed-value">1.0</span>
        </section>
        <section class="wmpotify-config-tab-content" data-tab-title="About">
            <div id="wmpotify-about-logo"></div>
            <p id="wmpotify-about-title">WMPotify</p><br>
            <p>A Windows Media Player 11 inspired Spicetify theme for Spotify</p>
            <p>Version: Pre-alpha</p>
            <p>Made by Ingan121 - <a href="https://www.ingan121.com/" target="_blank">www.ingan121.com</a></p>
            <a href="https://github.com/Ingan121/WMPotify" target="_blank">GitHub</a>
        </section>
    `,f.querySelector("#wmpotify-config-close").addEventListener("click",Se),f.querySelector("#wmpotify-config-apply").addEventListener("click",Ue),!u.query()?.speedModSupported)f.querySelector("[data-wh-speedmod-required=true]").remove();else{y.speed=f.querySelector("#wmpotify-config-speed"),y.speedValue=f.querySelector("#wmpotify-config-speed-value"),y.speed.addEventListener("pointerup",rt),f.querySelector("#wmpotify-config-speed-slow").addEventListener("click",j.bind(null,.5)),f.querySelector("#wmpotify-config-speed-normal").addEventListener("click",j.bind(null,1)),f.querySelector("#wmpotify-config-speed-fast").addEventListener("click",j.bind(null,1.4));let i=u.query()?.playbackSpeed||1;y.speedValue.textContent=Number.isInteger(i)?i+".0":i,y.speedValue.addEventListener("click",()=>{j(parseFloat(prompt("Enter a playback speed (0.5 - 5.0)",i)))})}I=f.querySelectorAll(".wmpotify-config-tab-content"),y.title=f.querySelector("#wmpotify-config-title"),y.hue=f.querySelector("#wmpotify-config-hue"),y.sat=f.querySelector("#wmpotify-config-sat"),y.tintPb=f.querySelector("#wmpotify-config-tint-playerbar"),y.hue.addEventListener("input",ge),y.sat.addEventListener("input",ge),y.tintPb.addEventListener("change",ge),f.querySelector("#wmpotify-config-color-reset").addEventListener("click",at),f.querySelector("#wmpotify-config-prev").addEventListener("click",De),f.querySelector("#wmpotify-config-next").addEventListener("click",Xe),localStorage.wmpotifyStyle&&(f.querySelector("#wmpotify-config-style").value=localStorage.wmpotifyStyle);let t=f.querySelector("#wmpotify-config-title-style");navigator.userAgent.includes("Windows")||t.querySelector("option[value=keepmenu]").remove(),navigator.userAgent.includes("Linux")&&t.querySelector("option[value=spotify]").remove(),localStorage.wmpotifyTitleStyle&&(t.value=localStorage.wmpotifyTitleStyle),localStorage.wmpotifyShowLibX&&(f.querySelector("#wmpotify-config-show-libx").checked=!0),e.appendChild(f)}function ot(){if(I){if(document.body.dataset.wmpotifyLibPageOpen)Spicetify.Config.custom_apps.includes("wmpvis")?document.querySelector("#wmpotify-tabs-container button[data-identifier='now-playing']")?.click():document.querySelector("#wmpotify-tabs-container button[data-identifier='home']")?.click();else if(f.style.display==="block"){Se();return}if(f.style.display="block",localStorage.wmpotifyTintColor){let[e,t,i]=localStorage.wmpotifyTintColor.split(",");y.hue.value=parseInt(e)+180,y.sat.value=parseInt(t)*121/100,i&&(y.tintPb.checked=!0)}}}function Se(){f.style.display="none"}function ve(e){if(I){for(let t=0;t<I.length;t++){let i=I[t];i.style.display=t===e?"block":"none"}we=e,y.title.textContent=I[e].dataset.tabTitle}}function De(){ve((we-1+I.length)%I.length)}function Xe(){ve((we+1)%I.length)}function ge(){let e=y.hue.value-180,t=y.sat.value*100/121;X(e,t,y.tintPb.checked),localStorage.wmpotifyTintColor=e+","+t+","+(y.tintPb.checked?"1":"")}function at(){y.hue.value=180,y.sat.value=121,X(),delete localStorage.wmpotifyTintColor}function rt(){y.speedValue.textContent=Number.isInteger(parseFloat(y.speed.value))?y.speed.value+".0":y.speed.value,re&&clearTimeout(re),re=setTimeout(()=>{j(y.speed.value),re=null},500)}function j(e){if(Spicetify.Platform.ConnectAPI.state.connectionStatus==="connected"){Spicetify.showNotification("Cannot change playback speed while playing from another device");return}e=parseFloat(e);let t=u.query().playbackSpeed||1;e!==t&&(y.speed.value=e,y.speedValue.textContent=Number.isInteger(e)?e+".0":e,u.setPlaybackSpeed(e))}function Ue(){let e=f.querySelector("#wmpotify-config-style").value,t=f.querySelector("#wmpotify-config-title-style").value,i=f.querySelector("#wmpotify-config-show-libx").checked;e!=="auto"?localStorage.wmpotifyStyle=e:delete localStorage.wmpotifyStyle,t!=="auto"?localStorage.wmpotifyTitleStyle=t:delete localStorage.wmpotifyTitleStyle,i?localStorage.wmpotifyShowLibX=!0:delete localStorage.wmpotifyShowLibX,location.reload()}var st={init:it,open:ot,close:Se,openTab:ve,prevTab:De,nextTab:Xe,apply:Ue,isOpen:()=>f.style.display==="block"},xe=st;var Q=new MutationObserver(K),lt=new ResizeObserver(K.bind(null,!0)),ct={init(){Q.observe(document.documentElement,{attributes:!0,attributeFilter:["style"]}),lt.observe(document.querySelector(".Root__right-sidebar")),window.addEventListener("resize",K),window.addEventListener("load",K)},updateSidebarWidth:K};function K(e){if(!Spicetify.Platform.History.location.pathname.startsWith("/wmpotify-standalone-libx")&&!e){let n=getComputedStyle(document.documentElement).getPropertyValue("--right-sidebar-width");n&&(Q.disconnect(),document.documentElement.style.setProperty("--panel-width",n),Q.observe(document.documentElement,{attributes:!0,attributeFilter:["style"]}));return}Q.disconnect();let t=document.querySelector(".Root__right-sidebar aside");document.documentElement.style.setProperty("--panel-width",t?t.offsetWidth:8),getComputedStyle(document.documentElement).getPropertyValue("--right-sidebar-width")&&document.documentElement.style.setProperty("--right-sidebar-width",t?t.offsetWidth:8),Q.observe(document.documentElement,{attributes:!0,attributeFilter:["style"]})}var se=ct;var Ce;function le(){console.log("WMPotify: Trying to initialize queue panel");let e=document.querySelector(".Root__right-sidebar > div > div > div:has(aside)");if(e&&!Ce&&(Ce=new MutationObserver(le),Ce.observe(e,{childList:!0})),!document.querySelector("#queue-panel")||document.querySelector("#wmpotify-queue-toolbar")||document.querySelectorAll('div[data-encore-id="tabPanel"]').length>2)return;let t=document.querySelector("#Desktop_PanelContainer_Id");t.classList.add("spotify-queue-panel");let i=document.querySelector("#Desktop_PanelContainer_Id > div > div:first-child > div:first-child"),n=document.querySelector("#Desktop_PanelContainer_Id > div > div:nth-child(2)");n.id="spotify-queue-panel-content";let o=document.createElement("div");o.id="wmpotify-queue-toolbar";let a=document.createElement("button");a.id="wmpotify-queue-playlist-button",a.classList.add("wmpotify-toolbar-button"),a.addEventListener("click",()=>{let w=Spicetify.Player.data?.context?.uri;w&&window.open(w)}),a.textContent=document.querySelector('#queue-panel div[data-flip-id*="section-header-"] a')?.textContent||"Now Playing",a.innerHTML+='<span class="expandMark">\u23F7</span>',o.appendChild(a);let r=document.createElement("button");r.id="wmpotify-queue-clear-button",r.classList.add("wmpotify-toolbar-button"),r.addEventListener("click",()=>{Spicetify.Platform.PlayerAPI.clearQueue(),Spicetify.Player.playUri("")}),o.appendChild(r),n.insertAdjacentElement("afterbegin",o);let s=getComputedStyle(document.documentElement).getPropertyValue("--album-art-placeholder").trim().slice(5,-2),l=document.createElement("div");l.id="wmpotify-queue-npv";let c=document.createElement("img");c.id="wmpotify-queue-album-art",c.src=document.querySelector(".main-nowPlayingWidget-coverArt .cover-art img")?.src||s,l.appendChild(c);let d=document.createElement("div");d.id="wmpotify-queue-song-title",d.textContent=document.querySelector(".main-trackInfo-name")?.textContent||"No items",l.appendChild(d),i.insertAdjacentElement("afterbegin",l),Ve(),new MutationObserver(Ve).observe(document.querySelector("#queue-panel"),{childList:!0});let m=document.querySelectorAll('#Desktop_PanelContainer_Id div[role="tablist"] button'),b=[],P;for(let w of m)b.push({text:w.textContent,click:function(){for(let h of P.menuItems)h.classList.remove("activeStyle");this.classList.add("activeStyle"),w.click()}});b[0].classList=["activeStyle"],document.querySelector("#wmpotifyQueueTabMenuBg")?.remove(),P=ne("wmpotifyQueueTab",b);let q=new H(["wmpotifyQueueTab"]);t.addEventListener("contextmenu",w=>{w.preventDefault(),q.openMenu("wmpotifyQueueTab",{left:w.clientX+"px",top:w.clientY+"px"})}),Spicetify.Player.addEventListener("songchange",()=>{a.textContent=Spicetify.Player.data?.context?.metadata?.context_description||"Now Playing",a.innerHTML+='<span class="expandMark">\u23F7</span>',c.src=Spicetify.Player.data?.item?.album?.images?.[0]?.url?.replace("spotify:image:","https://i.scdn.co/image/")||s,d.textContent=Spicetify.Player.data?.item?.name||"No items"})}function Ve(){let e=document.querySelectorAll("#queue-panel ul")[1];e&&($e(),new MutationObserver($e).observe(e,{childList:!0}))}function $e(){if(!document.querySelector("#queue-panel")||!Spicetify.Queue)return;let e=document.querySelectorAll("#queue-panel li .HeaderArea");for(let t=0;t<e.length;t++){let i=e[t];if(i.querySelector(".wmpotify-queue-duration"))continue;let n=t===0?Spicetify.Queue.track?.contextTrack?.metadata?.duration:Spicetify.Queue.nextTracks?.[t-1]?.contextTrack?.metadata?.duration;if(!n)continue;let o=document.createElement("span");o.classList.add("wmpotify-queue-duration"),o.textContent=oe(n),i.appendChild(o)}}var g,x=[],v={},L=new MutationObserver(qe),je=new MutationObserver(dt),C=!1,Pe=!1,Me=[],Le=[],ut={async init(){if(document.querySelector("#wmpotify-libx-sidebar"))return!1;Object.keys(Spicetify.Platform.Translations).filter(n=>n.startsWith("shared.library.filter.")).forEach(n=>{let o=Spicetify.Platform.Translations[n];v[n.split(".").pop()]={loc_id:n,value:o}}),x.length===0&&(x.push({identifier:"playlist",localized:v.playlist.value,elem:null}),x.push({identifier:"album",localized:v.album.value,elem:null}),x.push({identifier:"artist",localized:v.artist.value,elem:null}));let t=document.createElement("div");t.id="wmpotify-libx-header",document.querySelector(".main-yourLibraryX-libraryContainer").insertAdjacentElement("afterbegin",t);let i=document.createElement("div");return i.id="wmpotify-libx-sidebar",document.querySelector(".main-yourLibraryX-libraryItemContainer").insertAdjacentElement("afterbegin",i),await pt(),g=document.querySelector('.main-yourLibraryX-filterArea .search-searchCategory-categoryGrid [role="presentation"]'),qe(),L.observe(g,{childList:!0}),je.observe(document.querySelector(".main-yourLibraryX-filterArea"),{childList:!0}),!0},uninit(){document.querySelector("#wmpotify-libx-header")?.remove(),document.querySelector("#wmpotify-libx-sidebar")?.remove(),L.disconnect(),je.disconnect()},go(e){e||(e=Spicetify.Platform.History.location.pathname.split("/").slice(2)),e[0]!==void 0&&mt(e)}};function Ee(){let e=document.querySelector("#wmpotify-libx-header");e.innerHTML="";let t=document.createElement("div");t.classList.add("wmpotify-libx-header-root-icon"),t.classList.add("wmpotify-toolbar-button"),e.appendChild(t);let i=document.createElement("button");i.classList.add("wmpotify-libx-header-root-text"),i.classList.add("wmpotify-toolbar-button"),i.textContent="Music",i.addEventListener("click",W),e.appendChild(i);let n=ke();if(n.forEach((o,a)=>{let r=document.createElement("button");r.classList.add("wmpotify-libx-header-category-text"),r.classList.add("wmpotify-toolbar-button"),r.textContent=o,r.addEventListener("click",async()=>{if(!r.nextElementSibling)return;C&&(G(),await Y()),L.disconnect();let s=x.find(l=>l.localized===o);if(a===0)W(),await B();else{if(!s)return;let l=x.find(c=>c.localized===n[a-1]);(!Qe(l)||!document.contains(s.elem))&&(R()||(W(),await B()),l.elem.click(),await B())}_(s),s.elem.click(),L.observe(g,{childList:!0})}),e.appendChild(r)}),C){let o=document.querySelector(".main-yourLibraryX-collapseButton > div").textContent,a=document.createElement("button");a.classList.add("wmpotify-libx-header-category-text"),a.classList.add("wmpotify-toolbar-button"),a.textContent=o,e.appendChild(a)}}function qe(){C=document.querySelector(".main-yourLibraryX-collapseButton").childElementCount>1;let e=ke(!0);if(C){let n=Spicetify.Platform.LocalStorageAPI.getItem("opened-folder-uri");e.push(n)}if(!Pe){let n="/wmpotify-standalone-libx/"+e.join("/");Spicetify.Platform.History.location.pathname==="/wmpotify-standalone-libx"?Spicetify.Platform.History.location.pathname=n:Spicetify.Platform.History.location.pathname!==n&&Spicetify.Platform.History.push({pathname:"/wmpotify-standalone-libx/"+e.join("/")})}if(C){Ee();return}let t=!g.querySelector('button[class*="ChipClear"]:first-child'),i=Array.from(g.querySelectorAll("button"));if(t)i.forEach((n,o)=>{let a={};a.localized=n.textContent,a.identifier=Object.keys(v).find(r=>v[r].value===a.localized),a.elem=n,x.some(r=>r.localized===a.localized)||x.push(a)});else{i.shift();let n=i[0].textContent,o=x.find(a=>a.localized===n);if(!o){let a={};a.localized=n,a.identifier=Object.keys(v).find(r=>v[r].value===a.localized),a.elem=i[0],x.push(a),o=a}o.children||(o.children=[]),i.shift(),i.forEach((a,r)=>{let s={};s.localized=a.textContent,s.identifier=Object.keys(v).find(l=>v[l].value===s.localized),s.elem=a,o.children.some(l=>l.localized===s.localized)||o.children.push(s)})}Ee(),Ke()}function dt(){L.disconnect(),g=document.querySelector('.main-yourLibraryX-filterArea .search-searchCategory-categoryGrid [role="presentation"]'),qe(),L.observe(g,{childList:!0})}function _(e){if(!document.contains(e.elem)){for(let t of g.querySelectorAll("button"))if(t.textContent===e.localized){e.elem=t;break}}}function R(){return!g.querySelector('button[class*="ChipClear"]:first-child')}function Qe(e){return R()?!1:Array.from(g.querySelectorAll("button"))[1].textContent===e.localized}async function W(){C&&(G(),await Y()),g.querySelector('button[class*="ChipClear"]:first-child')?.click()}function G(){Pe=!0,document.querySelectorAll(".main-yourLibraryX-collapseButton button")?.[1]?.click()}function ke(e=!1){let t=[];if(C=document.querySelector(".main-yourLibraryX-collapseButton").childElementCount>1,C)return e?Le:Me;if(R())return Me=[],Le=[],t;{let n=Array.from(g.querySelectorAll("button")).slice(1)[0].textContent;e&&(n=Object.keys(v).find(a=>v[a].value===n)),t.push(n);let o=g.querySelector('button[class*="secondary-selected"]');o&&(e?t.push(Object.keys(v).find(a=>v[a].value===o.textContent)):t.push(o.textContent)),e?Le=structuredClone(t):Me=structuredClone(t)}return t}async function mt(e){if(C&&(G(),await Y()),L.disconnect(),!R()){if(W(),e.length===0)return;await B()}for(let t=0;t<e.length;t++)if(e[t].startsWith("spotify:user:"))await ft(),document.querySelector('.main-yourLibraryX-libraryRootlist .main-rootlist-wrapper div[role="button"][aria-labelledby*="listrow-title-'+e[t]+'"]').click();else if(t===0){let i=x.find(n=>n.identifier===e[t]);if(!i)return;_(i),i.elem.click(),await B()}else{let i=x.find(o=>o.identifier===e[t-1]);if(!i)return;let n=i.children.find(o=>o.identifier===e[t]);if(!n)return;_(n),n.elem.click(),await B()}Ee(),Ke(),L.observe(g,{childList:!0})}function Ke(){let e=document.querySelector("#wmpotify-libx-sidebar");e.innerHTML="";let t=document.createElement("div");t.classList.add("wmpotify-libx-sidebar-item-container");let i=document.createElement("button");i.classList.add("wmpotify-libx-sidebar-item"),i.id="wmpotify-libx-sidebar-root",i.textContent="Library",i.addEventListener("click",W);let n=document.createElement("div");n.classList.add("wmpotify-libx-sidebar-chevron"),n.addEventListener("click",()=>{e.classList.toggle("rootCollapsed")}),t.appendChild(n),t.appendChild(i),e.appendChild(t),x.forEach(a=>{let r=document.createElement("div");r.classList.add("wmpotify-libx-sidebar-item-container");let s=document.createElement("button");if(s.classList.add("wmpotify-libx-sidebar-item"),s.textContent=a.localized,s.dataset.identifier=a.identifier,s.addEventListener("click",async()=>{s.classList.contains("active")&&!C||(C&&(G(),await Y()),L.disconnect(),R()||(W(),await B()),_(a),a.elem.click(),L.observe(g,{childList:!0}))}),r.appendChild(s),e.appendChild(r),a.children&&a.children.length>0){let l=document.createElement("div");l.classList.add("wmpotify-libx-sidebar-chevron"),l.addEventListener("click",()=>{r.classList.toggle("collapsed")}),r.insertBefore(l,s);let c=document.createElement("div");c.classList.add("wmpotify-libx-sidebar-downlevel"),a.children.forEach(d=>{let m=document.createElement("button");m.classList.add("wmpotify-libx-sidebar-item"),m.textContent=d.localized,m.dataset.identifier=d.identifier,m.addEventListener("click",async()=>{m.classList.contains("active")&&!C||(C&&(G(),await Y()),L.disconnect(),_(d),(!Qe(a)||!document.contains(d.elem))&&(R()||(W(),await B()),_(a),a.elem.click(),await B()),_(d),d.elem.click(),L.observe(g,{childList:!0}))}),c.appendChild(m)}),e.appendChild(c)}});let o=ke();if(o.length>0){let a=o.pop();Array.from(e.querySelectorAll(".wmpotify-libx-sidebar-item")).find(s=>s.textContent===a).classList.add("active")}else i.classList.add("active")}function pt(){if(!document.querySelector('.main-yourLibraryX-filterArea .search-searchCategory-categoryGrid [role="presentation"]'))return new Promise(e=>{let t=new MutationObserver(()=>{document.querySelector('.main-yourLibraryX-filterArea .search-searchCategory-categoryGrid [role="presentation"]')&&(e(),t.disconnect())});t.observe(document.querySelector(".main-yourLibraryX-libraryItemContainer"),{childList:!0,subtree:!0})})}function B(){return new Promise(e=>{let t=new MutationObserver(()=>{g.querySelector("button")&&(e(),t.disconnect())});t.observe(g,{childList:!0})})}function Y(){return new Promise(e=>{let t=new MutationObserver(()=>{Pe=!1,e(),t.disconnect()});t.observe(document.querySelector(".main-yourLibraryX-filterArea"),{childList:!0})})}function ft(){if(!document.querySelector('.main-yourLibraryX-libraryRootlist .main-rootlist-wrapper [role="presentation"]:not([class])'))return new Promise(e=>{let t=new MutationObserver(()=>{document.querySelector('.main-yourLibraryX-libraryRootlist .main-rootlist-wrapper [role="presentation"]:not([class])')&&(e(),t.disconnect())});t.observe(document.querySelector(".main-yourLibraryX-libraryRootlist"),{childList:!0,subtree:!0})})}var ce=ut;async function ue(e){let t=document.querySelector('section[data-testid="artist-page"]');if(!t){e&&(await de.waitForPageRender(),ue(!1));return}if(await yt(t),t.querySelector(".artist-artistDiscography-cardGrid"))return;let i=t.querySelector(".artist-artistDiscography-topBar a").textContent,n=t.dataset.testUri,o=t.querySelectorAll(".artist-artistDiscography-headerContainer");for(let s of o){if(s.querySelector(".artist-artistDiscography-headerTitle + div a"))continue;let l=s.querySelector(".main-entityHeader-image");if(!l)continue;l.addEventListener("dblclick",()=>{s.querySelector(".artist-artistDiscography-headerButtons div button").click()}),l.addEventListener("contextmenu",async d=>{s.querySelector(".artist-artistDiscography-headerButtons > button:last-child").click(),d.preventDefault(),d.stopPropagation(),await bt();let m=document.querySelector("[data-tippy-root]");m.dataset.wmpotifyForceTransform=!0,m.style.setProperty("--tippy-force-transform",`translate(${d.clientX}px, ${d.clientY}px)`)});let c=document.createElement("a");c.href=n,c.textContent=i,s.querySelector(".artist-artistDiscography-headerTitle + div").appendChild(c)}let a=t.querySelectorAll(".artist-artistDiscography-tracklist");for(let s of a){if(s.querySelector(".wmpotify-discography-trackList-header"))continue;let l=s.querySelector('[role="grid"]');if(!l)continue;let c=l.getAttribute("aria-label"),d=document.createElement("div");d.className="wmpotify-discography-trackList-header",d.textContent=c,s.insertAdjacentElement("afterbegin",d)}let r=new MutationObserver(()=>{ue(!1),r.disconnect()});r.observe(t.querySelector('[data-testid="infinite-scroll-list"]'),{childList:!0})}function yt(e){if(!e.querySelector(".artist-artistDiscography-tracklist"))return new Promise(t=>{let i=new MutationObserver(()=>{e.querySelector(".artist-artistDiscography-tracklist")&&(i.disconnect(),t())});i.observe(e,{childList:!0,subtree:!0})})}function bt(){return new Promise(e=>{let t=new MutationObserver(()=>{document.querySelector("[data-tippy-root]")&&(t.disconnect(),e())});t.observe(document.body,{childList:!0})})}var Te=0,me={waitForPageRender(){return new Promise(e=>{let t=new MutationObserver(()=>{document.querySelector(".main-loadingPage-container")||(e(),t.disconnect())});t.observe(document.querySelector(".main-view-container__scroll-node-child main"),{childList:!0})})},async handleLocChange(e){if(e?.pathname&&!(Te&&Date.now()-Te<2e3)){if(se.updateSidebarWidth(),e.pathname.startsWith("/wmpotify-standalone-libx")){document.body.dataset.wmpotifyLibPageOpen=!0;let t=k.getItem("ylx-sidebar-state"),i=k.getItem("ylx-expanded-state-nav-bar-width");Spicetify.Platform.LocalStorageAPI.setItem("ylx-sidebar-state",2),Spicetify.Platform.LocalStorageAPI.setItem("ylx-expanded-state-nav-bar-width",0),k.setItem("ylx-sidebar-state",t),k.setItem("ylx-expanded-state-nav-bar-width",i),await ce.init()||Spicetify.Platform.History.action==="POP"&&ce.go()}else if(document.body.dataset.wmpotifyLibPageOpen)if(delete document.body.dataset.wmpotifyLibPageOpen,ce.uninit(),localStorage.wmpotifyShowLibX){let t=k.getItem("ylx-sidebar-state");k.removeItem("ylx-sidebar-state");let i=k.getItem("ylx-expanded-state-nav-bar-width");k.removeItem("ylx-expanded-state-nav-bar-width"),Spicetify.Platform.LocalStorageAPI.setItem("ylx-sidebar-state",parseInt(t)),Spicetify.Platform.LocalStorageAPI.setItem("ylx-expanded-state-nav-bar-width",parseInt(i))}else Spicetify.Platform.LocalStorageAPI.setItem("ylx-sidebar-state",1);e.pathname.match("/artist/.*/discography/.*")?ue(!0):e.pathname.startsWith("/playlist/")&&(document.querySelector(".playlist-playlist-playlist")||await me.waitForPageRender(),$())}},init(){me.handleLocChange(Spicetify.Platform.History.location),Te=Date.now(),Spicetify.Platform.History.listen(e=>me.handleLocChange(e))}},de=me;globalThis.WindhawkComm=u;var Ge=[".Root__globalNav",".main-globalNav-historyButtons",".main-globalNav-searchSection",".main-globalNav-searchContainer > button",".main-globalNav-searchContainer div form button",'.main-globalNav-searchContainer div form input[type="search"]',".main-topBar-topbarContentRight > .main-actionButtons > button",".main-topBar-topbarContentRight > button:last-child",".Root__main-view",".main-view-container__scroll-node-child main",".main-nowPlayingBar-nowPlayingBar",".player-controls__left",'.player-controls__buttons button[data-testid="control-button-skip-back"]','.player-controls__buttons button[data-testid="control-button-repeat"]','.player-controls__buttons button[data-testid="control-button-playpause"]',".player-controls__right",".playback-bar .encore-text",".volume-bar",".volume-bar__icon-button",".volume-bar .progress-bar",".main-nowPlayingBar-left",".Root__right-sidebar div[class]"],D="xp",M="spotify";function ht(){localStorage.wmpotifyShowLibX||(document.body.dataset.hideLibx=!0),u.init();let e=u.query();switch(localStorage.wmpotifyTitleStyle&&["native","custom","spotify","keepmenu"].includes(localStorage.wmpotifyTitleStyle)?M=localStorage.wmpotifyTitleStyle:(console.log("WMPotify EarlyInit:",window.SpotEx,e),window.outerHeight-window.innerHeight>0||e?.options?.showframe||navigator.userAgent.includes("Linux")?M="native":(window.SpotEx||e)&&(e?.options?.showmenu&&!e.options.showcontrols?M="keepmenu":M="custom")),M==="keepmenu"&&!navigator.userAgent.includes("Windows")&&(M="spotify"),M==="spotify"&&navigator.userAgent.includes("Linux")&&(M="native"),document.documentElement.dataset.wmpotifyTitleStyle=M,e&&!localStorage.wmpotifyStyle&&M==="native"&&e.isThemingEnabled&&(e.options.transparentrendering&&e.isDwmEnabled?D="aero":e.isDwmEnabled||(D="basic")),localStorage.wmpotifyStyle&&["xp","aero","basic"].includes(localStorage.wmpotifyStyle)&&(D=localStorage.wmpotifyStyle),u.setMinSize(358,M==="native"?60:90),u.setBackdrop("mica"),D){case"xp":u.extendFrame(0,0,0,0);break;case"aero":u.extendFrame(0,0,0,60);break;case"basic":u.extendFrame(0,0,0,0),document.hasFocus()?document.body.style.backgroundColor="#b9d1ea":document.body.style.backgroundColor="#d7e4f2",window.addEventListener("focus",()=>{document.body.style.backgroundColor="#b9d1ea"}),window.addEventListener("blur",()=>{document.body.style.backgroundColor="#d7e4f2"});break}document.documentElement.dataset.wmpotifyStyle=D,window.addEventListener("resize",()=>{D==="aero"&&(window.innerHeight<62?u.extendFrame(-1,-1,-1,-1):u.extendFrame(0,0,0,60)),u.setMinSize(358,M==="native"?60:90)})}ht();async function gt(){if(await Ae(M),localStorage.wmpotifyShowLibX||Spicetify.Platform.LocalStorageAPI.setItem("ylx-sidebar-state",1),localStorage.wmpotifyTintColor){let[e,t,i]=localStorage.wmpotifyTintColor.split(",");X(e,t,i)}z.init(),de.init(),se.init(),xe.init(),new Spicetify.Menu.Item("WMPotify Properties",!1,xe.open).register(),_e(),Re(),le(),new MutationObserver(le).observe(document.querySelector(".Root__right-sidebar div[class]"),{childList:!0})}function wt(){return window.Spicetify?.CosmosAsync&&window.Spicetify.Platform?.PlayerAPI&&window.Spicetify.AppTitle&&window.Spicetify.Player?.origin?._state&&window.Spicetify.Menu&&window.Spicetify.Platform.History?.listen&&window.Spicetify.Platform.LocalStorageAPI&&window.Spicetify.Platform.Translations&&Ge.every(e=>document.querySelector(e))}window.addEventListener("load",()=>{let e=0,t=setInterval(async()=>{if(wt()){clearInterval(t);try{await gt()}catch(i){(window.Spicetify?.showNotification||window.alert)("[WMPotify] An error occurred during initialization. Please check the console for more information."),console.error("WMPotify: Error during init:",i)}console.log("WMPotify: Theme loaded")}else if(e++>80){(window.Spicetify?.showNotification||window.alert)("[WMPotify] Theme loading failed. Please refresh the page to try again. Please make sure you have compatible Spoitfy version."),clearInterval(t);let i=[];for(let n of Ge)document.querySelector(n)||i.push(n);console.log("WMPotify: Missing elements:",i)}},100)});document.addEventListener("scroll",function(){document.documentElement.scrollTo(0,0)});})();
