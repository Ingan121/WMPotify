"use strict";(()=>{var $=1,Fe={setControlHeight(e){$=e||1},init(){if(Spicetify.Config.extensions.includes("noControls.js")){Spicetify.showNotification("[WMPotify] Incompatible extension 'No Controls' detected! Some features of WMPotify will be disabled.");return}let e=i=>{i&&(i._updateUiClient?.updateTitlebarHeight&&i._updateUiClient.updateTitlebarHeight({height:$}),i._updateUiClient?.setButtonsVisibility&&$<=1&&i._updateUiClient.setButtonsVisibility(!1),window.addEventListener("beforeunload",()=>{i._updateUiClient?.setButtonsVisibility&&i._updateUiClient.setButtonsVisibility({showButtons:!0})})),Spicetify.CosmosAsync.post("sp://messages/v1/container/control",{type:"update_titlebar",height:$+"px"})};e(Spicetify.Platform.ControlMessageAPI),e(Spicetify.Platform.UpdateAPI);async function t(){e(Spicetify.Platform.ControlMessageAPI),e(Spicetify.Platform.UpdateAPI)}let o=setInterval(t,100);setTimeout(()=>{clearInterval(o)},1e4);let n=()=>{e(Spicetify.Platform.ControlMessageAPI),e(Spicetify.Platform.UpdateAPI)};document.addEventListener("fullscreenchange",n),window.addEventListener("resize",()=>{setTimeout(()=>{n()},100)})}},B=Fe;var oe=document.createElement("canvas");oe.width=1;oe.height=1;var Q=oe.getContext("2d");function Ne(e,t){return Q.fillStyle="#EEF3FA",Q.filter=`hue-rotate(${e}deg) saturate(${t}%)`,Q.fillRect(0,0,1,1),"rgba("+Q.getImageData(0,0,1,1).data+")"}function H(e,t,o){if(!e&&!t){document.documentElement.style.setProperty("--spice-main","#EEF3FA"),document.documentElement.style.removeProperty("--wmpotify-tint-hue"),document.documentElement.style.removeProperty("--wmpotify-tint-sat");return}let n=document.querySelector(".main-nowPlayingBar-nowPlayingBar");n&&(o?n.classList.add("tinted"):n.classList.remove("tinted")),document.documentElement.style.setProperty("--spice-main",Ne(e,t)),document.documentElement.style.setProperty("--wmpotify-tint-hue",e+"deg"),document.documentElement.style.setProperty("--wmpotify-tint-sat",t/100)}var d=null,ie=1,De={init(){return Re()},query(){return d?d.query():null},extendFrame(e,t,o,n){d?.extendFrame&&([e,t,o,n]=[e,t,o,n].map(i=>Math.round(i*window.devicePixelRatio)),ie>1&&([e,t]=[e&&e-1,t&&t-1],[o,n]=[o&&o-1,n&&n-1]),d.extendFrame(e,t,o,n))},minimize(){d?.minimize&&d.minimize()},maximizeRestore(){d?.maximizeRestore&&d.maximizeRestore()},close(){d?.close&&d.close()},setLayered(e,t,o){d?.setLayered&&d.setLayered(e,t,o)},setBackdrop(e){d?.setBackdrop&&d.setBackdrop(e)},resizeTo(e,t){d?.resizeTo&&d.resizeTo(e,t)},setMinSize(e,t){d?.setMinSize&&d.setMinSize(e,t)},setTopMost(e){d?.setTopMost&&d.setTopMost(e)},setTitle(e){d?.setTitle&&d.setTitle(e)},lockTitle(e){d?.lockTitle&&d.lockTitle(e)},openSpotifyMenu(){d?.openSpotifyMenu&&d.openSpotifyMenu()},setPlaybackSpeed(e){d?.setPlaybackSpeed&&d.setPlaybackSpeed(parseFloat(e))},available(){return!!d},getModule(){return d}};function Re(){if(navigator.userAgent.includes("Windows"))try{d=window._getSpotifyModule("ctewh"),ie=d.query().dpi/96;let{version:e,initialOptions:t}=d;return console.log(`CEF/Spotify Tweaks Windhawk mod available, Version: ${e}`),window.addEventListener("resize",()=>{ie=d.query().dpi/96}),{version:e,initialOptions:t}}catch{d=null,console.log("Windhawk mod not available")}}var y=De;async function Se(e){let t=y.query();switch(e){case"native":B.setControlHeight(0);break;case"custom":B.setControlHeight(0);case"keepmenu":let o=document.createElement("div");if(o.id="wmpotify-title-buttons",window.SpotEx||t){let s=document.createElement("button");s.id="wmpotify-minimize-button",s.addEventListener("click",()=>{window.SpotEx?SpotEx.updateWindow({state:"minimized"}):y.minimize()}),o.appendChild(s);let l=document.createElement("button");l.id="wmpotify-maximize-button",l.addEventListener("click",async()=>{window.SpotEx?(await SpotEx.getWindow()).state==="maximized"?SpotEx.updateWindow({state:"normal"}):SpotEx.updateWindow({state:"maximized"}):y.maximizeRestore()}),o.appendChild(l),window.addEventListener("resize",async()=>{window.SpotEx?(await SpotEx.getWindow()).state==="maximized"?l.dataset.maximized=!0:delete l.dataset.maximized:y.query().isMaximized?l.dataset.maximized=!0:delete l.dataset.maximized})}let n=document.createElement("button");n.id="wmpotify-close-button",n.addEventListener("click",()=>{we()}),o.appendChild(n);case"spotify":let i=document.createElement("div");i.id="wmpotify-title-bar";let r=document.createElement("div");r.id="wmpotify-title-icon",r.addEventListener("dblclick",()=>{we()}),i.appendChild(r);let a=document.createElement("span");a.id="wmpotify-title-text",a.textContent=await Spicetify.AppTitle.get(),i.appendChild(a),(e==="custom"||e==="keepmenu")&&i.appendChild(o),(e==="keepmenu"||e==="spotify")&&B.setControlHeight(25),document.body.appendChild(i),Spicetify.AppTitle.sub(s=>{a.textContent=s});break}}async function we(){y.available()?y.close():window.close()}var A=class{constructor(t=[],o=[]){this.menuOrder=t,this.submenus=o,this.openedMenu=null,this.mouseOverMenu=!1,this.mouseOverSubmenu=!1,this.handlingPointerEvent=!1,this.handlingKeyEvent=!1,this.boundMenuNavigationHandler=this.menuNavigationHandler.bind(this),this.submenuOpenTimer=null,this.submenuCloseTimer=null,this.shouldNotCloseSubmenu=!1,this.menuHierarchy={},this.beforeMenuOpenEvent=new Event("beforemenuopen"),this.afterMenuCloseEvent=new Event("aftermenuclose");for(let n of t){this.menuHierarchy[n]=[];let i=document.getElementById(n+"MenuBg"),r=i.querySelectorAll(".contextMenuItem");for(let a of r)a.dataset.submenu&&this.menuHierarchy[n].push(a.dataset.submenu),a.addEventListener("pointerover",()=>{for(let s of r)delete s.dataset.active;a.dataset.active=!0,clearTimeout(this.submenuOpenTimer),a.dataset.submenu?this.submenuOpenTimer=setTimeout(()=>{this.openMenu(a.dataset.submenu)},300):this.menuHierarchy[n].length>0&&this.delayedCloseMenu(this.menuHierarchy[n][0])}),a.addEventListener("pointerleave",()=>{this.mouseOverSubmenu||(delete a.dataset.active,clearTimeout(this.submenuOpenTimer),a.dataset.submenu&&this.delayedCloseMenu(a.dataset.submenu))}),a.addEventListener("click",()=>{a.dataset.submenu&&!a.classList.contains("disabled")?this.openedMenu.id!==a.dataset.submenu+"MenuBg"?this.openMenu(a.dataset.submenu):document.getElementById(a.dataset.submenu+"MenuBg").focus():a.dataset.noClose||this.closeMenu(n)});i.addEventListener("focusout",a=>{top.ignoreFocusLoss||a.relatedTarget&&a.relatedTarget.dataset.submenuOf===n||this.closeMenu(n)}),i.addEventListener("pointermove",a=>{(a.clientX>0||a.clientY>0)&&(i.style.animation="none")})}for(let n of o){let i=document.getElementById(n+"MenuBg"),r=i.querySelectorAll(".contextMenuItem"),a=document.getElementById(i.dataset.submenuOf+"MenuBg"),s=Array.from(a.querySelectorAll(".contextMenuItem")).findIndex(c=>c.dataset.submenu===n),l=a.querySelectorAll(".contextMenuItem")[s];for(let c of r)c.addEventListener("pointerover",()=>{for(let m of r)delete m.dataset.active;c.dataset.active=!0}),c.addEventListener("pointerleave",()=>{delete c.dataset.active}),c.addEventListener("click",()=>{this.shouldNotCloseSubmenu=!1,this.closeMenu(n),this.closeMenu(i.dataset.submenuOf)});i.addEventListener("pointerover",()=>{this.mouseOverMenu=!0,this.mouseOverSubmenu=!0,this.shouldNotCloseSubmenu=!0,clearTimeout(this.submenuCloseTimer),l.dataset.active=!0}),i.addEventListener("pointerleave",()=>{this.mouseOverMenu=!1,this.mouseOverSubmenu=!1,this.shouldNotCloseSubmenu=!1}),i.addEventListener("focusout",c=>{if(top.ignoreFocusLoss||i.style.display==="none")return;this.shouldNotCloseSubmenu=!1;let m=!!i.dataset.openStandalone;c.relatedTarget&&c.relatedTarget.id&&c.relatedTarget.id===a.id||(this.closeMenu(n),!(c.relatedTarget&&c.relatedTarget.id&&c.relatedTarget.dataset.submenuOf===i.dataset.submenuOf)&&(m||this.closeMenu(i.dataset.submenuOf)))})}}openMenu(t,o){let n=document.getElementById(t+"MenuBg"),i=document.getElementById(t+"Menu"),r=!!n.dataset.submenuOf,a,s,l,c=n.querySelectorAll(".contextMenuItem.debug");if(localStorage.wmpotifyDebugMode){l=n.querySelectorAll(".contextMenuItem:not([data-hidden])");for(let u of c)u.style.display=""}else{l=n.querySelectorAll(".contextMenuItem:not([data-hidden]):not(.debug)");for(let u of c)u.style.display="none"}if(n.dispatchEvent(this.beforeMenuOpenEvent),o)n.dataset.openStandalone=!0;else{if(r){if(this.menuHierarchy[n.dataset.submenuOf].length>1)for(let b of this.menuHierarchy[n.dataset.submenuOf])b!==t&&this.closeMenu(b);if(a=document.getElementById(n.dataset.submenuOf+"MenuBg"),a.style.display==="none")return;let u=Array.from(a.querySelectorAll(".contextMenuItem")).findIndex(b=>b.dataset.submenu===t);if(s=a.querySelectorAll(".contextMenuItem")[u],s.classList.contains("disabled"))return}else for(let u of this.menuOrder)u!==t&&document.getElementById(u+"MenuBg").style.display==="block"&&this.closeMenu(u);delete n.dataset.openStandalone}n.style.animation="";for(let u of l)delete u.dataset.active;if(o)o.top&&(n.style.top=o.top),o.left&&(n.style.left=o.left),o.right&&(n.style.right=o.right),o.bottom&&(n.style.bottom=o.bottom);else{let u="",b=0;r&&(u=a.offsetTop+s.offsetTop,b=a.offsetLeft+a.offsetWidth-6),n.style.top=u+"px",n.style.left=b+"px"}n.style.display="block";let m=this.calcMenuWidth(t);n.style.width=m+")",n.style.minWidth=0,i.style.width=m+" - 2px)",n.style.height=this.calcMenuHeight(t)+"px",o||r&&(s.dataset.active=!0),n.focus(),this.openedMenu=n,document.addEventListener("keydown",this.boundMenuNavigationHandler)}closeMenu(t){let o=document.getElementById(t+"MenuBg"),n=!!o.dataset.openStandalone,i=!!o.dataset.submenuOf&&!n;if(i&&this.shouldNotCloseSubmenu)return;let r,a;if(!n&&i){r=document.getElementById(o.dataset.submenuOf+"MenuBg");let s=Array.from(r.querySelectorAll(".contextMenuItem")).findIndex(l=>l.dataset.submenu===t);a=r.querySelectorAll(".contextMenuItem")[s]}this.submenuCloseTimer&&clearTimeout(this.submenuCloseTimer),o.style.display="none",n?delete o.dataset.openStandalone:i&&delete a.dataset.active,o.dispatchEvent(this.afterMenuCloseEvent),i&&r.style.display!=="none"?(r.focus(),this.openedMenu=r):(this.openedMenu=null,document.removeEventListener("keydown",this.boundMenuNavigationHandler))}delayedCloseMenu(t){this.submenuCloseTimer=setTimeout(()=>{this.closeMenu(t)},300)}menuNavigationHandler(t){if(!this.openedMenu)return;let o;localStorage.wmpotifyDebugMode?o=this.openedMenu.querySelectorAll(".contextMenuItem"):o=this.openedMenu.querySelectorAll(".contextMenuItem:not(.debug)");let n=this.openedMenu.querySelector(".contextMenuItem[data-active]"),i=Array.from(o).indexOf(n),r;switch(this.openedMenu.dataset.submenuOf&&(r=document.getElementById(this.openedMenu.dataset.submenuOf+"MenuBg").querySelector(".contextMenuItem[data-active]")),this.handlingKeyEvent=!0,this.openedMenu.style.animation="none",t.key){case"Escape":this.mouseOverMenu=!1,this.openedMenu.blur();break;case"ArrowUp":n?(delete n.dataset.active,i>0?o[i-1].dataset.active=!0:o[o.length-1].dataset.active=!0):o[o.length-1].dataset.active=!0;break;case"ArrowDown":n?(delete n.dataset.active,i<o.length-1?o[i+1].dataset.active=!0:o[0].dataset.active=!0):o[0].dataset.active=!0;break;case"ArrowLeft":if(this.openedMenu.dataset.submenuOf){this.closeMenu(this.openedMenu.id.slice(0,-6),!0),r.dataset.active=!0;break}if(this.menuOrder.length===1)break;let a=this.menuOrder[(this.menuOrder.indexOf(this.openedMenu.id.slice(0,-6))+this.menuOrder.length-1)%this.menuOrder.length];this.closeMenu(this.openedMenu.id.slice(0,-6)),this.openMenu(a),this.openedMenu.querySelector(".contextMenuItem").dataset.active=!0;break;case"ArrowRight":if(n&&n.dataset.submenu){this.openMenu(n.dataset.submenu),this.openedMenu.querySelector(".contextMenuItem").dataset.active=!0;break}if(this.menuOrder.length===1)break;let s;this.openedMenu.dataset.submenuOf?(s=this.menuOrder[(this.menuOrder.indexOf(this.openedMenu.dataset.submenuOf)+1)%this.menuOrder.length],this.closeMenu(this.openedMenu.id.slice(0,-6))):(s=this.menuOrder[(this.menuOrder.indexOf(this.openedMenu.id.slice(0,-6))+1)%this.menuOrder.length],this.closeMenu(this.openedMenu.id.slice(0,-6))),this.openMenu(s),this.openedMenu.querySelector(".contextMenuItem").dataset.active=!0;break;case"Enter":if(n)n.click();else{this.openedMenu.blur();break}break;default:let l=this.openedMenu.getElementsByTagName("u");for(let c of l)if(t.key===c.textContent.toLowerCase()){c.parentElement.click();break}}this.handlingKeyEvent=!1,t.preventDefault(),t.stopPropagation()}calcMenuWidth(t){let o=document.getElementById(t+"MenuBg"),n;localStorage.wmpotifyDebugMode?n=o.querySelectorAll(".contextMenuItem:not([data-hidden])"):n=o.querySelectorAll(".contextMenuItem:not([data-hidden]):not(.debug)"),o.style.minWidth="";let i=parseInt(getComputedStyle(o).minWidth)||0;return`calc(${Array.from(n).reduce((a,s)=>{let l=s.textContent,c=ae(l);return Math.max(i,a,c)},0)}px + 4.5em`}calcMenuHeight(t){let o=document.getElementById(t+"MenuBg"),n=o.querySelectorAll("hr"),i;localStorage.wmpotifyDebugMode?i=o.querySelectorAll(".contextMenuItem:not([data-hidden])"):i=o.querySelectorAll(".contextMenuItem:not([data-hidden]):not(.debug)");let r=i[0].offsetHeight,a=0;if(n.length>0){let l=getComputedStyle(n[0]);a=n[0].offsetHeight+parseFloat(l.marginTop)+parseFloat(l.marginBottom)}return parseInt(i.length*r+n.length*a)}};function j(e,t,o){let n=document.createElement("div");return n.id=e+"MenuBg",n.className="contextMenuBg",n.tabIndex=-1,n.style.display="none",n.innerHTML=`<div id="${e}Menu" class="contextMenu"></div>`,o&&(n.dataset.submenuOf=o),t.forEach(i=>{if(i.hr){let a=document.createElement("hr");n.querySelector(".contextMenu").appendChild(a);return}let r=document.createElement("div");r.className="contextMenuItem",i.args?r.innerHTML="<p>"+ve(i.text,...i.args)+"</p>":r.innerHTML="<p>"+ve(i.text)+"</p>",i.classList&&r.classList.add(...i.classList),i.disabled&&r.classList.add("disabled"),i.hidden&&(r.dataset.hidden=!0),i.submenu&&(r.dataset.submenu=i.submenu,r.innerHTML+='<p class="submenuMark">\u23F5</p>'),i.noClose&&(r.dataset.noClose=!0),r.addEventListener("click",i.click),n.querySelector(".contextMenu").appendChild(r)}),document.body.appendChild(n),{menuBg:n,menu:n.querySelector(".contextMenu"),menuItems:n.querySelectorAll(".contextMenuItem")}}function ae(e,t=getComputedStyle(document.documentElement).getPropertyValue("--menu-font")){let n=(ae.canvas||(ae.canvas=document.createElement("canvas"))).getContext("2d");return n.font=t,n.measureText(e).width}function ve(e){if(e=e.replace(/&([^&])/g,"<u>$1</u>").replace(/\\&/g,"&"),arguments.length>1)for(let t=1;t<arguments.length;t++)e=e.replace(/%s/,arguments[t]),e=e.replace(`%${t}s`,arguments[t]);return e}var Xe={getItem(e){let t=Spicetify._platform?.initialUser?.username,o=localStorage.getItem(t+":"+e);return isNaN(o)?o:parseFloat(o)},setItem(e,t){let o=Spicetify._platform?.initialUser?.username;localStorage.setItem(o+":"+e,t)},removeItem(e){let t=Spicetify._platform?.initialUser?.username;localStorage.removeItem(t+":"+e)}},E=Xe;var I,q=[],O,Ue={"Your Library":"Library","Friend Activity":"Friends"};function xe(){let e=document.querySelector(".Root__globalNav");I=document.createElement("div"),I.id="wmpotify-tabs-container",e.insertBefore(I,e.querySelector(".main-globalNav-searchSection"));let t=document.querySelector(".main-globalNav-searchContainer > button");F(t);let o=document.querySelector(".main-globalNav-searchContainer div form button");o.addEventListener("click",g=>{window.open("spotify:search"),g.preventDefault(),g.stopPropagation()}),F(o);let n=document.createElement("button");n.id="wmpotify-library-button",n.setAttribute("aria-label","Library"),n.addEventListener("click",()=>{Spicetify.Platform.History.push({pathname:"/wmpotify-standalone-libx"})}),F(n),q=[t,o,n];let i=document.querySelectorAll('.custom-navlinks-scrollable_container div[role="presentation"] > button');for(let g of i)F(g),q.push(g);let r=document.querySelectorAll(".main-topBar-topbarContentRight > .main-actionButtons > button");for(let g of r)F(g),q.push(g);let a=[];for(let g of q)a.push({text:g.querySelector(".wmpotify-tab-label").textContent,click:()=>g.click()});j("wmpotifyTab",a);let s=new A(["wmpotifyTab"]);O=document.createElement("button"),O.id="wmpotify-tabs-overflow-button",O.addEventListener("click",()=>{s.openMenu("wmpotifyTab",{top:"0",left:O.getBoundingClientRect().left+"px"})}),I.appendChild(O),re(),setTimeout(re,1e3),window.addEventListener("resize",re);let l=document.querySelector(".main-topBar-topbarContentRight > button:last-child"),c=document.createElement("span");c.textContent=l.getAttribute("aria-label"),c.classList.add("wmpotify-user-label"),l.appendChild(c);let m=document.createElement("div");m.id="wmpotify-search-container";let u=document.createElement("div");u.id="wmpotify-search-wrapper";let b=document.querySelector(".main-topBar-searchBar");u.appendChild(b);let w=document.createElement("button");w.id="wmpotify-search-clear-button",w.setAttribute("aria-label","Clear search"),w.addEventListener("click",()=>{b.value="",b.focus(),window.open("spotify:search")}),u.appendChild(w),m.appendChild(u),e.appendChild(m),e.addEventListener("pointerdown",g=>{g.button===2&&!g.target.closest("input")&&y.openSpotifyMenu()});let S=getComputedStyle(document.documentElement).getPropertyValue("--right-sidebar-width");S&&document.documentElement.style.setProperty("--panel-width",S)}function F(e){I.appendChild(e);let t=document.createElement("span"),o=e.getAttribute("aria-label");t.textContent=Ue[o]||o,t.classList.add("wmpotify-tab-label"),e.appendChild(t)}function re(){let e=document.querySelector(".main-globalNav-historyButtons").getBoundingClientRect().right,t=window.innerWidth-document.querySelector(".main-topBar-topbarContentRight").getBoundingClientRect().left,o=160,n=0;for(;window.innerWidth-e-t-o<I.getBoundingClientRect().width&&n<q.length;)q[q.length-1-n++].dataset.hidden=!0;for(n=document.querySelectorAll("#wmpotify-tabs-container button[data-hidden]").length;n>0&&window.innerWidth-e-t-o>I.getBoundingClientRect().width;)delete q[q.length-n--].dataset.hidden;O.style.display=n>0?"block":""}function K(e,t){if(!e||isNaN(e))return"00:00";let o=Math.floor(e/1e3),n=Math.floor(o/60);if(o=String(o%60).padStart(2,"0"),n<60)return t&&(n=String(n).padStart(2,"0")),`${n}:${o}`;let i=Math.floor(n/60);return n=String(n%60).padStart(2,"0"),t&&(i=String(i).padStart(2,"0")),`${i}:${n}:${o}`}var se,N,le,G,T,k,Ce=null;function qe(){let e=document.querySelector(".main-nowPlayingBar-nowPlayingBar");se=document.querySelector(".player-controls__buttons button[data-testid='control-button-playpause']"),Spicetify.Player.addEventListener("onplaypause",D),new MutationObserver(D).observe(se,{attributes:!0,attributeFilter:["aria-label"]}),Me(),new MutationObserver(Me).observe(document.querySelector(".main-nowPlayingBar-left"),{childList:!0});let t=document.querySelector(".player-controls__left"),o=document.querySelector('.player-controls__buttons button[data-testid="control-button-skip-back"]'),n=document.querySelector('.player-controls__buttons button[data-testid="control-button-skip-forward"]'),i=document.querySelector('.player-controls__buttons button[data-testid="control-button-repeat"]');t.insertBefore(i,o);let r=y.query();r?.speedModSupported&&r.immediateSpeedChange&&(n.addEventListener("pointerdown",()=>{n.disabled||Spicetify.Platform.ConnectAPI.state.connectionStatus==="connected"||(Ce=setTimeout(()=>{n.dataset.fastForward=!0,y.setPlaybackSpeed(5),Spicetify.Player.play()},1e3))}),n.addEventListener("click",w=>{clearTimeout(Ce),n.dataset.fastForward&&(delete n.dataset.fastForward,y.setPlaybackSpeed(1),w.preventDefault(),w.stopPropagation())}));let a=document.createElement("button");a.setAttribute("aria-label","Stop"),a.id="wmpotify-stop-button",a.addEventListener("click",()=>{Spicetify.Platform.PlayerAPI.clearQueue(),Spicetify.Player.playUri("")}),t.insertBefore(a,o);let s=document.querySelector(".player-controls__right"),l=document.querySelector(".volume-bar");N=l.querySelector(".volume-bar__icon-button"),le=l.querySelector(".progress-bar"),Le(),new MutationObserver(Le).observe(le,{attributes:!0,attributeFilter:["style"]}),s.appendChild(l);let c=document.querySelector(".volume-bar__slider-container"),m=c.children[0];c.addEventListener("click",()=>{window.innerWidth<750&&(m.classList.add("visible"),m.addEventListener("pointerup",()=>{m.classList.remove("visible")},{once:!0}),setTimeout(()=>{m.classList.remove("visible")},5e3))}),G=document.querySelectorAll(".playback-bar .encore-text");let u=document.createElement("div");u.classList.add("wmpotify-time-text-container"),k=document.createElement("span"),k.classList.add("wmpotify-time-text"),T=parseInt(localStorage.wmpotifyTimeTextMode||0),Ee(),k.dataset.mode=T,k.addEventListener("click",()=>{T=(T+1)%3,k.dataset.mode=T,localStorage.wmpotifyTimeTextMode=T}),u.appendChild(k),e.insertAdjacentElement("afterbegin",u),Spicetify.Player.addEventListener("onprogress",Ee);let b=new MutationObserver(()=>{let w=t.children.length;w!==4&&(b.disconnect(),t.insertBefore(t.children[w-2],i),b.observe(t,{childList:!0}))});b.observe(t,{childList:!0})}function Me(){D();let e=document.querySelector(".main-nowPlayingWidget-trackInfo");if(!e||document.querySelector(".wmpotify-track-info"))return;let t=document.createElement("p");t.classList.add("wmpotify-track-info"),t.textContent=document.querySelector(".main-trackInfo-name")?.textContent||"",e.appendChild(t);let o=1;setInterval(()=>{if(!Spicetify.Player.isPlaying())return;let n=Spicetify.Player.data?.item.metadata;n&&(o===0?t.textContent=n.title:o===1?t.textContent=n.artist_name:o===2&&(t.textContent=n.album_title),o=(o+1)%3)},3e3),Spicetify.Player.addEventListener("songchange",()=>{o=0,t.textContent=Spicetify.Player.data?.item.metadata.title})}function D(){se?.classList.toggle("playing",Spicetify.Player.isPlaying());let e=document.querySelector(`.playlist-playlist-playlist[data-test-uri="${Spicetify.Player.data?.context?.uri}"]`);e&&e.classList.toggle("playing",Spicetify.Player.isPlaying())}function Le(){let e=getComputedStyle(le).getPropertyValue("--progress-bar-transform").replace("%","")/100;e===0?N.dataset.vol="muted":e<=.3?N.dataset.vol="low":e<=.6?N.dataset.vol="mid":N.dataset.vol="high"}function Ee(){switch(T){case 0:{let e=Spicetify.Player.data?.item?.metadata?.duration-Spicetify.Player.getProgress();k.textContent=K(e,!0)}break;case 1:{let e=G[0].textContent;(e.length===4||e.length===7)&&(e="0"+e),k.textContent=e}break;case 2:{let e=G[0].textContent;(e.length===4||e.length===7)&&(e="0"+e);let t=G[1].textContent;(t.length===4||t.length===7)&&(t="0"+t),k.textContent=`${e} / ${t}`}break}}var p=document.createElement("div"),P=null,ue=0,Y=null,f={title:null,hue:null,sat:null};function Ve(){if(document.getElementById("wmpotify-config"))return;let e=document.querySelector(".Root__main-view");if(p.id="wmpotify-config",p.innerHTML=`
        <div id="wmpotify-config-topborder" class="wmpotify-tintable"></div>
        <button id="wmpotify-config-prev"></button>
        <button id="wmpotify-config-next"></button>
        <p id="wmpotify-config-title">Color Chooser</p>
        <button id="wmpotify-config-close"></button>
        <section class="wmpotify-config-tab-content" data-tab-title="Color Chooser" style="display: block;">
            <a href="#" id="wmpotify-config-color-reset">Reset</a><br>
            <label>Hue</label><br>
            <input type="range" id="wmpotify-config-hue" class="wmpotify-aero no-track" min="0" max="360" step="1" value="180"><br>
            <label>Saturation</label><br>
            <input type="range" id="wmpotify-config-sat" class="wmpotify-aero no-track" min="0" max="354" step="1" value="121"><br>
            <input type="checkbox" id="wmpotify-config-tint-playerbar" class="wmpotify-aero">
            <label for="wmpotify-config-tint-playerbar">Apply color to the now playing bar buttons</label>
        </section>
        <section class="wmpotify-config-tab-content" data-tab-title="General">
            <label for="wmpotify-config-style">Style</label>
            <select id="wmpotify-config-style" class="wmpotify-aero">
                <option value="auto">Auto</option>
                <option value="xp">XP</option>
                <option value="aero">Aero</option>
                <option value="basic">Basic</option>
            </select><br>
            <label for="wmpotify-config-title-style">Title style</label>
            <select id="wmpotify-config-title-style" class="wmpotify-aero">
                <option value="auto">Auto</option>
                <option value="native">Native</option>
                <option value="custom">Custom</option>
                <option value="spotify">Spotify</option>
                <option value="keepmenu">Keep Menu</option>
            </select><br>
            <input type="checkbox" id="wmpotify-config-show-libx" class="wmpotify-aero">
            <label for="wmpotify-config-show-libx">Show Your Library X on the left sidebar</label><br>
            <button id="wmpotify-config-apply" class="wmpotify-aero">Apply</button>
        </section>
        <section class="wmpotify-config-tab-content" data-tab-title="Play speed settings" data-wh-speedmod-required="true">
            <a href="#" id="wmpotify-config-speed-slow">Slow</a>
            <a href="#" id="wmpotify-config-speed-normal">Normal</a>
            <a href="#" id="wmpotify-config-speed-fast">Fast</a><br>
            <input type="range" id="wmpotify-config-speed" class="wmpotify-aero" min="0.5" max="2.0" step="0.1" value="1"><br>
            Play speed: <span id="wmpotify-config-speed-value">1.0</span>
        </section>
        <section class="wmpotify-config-tab-content" data-tab-title="About">
            <div id="wmpotify-about-logo"></div>
            <p id="wmpotify-about-title">WMPotify</p><br>
            <p>A Windows Media Player 11 inspired Spicetify theme for Spotify</p>
            <p>Version: Pre-alpha</p>
            <p>Made by Ingan121 - <a href="https://www.ingan121.com/" target="_blank">www.ingan121.com</a></p>
            <a href="https://github.com/Ingan121/WMPotify" target="_blank">GitHub</a>
        </section>
    `,p.querySelector("#wmpotify-config-close").addEventListener("click",de),p.querySelector("#wmpotify-config-apply").addEventListener("click",Ie),!y.query()?.speedModSupported)p.querySelector("[data-wh-speedmod-required=true]").remove();else{f.speed=p.querySelector("#wmpotify-config-speed"),f.speedValue=p.querySelector("#wmpotify-config-speed-value"),f.speed.addEventListener("pointerup",je),p.querySelector("#wmpotify-config-speed-slow").addEventListener("click",R.bind(null,.5)),p.querySelector("#wmpotify-config-speed-normal").addEventListener("click",R.bind(null,1)),p.querySelector("#wmpotify-config-speed-fast").addEventListener("click",R.bind(null,1.4));let o=y.query()?.playbackSpeed||1;f.speedValue.textContent=Number.isInteger(o)?o+".0":o,f.speedValue.addEventListener("click",()=>{R(parseFloat(prompt("Enter a playback speed (0.5 - 5.0)",o)))})}P=p.querySelectorAll(".wmpotify-config-tab-content"),f.title=p.querySelector("#wmpotify-config-title"),f.hue=p.querySelector("#wmpotify-config-hue"),f.sat=p.querySelector("#wmpotify-config-sat"),f.tintPb=p.querySelector("#wmpotify-config-tint-playerbar"),f.hue.addEventListener("input",ce),f.sat.addEventListener("input",ce),f.tintPb.addEventListener("change",ce),p.querySelector("#wmpotify-config-color-reset").addEventListener("click",Qe),p.querySelector("#wmpotify-config-prev").addEventListener("click",ke),p.querySelector("#wmpotify-config-next").addEventListener("click",Pe),localStorage.wmpotifyStyle&&(p.querySelector("#wmpotify-config-style").value=localStorage.wmpotifyStyle);let t=p.querySelector("#wmpotify-config-title-style");navigator.userAgent.includes("Windows")||t.querySelector("option[value=keepmenu]").remove(),navigator.userAgent.includes("Linux")&&t.querySelector("option[value=spotify]").remove(),localStorage.wmpotifyTitleStyle&&(t.value=localStorage.wmpotifyTitleStyle),localStorage.wmpotifyShowLibX&&(p.querySelector("#wmpotify-config-show-libx").checked=!0),e.appendChild(p)}function $e(){if(P){if(document.body.dataset.wmpotifyLibPageOpen)document.querySelector("#wmpotify-tabs-container button")?.click();else if(p.style.display==="block"){de();return}if(p.style.display="block",localStorage.wmpotifyTintColor){let[e,t,o]=localStorage.wmpotifyTintColor.split(",");f.hue.value=parseInt(e)+180,f.sat.value=parseInt(t)*121/100,o&&(f.tintPb.checked=!0)}}}function de(){p.style.display="none"}function me(e){if(P){for(let t=0;t<P.length;t++){let o=P[t];o.style.display=t===e?"block":"none"}ue=e,f.title.textContent=P[e].dataset.tabTitle}}function ke(){me((ue-1+P.length)%P.length)}function Pe(){me((ue+1)%P.length)}function ce(){let e=f.hue.value-180,t=f.sat.value*100/121;H(e,t,f.tintPb.checked),localStorage.wmpotifyTintColor=e+","+t+","+(f.tintPb.checked?"1":"")}function Qe(){f.hue.value=180,f.sat.value=121,H(),delete localStorage.wmpotifyTintColor}function je(){f.speedValue.textContent=Number.isInteger(parseFloat(f.speed.value))?f.speed.value+".0":f.speed.value,Y&&clearTimeout(Y),Y=setTimeout(()=>{R(f.speed.value),Y=null},500)}function R(e){if(Spicetify.Platform.ConnectAPI.state.connectionStatus==="connected"){Spicetify.showNotification("Cannot change playback speed while playing from another device");return}e=parseFloat(e);let t=y.query().playbackSpeed||1;e!==t&&(f.speed.value=e,f.speedValue.textContent=Number.isInteger(e)?e+".0":e,y.setPlaybackSpeed(e))}function Ie(){let e=p.querySelector("#wmpotify-config-style").value,t=p.querySelector("#wmpotify-config-title-style").value,o=p.querySelector("#wmpotify-config-show-libx").checked;e!=="auto"?localStorage.wmpotifyStyle=e:delete localStorage.wmpotifyStyle,t!=="auto"?localStorage.wmpotifyTitleStyle=t:delete localStorage.wmpotifyTitleStyle,o?localStorage.wmpotifyShowLibX=!0:delete localStorage.wmpotifyShowLibX,location.reload()}var Ke={init:Ve,open:$e,close:de,openTab:me,prevTab:ke,nextTab:Pe,apply:Ie,isOpen:()=>p.style.display==="block"},pe=Ke;var _={widthManager:new MutationObserver(()=>{if(Spicetify.Platform.History.location.pathname!=="/wmpotify-standalone-libx"){let o=getComputedStyle(document.documentElement).getPropertyValue("--right-sidebar-width");o&&(_.widthManager.disconnect(),document.documentElement.style.setProperty("--panel-width",o),_.widthManager.observe(document.documentElement,{attributes:!0,attributeFilter:["style"]}));return}_.widthManager.disconnect();let e=document.querySelector(".Root__right-sidebar aside");document.documentElement.style.setProperty("--panel-width",e?e.offsetWidth:8),getComputedStyle(document.documentElement).getPropertyValue("--right-sidebar-width")&&document.documentElement.style.setProperty("--right-sidebar-width",e?e.offsetWidth:8),_.widthManager.observe(document.documentElement,{attributes:!0,attributeFilter:["style"]})}),init(){_.widthManager.observe(document.documentElement,{attributes:!0,attributeFilter:["style"]})}},Te=_;function fe(){if(!document.querySelector("#queue-panel")||document.querySelector("#wmpotify-queue-toolbar")||document.querySelectorAll('div[data-encore-id="tabPanel"]').length>2)return;let e=document.querySelector("#Desktop_PanelContainer_Id");e.classList.add("spotify-queue-panel");let t=document.querySelector("#Desktop_PanelContainer_Id > div > div:first-child > div:first-child"),o=document.querySelector("#Desktop_PanelContainer_Id > div > div:nth-child(2)");o.id="spotify-queue-panel-content";let n=document.createElement("div");n.id="wmpotify-queue-toolbar";let i=document.createElement("button");i.id="wmpotify-queue-playlist-button",i.classList.add("wmpotify-toolbar-button"),i.addEventListener("click",()=>{let S=Spicetify.Player.data?.context?.uri;S&&window.open(S)}),i.textContent=document.querySelector('#queue-panel div[data-flip-id*="section-header-"] a')?.textContent||"Now Playing",i.innerHTML+='<span class="expandMark">\u23F7</span>',n.appendChild(i);let r=document.createElement("button");r.id="wmpotify-queue-clear-button",r.classList.add("wmpotify-toolbar-button"),r.addEventListener("click",()=>{Spicetify.Platform.PlayerAPI.clearQueue(),Spicetify.Player.playUri("")}),n.appendChild(r),o.insertAdjacentElement("afterbegin",n);let a=getComputedStyle(document.documentElement).getPropertyValue("--album-art-placeholder").trim().slice(5,-2),s=document.createElement("div");s.id="wmpotify-queue-npv";let l=document.createElement("img");l.id="wmpotify-queue-album-art",l.src=document.querySelector(".main-nowPlayingWidget-coverArt .cover-art img")?.src||a,s.appendChild(l);let c=document.createElement("div");c.id="wmpotify-queue-song-title",c.textContent=document.querySelector(".main-trackInfo-name")?.textContent||"No items",s.appendChild(c),t.insertAdjacentElement("afterbegin",s),Be(),new MutationObserver(Be).observe(document.querySelector("#queue-panel"),{childList:!0});let m=document.querySelectorAll('#Desktop_PanelContainer_Id div[role="tablist"] button'),u=[],b;for(let S of m)u.push({text:S.textContent,click:function(){for(let g of b.menuItems)g.classList.remove("activeStyle");this.classList.add("activeStyle"),S.click()}});u[0].classList=["activeStyle"],document.querySelector("#wmpotifyQueueTabMenuBg")?.remove(),b=j("wmpotifyQueueTab",u);let w=new A(["wmpotifyQueueTab"]);e.addEventListener("contextmenu",S=>{S.preventDefault(),w.openMenu("wmpotifyQueueTab",{left:S.clientX+"px",top:S.clientY+"px"})}),Spicetify.Player.addEventListener("songchange",()=>{i.textContent=Spicetify.Player.data?.context?.metadata?.context_description||"Now Playing",i.innerHTML+='<span class="expandMark">\u23F7</span>',l.src=Spicetify.Player.data?.item?.album?.images?.[0]?.url?.replace("spotify:image:","https://i.scdn.co/image/")||a,c.textContent=Spicetify.Player.data?.item?.name||"No items"})}function Be(){let e=document.querySelectorAll("#queue-panel ul")[1];e&&(Ae(),new MutationObserver(Ae).observe(e,{childList:!0}))}function Ae(){if(!document.querySelector("#queue-panel")||!Spicetify.Queue)return;let e=document.querySelectorAll("#queue-panel li .HeaderArea");for(let t=0;t<e.length;t++){let o=e[t];if(o.querySelector(".wmpotify-queue-duration"))continue;let n=t===0?Spicetify.Queue.track?.contextTrack?.metadata?.duration:Spicetify.Queue.nextTracks?.[t-1]?.contextTrack?.metadata?.duration;if(!n)continue;let i=document.createElement("span");i.classList.add("wmpotify-queue-duration"),i.textContent=K(n),o.appendChild(i)}}var h,v=[],M={},L=new MutationObserver(be),Oe=new MutationObserver(()=>{L.disconnect(),h=document.querySelector('.main-yourLibraryX-filterArea .search-searchCategory-categoryGrid [role="presentation"]'),be(),L.observe(h,{childList:!0})}),x=!1,ye=[],Ge={async init(){if(document.querySelector("#wmpotify-libx-sidebar"))return;Object.keys(Spicetify.Platform.Translations).filter(n=>n.startsWith("shared.library.filter.")).forEach(n=>{let i=Spicetify.Platform.Translations[n];M[n.split(".").pop()]={loc_id:n,value:i}}),v.length===0&&(v.push({identifier:"playlist",localized:M.playlist.value,elem:null}),v.push({identifier:"album",localized:M.album.value,elem:null}),v.push({identifier:"artist",localized:M.artist.value,elem:null}));let t=document.createElement("div");t.id="wmpotify-libx-header",document.querySelector(".main-yourLibraryX-libraryContainer").insertAdjacentElement("afterbegin",t);let o=document.createElement("div");o.id="wmpotify-libx-sidebar",document.querySelector(".main-yourLibraryX-libraryItemContainer").insertAdjacentElement("afterbegin",o),await Je(),h=document.querySelector('.main-yourLibraryX-filterArea .search-searchCategory-categoryGrid [role="presentation"]'),be(),L.observe(h,{childList:!0}),Oe.observe(document.querySelector(".main-yourLibraryX-filterArea"),{childList:!0})},uninit(){document.querySelector("#wmpotify-libx-header")?.remove(),document.querySelector("#wmpotify-libx-sidebar")?.remove(),L.disconnect(),Oe.disconnect()}};function _e(){let e=document.querySelector("#wmpotify-libx-header");e.innerHTML="";let t=document.createElement("div");t.classList.add("wmpotify-libx-header-root-icon"),t.classList.add("wmpotify-toolbar-button"),e.appendChild(t);let o=document.createElement("button");o.classList.add("wmpotify-libx-header-root-text"),o.classList.add("wmpotify-toolbar-button"),o.textContent="Music",o.addEventListener("click",W),e.appendChild(o);let n=ze();if(n.forEach((i,r)=>{let a=document.createElement("button");a.classList.add("wmpotify-libx-header-category-text"),a.classList.add("wmpotify-toolbar-button"),a.textContent=i,a.addEventListener("click",async()=>{if(!a.nextElementSibling)return;x&&(J(),await Z()),L.disconnect();let s=v.find(l=>l.localized===i);if(r===0)W(),await z();else{let l=v.find(c=>c.localized===n[r-1]);(!We(l)||!document.contains(s.elem))&&(U()||(W(),await z()),l.elem.click(),await z())}X(s),s.elem.click(),L.observe(h,{childList:!0})}),e.appendChild(a)}),x){let i=document.querySelector(".main-yourLibraryX-collapseButton > div").textContent,r=document.createElement("button");r.classList.add("wmpotify-libx-header-category-text"),r.classList.add("wmpotify-toolbar-button"),r.textContent=i,e.appendChild(r)}}function be(){if(x=document.querySelector(".main-yourLibraryX-collapseButton").childElementCount>1,x){_e();return}let e=!h.querySelector('button[class*="ChipClear"]:first-child'),t=Array.from(h.querySelectorAll("button"));if(e)t.forEach((o,n)=>{let i={};i.localized=o.textContent,i.identifier=Object.keys(M).find(r=>M[r].value===i.localized),i.elem=o,v.some(r=>r.localized===i.localized)||v.push(i)});else{t.shift();let o=t[0].textContent,n=v.find(i=>i.localized===o);if(!n){let i={};i.localized=o,i.identifier=Object.keys(M).find(r=>M[r].value===i.localized),i.elem=t[0],v.push(i),n=i}n.children||(n.children=[]),t.shift(),t.forEach((i,r)=>{let a={};a.localized=i.textContent,a.identifier=Object.keys(M).find(s=>M[s].value===a.localized),a.elem=i,n.children.some(s=>s.localized===a.localized)||n.children.push(a)})}_e(),Ye()}function X(e){if(!document.contains(e.elem)){for(let t of h.querySelectorAll("button"))if(t.textContent===e.localized){e.elem=t;break}}}function U(){return!h.querySelector('button[class*="ChipClear"]:first-child')}function We(e){return U()?!1:Array.from(h.querySelectorAll("button"))[1].textContent===e.localized}async function W(){x&&(J(),await Z()),h.querySelector('button[class*="ChipClear"]:first-child')?.click()}function J(){document.querySelectorAll(".main-yourLibraryX-collapseButton button")?.[1]?.click()}function ze(){let e=[];if(x=document.querySelector(".main-yourLibraryX-collapseButton").childElementCount>1,x)return ye;if(U())return ye=[],e;{let o=Array.from(h.querySelectorAll("button")).slice(1)[0].textContent;e.push(o);let n=h.querySelector('button[class*="secondary-selected"]');n&&e.push(n.textContent),ye=structuredClone(e)}return e}function Ye(){let e=document.querySelector("#wmpotify-libx-sidebar");e.innerHTML="";let t=document.createElement("div");t.classList.add("wmpotify-libx-sidebar-item-container");let o=document.createElement("button");o.classList.add("wmpotify-libx-sidebar-item"),o.id="wmpotify-libx-sidebar-root",o.textContent="Library",o.addEventListener("click",W);let n=document.createElement("div");n.classList.add("wmpotify-libx-sidebar-chevron"),n.addEventListener("click",()=>{e.classList.toggle("rootCollapsed")}),t.appendChild(n),t.appendChild(o),e.appendChild(t),v.forEach(r=>{let a=document.createElement("div");a.classList.add("wmpotify-libx-sidebar-item-container");let s=document.createElement("button");if(s.classList.add("wmpotify-libx-sidebar-item"),s.textContent=r.localized,s.dataset.identifier=r.identifier,s.addEventListener("click",async()=>{s.classList.contains("active")&&!x||(x&&(J(),await Z()),L.disconnect(),U()||(W(),await z()),X(r),r.elem.click(),L.observe(h,{childList:!0}))}),a.appendChild(s),e.appendChild(a),r.children&&r.children.length>0){let l=document.createElement("div");l.classList.add("wmpotify-libx-sidebar-chevron"),l.addEventListener("click",()=>{a.classList.toggle("collapsed")}),a.insertBefore(l,s);let c=document.createElement("div");c.classList.add("wmpotify-libx-sidebar-downlevel"),r.children.forEach(m=>{let u=document.createElement("button");u.classList.add("wmpotify-libx-sidebar-item"),u.textContent=m.localized,u.dataset.identifier=m.identifier,u.addEventListener("click",async()=>{u.classList.contains("active")&&!x||(x&&(J(),await Z()),L.disconnect(),X(m),(!We(r)||!document.contains(m.elem))&&(U()||(W(),await z()),X(r),r.elem.click(),await z()),X(m),m.elem.click(),L.observe(h,{childList:!0}))}),c.appendChild(u)}),e.appendChild(c)}});let i=ze();if(i.length>0){let r=i.pop();Array.from(e.querySelectorAll(".wmpotify-libx-sidebar-item")).find(s=>s.textContent===r).classList.add("active")}else o.classList.add("active")}function Je(){if(!document.querySelector('.main-yourLibraryX-filterArea .search-searchCategory-categoryGrid [role="presentation"]'))return new Promise(e=>{let t=new MutationObserver(()=>{document.querySelector('.main-yourLibraryX-filterArea .search-searchCategory-categoryGrid [role="presentation"]')&&(e(),t.disconnect())});t.observe(document.querySelector(".main-yourLibraryX-libraryItemContainer"),{childList:!0,subtree:!0})})}function z(){return new Promise(e=>{let t=new MutationObserver(()=>{h.querySelector("button")&&(e(),t.disconnect())});t.observe(h,{childList:!0})})}function Z(){return new Promise(e=>{let t=new MutationObserver(()=>{e(),t.disconnect()});t.observe(document.querySelector(".main-yourLibraryX-filterArea"),{childList:!0})})}var he=Ge;async function ee(e){let t=document.querySelector('section[data-testid="artist-page"]');if(!t){e&&(await te.waitForPageRender(),ee(!1));return}if(await Ze(t),t.querySelector(".artist-artistDiscography-cardGrid"))return;let o=t.querySelector(".artist-artistDiscography-topBar a").textContent,n=t.dataset.testUri,i=t.querySelectorAll(".artist-artistDiscography-headerContainer");for(let s of i){if(s.querySelector(".artist-artistDiscography-headerTitle + div a"))continue;let l=s.querySelector(".main-entityHeader-image");if(!l)continue;l.addEventListener("dblclick",()=>{s.querySelector(".artist-artistDiscography-headerButtons div button").click()}),l.addEventListener("contextmenu",async m=>{s.querySelector(".artist-artistDiscography-headerButtons > button:last-child").click(),m.preventDefault(),m.stopPropagation(),await et();let u=document.querySelector("[data-tippy-root]");u.dataset.wmpotifyForceTransform=!0,u.style.setProperty("--tippy-force-transform",`translate(${m.clientX}px, ${m.clientY}px)`)});let c=document.createElement("a");c.href=n,c.textContent=o,s.querySelector(".artist-artistDiscography-headerTitle + div").appendChild(c)}let r=t.querySelectorAll(".artist-artistDiscography-tracklist");for(let s of r){if(s.querySelector(".wmpotify-discography-trackList-header"))continue;let l=s.querySelector('[role="grid"]');if(!l)continue;let c=l.getAttribute("aria-label"),m=document.createElement("div");m.className="wmpotify-discography-trackList-header",m.textContent=c,s.insertAdjacentElement("afterbegin",m)}let a=new MutationObserver(()=>{ee(!1),a.disconnect()});a.observe(t.querySelector('[data-testid="infinite-scroll-list"]'),{childList:!0})}function Ze(e){if(!e.querySelector(".artist-artistDiscography-tracklist"))return new Promise(t=>{let o=new MutationObserver(()=>{e.querySelector(".artist-artistDiscography-tracklist")&&(o.disconnect(),t())});o.observe(e,{childList:!0,subtree:!0})})}function et(){return new Promise(e=>{let t=new MutationObserver(()=>{document.querySelector("[data-tippy-root]")&&(t.disconnect(),e())});t.observe(document.body,{childList:!0})})}var ge=0,ne={waitForPageRender(){return new Promise(e=>{let t=new MutationObserver(()=>{document.querySelector(".main-loadingPage-container")||(e(),t.disconnect())});t.observe(document.querySelector(".main-view-container__scroll-node-child main"),{childList:!0})})},async handleLocChange(e){if(e?.pathname&&!(ge&&Date.now()-ge<2e3)){if(e.pathname==="/wmpotify-standalone-libx"){document.body.dataset.wmpotifyLibPageOpen=!0;let t=E.getItem("ylx-sidebar-state"),o=E.getItem("ylx-expanded-state-nav-bar-width");Spicetify.Platform.LocalStorageAPI.setItem("ylx-sidebar-state",2),Spicetify.Platform.LocalStorageAPI.setItem("ylx-expanded-state-nav-bar-width",0),E.setItem("ylx-sidebar-state",t),E.setItem("ylx-expanded-state-nav-bar-width",o),he.init()}else if(document.body.dataset.wmpotifyLibPageOpen)if(delete document.body.dataset.wmpotifyLibPageOpen,he.uninit(),localStorage.wmpotifyShowLibX){let t=E.getItem("ylx-sidebar-state");E.removeItem("ylx-sidebar-state");let o=E.getItem("ylx-expanded-state-nav-bar-width");E.removeItem("ylx-expanded-state-nav-bar-width"),Spicetify.Platform.LocalStorageAPI.setItem("ylx-sidebar-state",parseInt(t)),Spicetify.Platform.LocalStorageAPI.setItem("ylx-expanded-state-nav-bar-width",parseInt(o))}else Spicetify.Platform.LocalStorageAPI.setItem("ylx-sidebar-state",1);e.pathname.match("/artist/.*/discography/.*")?ee(!0):e.pathname.startsWith("/playlist/")&&(document.querySelector(".playlist-playlist-playlist")||await ne.waitForPageRender(),D())}},init(){ne.handleLocChange(Spicetify.Platform.History.location),ge=Date.now(),Spicetify.Platform.History.listen(e=>ne.handleLocChange(e))}},te=ne;globalThis.WindhawkComm=y;var He=[".Root__globalNav",".main-globalNav-historyButtons",".main-globalNav-searchSection",".main-globalNav-searchContainer > button",".main-globalNav-searchContainer div form button",".main-topBar-searchBar",".main-topBar-topbarContentRight > .main-actionButtons > button",".main-topBar-topbarContentRight > button:last-child",".Root__main-view",".main-view-container__scroll-node-child main",".main-nowPlayingBar-nowPlayingBar",".player-controls__left",'.player-controls__buttons button[data-testid="control-button-skip-back"]','.player-controls__buttons button[data-testid="control-button-repeat"]','.player-controls__buttons button[data-testid="control-button-playpause"]',".player-controls__right",".playback-bar .encore-text",".volume-bar",".volume-bar__icon-button",".volume-bar .progress-bar",".main-nowPlayingBar-left",".Root__right-sidebar div[class]"],V="xp",C="spotify";function tt(){localStorage.wmpotifyShowLibX||(document.body.dataset.hideLibx=!0),y.init();let e=y.query();switch(localStorage.wmpotifyTitleStyle&&["native","custom","spotify","keepmenu"].includes(localStorage.wmpotifyTitleStyle)?C=localStorage.wmpotifyTitleStyle:(console.log("WMPotify EarlyInit:",window.SpotEx,e),window.outerHeight-window.innerHeight>0||e?.options?.showframe||navigator.userAgent.includes("Linux")?C="native":(window.SpotEx||e)&&(e?.options?.showmenu&&!e.options.showcontrols?C="keepmenu":C="custom")),C==="keepmenu"&&!navigator.userAgent.includes("Windows")&&(C="spotify"),C==="spotify"&&navigator.userAgent.includes("Linux")&&(C="native"),document.documentElement.dataset.wmpotifyTitleStyle=C,e&&!localStorage.wmpotifyStyle&&C==="native"&&e.isThemingEnabled&&(e.options.transparentrendering&&e.isDwmEnabled?V="aero":e.isDwmEnabled||(V="basic")),localStorage.wmpotifyStyle&&["xp","aero","basic"].includes(localStorage.wmpotifyStyle)&&(V=localStorage.wmpotifyStyle),y.setMinSize(358,60),y.setBackdrop("mica"),V){case"xp":y.extendFrame(0,0,0,0);break;case"aero":y.extendFrame(0,0,0,60),window.addEventListener("resize",()=>{y.extendFrame(0,0,0,60)});break;case"basic":y.extendFrame(0,0,0,0),document.hasFocus()?document.body.style.backgroundColor="#b9d1ea":document.body.style.backgroundColor="#d7e4f2",window.addEventListener("focus",()=>{document.body.style.backgroundColor="#b9d1ea"}),window.addEventListener("blur",()=>{document.body.style.backgroundColor="#d7e4f2"});break}document.documentElement.dataset.wmpotifyStyle=V}tt();async function nt(){if(await Se(C),localStorage.wmpotifyShowLibX||Spicetify.Platform.LocalStorageAPI.setItem("ylx-sidebar-state",1),localStorage.wmpotifyTintColor){let[e,t,o]=localStorage.wmpotifyTintColor.split(",");H(e,t,o)}B.init(),te.init(),Te.init(),pe.init(),new Spicetify.Menu.Item("WMPotify Properties",!1,pe.open).register(),xe(),qe(),fe(),new MutationObserver(fe).observe(document.querySelector(".Root__right-sidebar div[class]"),{childList:!0})}function ot(){return window.Spicetify?.CosmosAsync&&window.Spicetify.Platform?.PlayerAPI&&window.Spicetify.AppTitle&&window.Spicetify.Player?.origin?._state&&window.Spicetify.Menu&&window.Spicetify.Platform.History?.listen&&window.Spicetify.Platform.LocalStorageAPI&&window.Spicetify.Platform.Translations&&He.every(e=>document.querySelector(e))}window.addEventListener("load",()=>{let e=0,t=setInterval(async()=>{if(ot()){clearInterval(t);try{await nt()}catch(o){(Spicetify.showNotification||window.alert)("[WMPotify] An error occurred during initialization. Please check the console for more information."),console.error("WMPotify: Error during init:",o)}console.log("WMPotify: Theme loaded")}else if(e++>80){(Spicetify.showNotification||window.alert)("[WMPotify] Theme loading failed. Please refresh the page to try again. Please make sure you have compatible Spoitfy version."),clearInterval(t);let o=[];for(let n of He)document.querySelector(n)||o.push(n);console.log("WMPotify: Missing elements:",o)}},100)});})();
