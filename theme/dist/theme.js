(()=>{var C=class{constructor(n=[],o=[]){this.menuOrder=n,this.submenus=o,this.openedMenu=null,this.mouseOverMenu=!1,this.mouseOverSubmenu=!1,this.handlingPointerEvent=!1,this.handlingKeyEvent=!1,this.boundMenuNavigationHandler=this.menuNavigationHandler.bind(this),this.submenuOpenTimer=null,this.submenuCloseTimer=null,this.shouldNotCloseSubmenu=!1,this.menuHierarchy={},this.beforeMenuOpenEvent=new Event("beforemenuopen"),this.afterMenuCloseEvent=new Event("aftermenuclose");for(let e of n){this.menuHierarchy[e]=[];let t=document.getElementById(e+"MenuBg"),r=t.querySelectorAll(".contextMenuItem");for(let i of r)i.dataset.submenu&&this.menuHierarchy[e].push(i.dataset.submenu),i.addEventListener("pointerover",()=>{for(let u of r)delete u.dataset.active;i.dataset.active=!0,clearTimeout(this.submenuOpenTimer),i.dataset.submenu?this.submenuOpenTimer=setTimeout(()=>{this.openMenu(i.dataset.submenu)},300):this.menuHierarchy[e].length>0&&this.delayedCloseMenu(this.menuHierarchy[e][0])}),i.addEventListener("pointerleave",()=>{this.mouseOverSubmenu||(delete i.dataset.active,clearTimeout(this.submenuOpenTimer),i.dataset.submenu&&this.delayedCloseMenu(i.dataset.submenu))}),i.addEventListener("click",()=>{i.dataset.submenu&&!i.classList.contains("disabled")?this.openedMenu.id!==i.dataset.submenu+"MenuBg"?this.openMenu(i.dataset.submenu):document.getElementById(i.dataset.submenu+"MenuBg").focus():i.dataset.noClose||this.closeMenu(e)});t.addEventListener("focusout",i=>{top.ignoreFocusLoss||i.relatedTarget&&i.relatedTarget.dataset.submenuOf===e||this.closeMenu(e)}),t.addEventListener("pointermove",i=>{(i.clientX>0||i.clientY>0)&&(t.style.animation="none")})}for(let e of o){let t=document.getElementById(e+"MenuBg"),r=t.querySelectorAll(".contextMenuItem"),i=document.getElementById(t.dataset.submenuOf+"MenuBg"),u=Array.from(i.querySelectorAll(".contextMenuItem")).findIndex(s=>s.dataset.submenu===e),d=i.querySelectorAll(".contextMenuItem")[u];for(let s of r)s.addEventListener("pointerover",()=>{for(let v of r)delete v.dataset.active;s.dataset.active=!0}),s.addEventListener("pointerleave",()=>{delete s.dataset.active}),s.addEventListener("click",()=>{this.shouldNotCloseSubmenu=!1,this.closeMenu(e),this.closeMenu(t.dataset.submenuOf)});t.addEventListener("pointerover",()=>{this.mouseOverMenu=!0,this.mouseOverSubmenu=!0,this.shouldNotCloseSubmenu=!0,clearTimeout(this.submenuCloseTimer),d.dataset.active=!0}),t.addEventListener("pointerleave",()=>{this.mouseOverMenu=!1,this.mouseOverSubmenu=!1,this.shouldNotCloseSubmenu=!1}),t.addEventListener("focusout",s=>{if(top.ignoreFocusLoss||t.style.display==="none")return;this.shouldNotCloseSubmenu=!1;let v=!!t.dataset.openStandalone;s.relatedTarget&&s.relatedTarget.id&&s.relatedTarget.id===i.id||(this.closeMenu(e),!(s.relatedTarget&&s.relatedTarget.id&&s.relatedTarget.dataset.submenuOf===t.dataset.submenuOf)&&(v||this.closeMenu(t.dataset.submenuOf)))})}}openMenu(n,o){let e=document.getElementById(n+"MenuBg"),t=document.getElementById(n+"Menu"),r=!!e.dataset.submenuOf,i,u,d,s=e.querySelectorAll(".contextMenuItem.debug");if(localStorage.wmpotifyDebugMode){d=e.querySelectorAll(".contextMenuItem:not([data-hidden])");for(let p of s)p.style.display=""}else{d=e.querySelectorAll(".contextMenuItem:not([data-hidden]):not(.debug)");for(let p of s)p.style.display="none"}if(e.dispatchEvent(this.beforeMenuOpenEvent),o)e.dataset.openStandalone=!0;else{if(r){if(this.menuHierarchy[e.dataset.submenuOf].length>1)for(let h of this.menuHierarchy[e.dataset.submenuOf])h!==n&&this.closeMenu(h);if(i=document.getElementById(e.dataset.submenuOf+"MenuBg"),i.style.display==="none")return;let p=Array.from(i.querySelectorAll(".contextMenuItem")).findIndex(h=>h.dataset.submenu===n);if(u=i.querySelectorAll(".contextMenuItem")[p],u.classList.contains("disabled"))return}else for(let p of this.menuOrder)p!==n&&document.getElementById(p+"MenuBg").style.display==="block"&&this.closeMenu(p);delete e.dataset.openStandalone}e.style.animation="";for(let p of d)delete p.dataset.active;if(o)o.top&&(e.style.top=o.top),o.left&&(e.style.left=o.left),o.right&&(e.style.right=o.right),o.bottom&&(e.style.bottom=o.bottom);else{let p="",h=0;r&&(p=i.offsetTop+u.offsetTop,h=i.offsetLeft+i.offsetWidth-6),e.style.top=p+"px",e.style.left=h+"px"}e.style.display="block";let v=this.calcMenuWidth(n);e.style.width=v+")",e.style.minWidth=0,t.style.width=v+" - 2px)",e.style.height=this.calcMenuHeight(n)+"px",o||r&&(u.dataset.active=!0),e.focus(),this.openedMenu=e,document.addEventListener("keydown",this.boundMenuNavigationHandler)}closeMenu(n){let o=document.getElementById(n+"MenuBg"),e=!!o.dataset.openStandalone,t=!!o.dataset.submenuOf&&!e;if(t&&this.shouldNotCloseSubmenu)return;let r,i;if(!e&&t){r=document.getElementById(o.dataset.submenuOf+"MenuBg");let u=Array.from(r.querySelectorAll(".contextMenuItem")).findIndex(d=>d.dataset.submenu===n);i=r.querySelectorAll(".contextMenuItem")[u]}this.submenuCloseTimer&&clearTimeout(this.submenuCloseTimer),o.style.display="none",e?delete o.dataset.openStandalone:t&&delete i.dataset.active,o.dispatchEvent(this.afterMenuCloseEvent),t&&r.style.display!=="none"?(r.focus(),this.openedMenu=r):(this.openedMenu=null,document.removeEventListener("keydown",this.boundMenuNavigationHandler))}delayedCloseMenu(n){this.submenuCloseTimer=setTimeout(()=>{this.closeMenu(n)},300)}menuNavigationHandler(n){if(!this.openedMenu)return;let o;localStorage.wmpotifyDebugMode?o=this.openedMenu.querySelectorAll(".contextMenuItem"):o=this.openedMenu.querySelectorAll(".contextMenuItem:not(.debug)");let e=this.openedMenu.querySelector(".contextMenuItem[data-active]"),t=Array.from(o).indexOf(e),r;switch(this.openedMenu.dataset.submenuOf&&(r=document.getElementById(this.openedMenu.dataset.submenuOf+"MenuBg").querySelector(".contextMenuItem[data-active]")),this.handlingKeyEvent=!0,this.openedMenu.style.animation="none",n.key){case"Escape":this.mouseOverMenu=!1,this.openedMenu.blur();break;case"ArrowUp":e?(delete e.dataset.active,t>0?o[t-1].dataset.active=!0:o[o.length-1].dataset.active=!0):o[o.length-1].dataset.active=!0;break;case"ArrowDown":e?(delete e.dataset.active,t<o.length-1?o[t+1].dataset.active=!0:o[0].dataset.active=!0):o[0].dataset.active=!0;break;case"ArrowLeft":if(this.openedMenu.dataset.submenuOf){this.closeMenu(this.openedMenu.id.slice(0,-6),!0),r.dataset.active=!0;break}if(this.menuOrder.length===1)break;let i=this.menuOrder[(this.menuOrder.indexOf(this.openedMenu.id.slice(0,-6))+this.menuOrder.length-1)%this.menuOrder.length];this.closeMenu(this.openedMenu.id.slice(0,-6)),this.openMenu(i),this.openedMenu.querySelector(".contextMenuItem").dataset.active=!0;break;case"ArrowRight":if(e&&e.dataset.submenu){this.openMenu(e.dataset.submenu),this.openedMenu.querySelector(".contextMenuItem").dataset.active=!0;break}if(this.menuOrder.length===1)break;let u;this.openedMenu.dataset.submenuOf?(u=this.menuOrder[(this.menuOrder.indexOf(this.openedMenu.dataset.submenuOf)+1)%this.menuOrder.length],this.closeMenu(this.openedMenu.id.slice(0,-6))):(u=this.menuOrder[(this.menuOrder.indexOf(this.openedMenu.id.slice(0,-6))+1)%this.menuOrder.length],this.closeMenu(this.openedMenu.id.slice(0,-6))),this.openMenu(u),this.openedMenu.querySelector(".contextMenuItem").dataset.active=!0;break;case"Enter":if(e)e.click();else{this.openedMenu.blur();break}break;default:let d=this.openedMenu.getElementsByTagName("u");for(let s of d)if(n.key===s.textContent.toLowerCase()){s.parentElement.click();break}}this.handlingKeyEvent=!1,n.preventDefault(),n.stopPropagation()}calcMenuWidth(n){let o=document.getElementById(n+"MenuBg"),e;localStorage.wmpotifyDebugMode?e=o.querySelectorAll(".contextMenuItem:not([data-hidden])"):e=o.querySelectorAll(".contextMenuItem:not([data-hidden]):not(.debug)"),o.style.minWidth="";let t=parseInt(getComputedStyle(o).minWidth)||0;return`calc(${Array.from(e).reduce((i,u)=>{let d=u.textContent,s=Y(d);return Math.max(t,i,s)},0)}px + 4.5em`}calcMenuHeight(n){let o=document.getElementById(n+"MenuBg"),e=o.querySelectorAll("hr"),t;localStorage.wmpotifyDebugMode?t=o.querySelectorAll(".contextMenuItem:not([data-hidden])"):t=o.querySelectorAll(".contextMenuItem:not([data-hidden]):not(.debug)");let r=t[0].offsetHeight,i=0;if(e.length>0){let d=getComputedStyle(e[0]);i=e[0].offsetHeight+parseFloat(d.marginTop)+parseFloat(d.marginBottom)}return parseInt(t.length*r+e.length*i)}};function W(a,n,o){let e=document.createElement("div");return e.id=a+"MenuBg",e.className="contextMenuBg",e.tabIndex=-1,e.style.display="none",e.innerHTML=`<div id="${a}Menu" class="contextMenu"></div>`,o&&(e.dataset.submenuOf=o),n.forEach(t=>{if(t.hr){let i=document.createElement("hr");e.querySelector(".contextMenu").appendChild(i);return}let r=document.createElement("div");r.className="contextMenuItem",t.args?r.innerHTML="<p>"+se(t.text,...t.args)+"</p>":r.innerHTML="<p>"+se(t.text)+"</p>",t.classList&&r.classList.add(...t.classList),t.disabled&&r.classList.add("disabled"),t.hidden&&(r.dataset.hidden=!0),t.submenu&&(r.dataset.submenu=t.submenu,r.innerHTML+='<p class="submenuMark">\u23F5</p>'),t.noClose&&(r.dataset.noClose=!0),r.addEventListener("click",t.click),e.querySelector(".contextMenu").appendChild(r)}),document.body.appendChild(e),{menuBg:e,menu:e.querySelector(".contextMenu"),menuItems:e.querySelectorAll(".contextMenuItem")}}function Y(a,n=getComputedStyle(document.documentElement).getPropertyValue("--menu-font")){let e=(Y.canvas||(Y.canvas=document.createElement("canvas"))).getContext("2d");return e.font=n,e.measureText(a).width}function se(a){if(a=a.replace(/&([^&])/g,"<u>$1</u>").replace(/\\&/g,"&"),arguments.length>1)for(let n=1;n<arguments.length;n++)a=a.replace(/%s/,arguments[n]),a=a.replace(`%${n}s`,arguments[n]);return a}var N=1;function he(a){N=a||1}function be(){let a=t=>{t&&(t._updateUiClient?.updateTitlebarHeight&&t._updateUiClient.updateTitlebarHeight({height:N}),t._updateUiClient?.setButtonsVisibility&&N<=1&&t._updateUiClient.setButtonsVisibility(!1),window.addEventListener("beforeunload",()=>{t._updateUiClient?.setButtonsVisibility&&t._updateUiClient.setButtonsVisibility({showButtons:!0})})),Spicetify.CosmosAsync.post("sp://messages/v1/container/control",{type:"update_titlebar",height:N+"px"})};a(Spicetify.Platform.ControlMessageAPI),a(Spicetify.Platform.UpdateAPI);async function n(){a(Spicetify.Platform.ControlMessageAPI),a(Spicetify.Platform.UpdateAPI)}let o=setInterval(n,100);setTimeout(()=>{clearInterval(o)},1e4);let e=()=>{a(Spicetify.Platform.ControlMessageAPI),a(Spicetify.Platform.UpdateAPI)};document.addEventListener("fullscreenchange",e),window.addEventListener("resize",()=>{setTimeout(()=>{e()},100)})}var k=ControlManager={init:be,setControlHeight:he};function R(a,n){if(!a||isNaN(a))return"00:00";let o=Math.floor(a/1e3),e=Math.floor(o/60);if(o=String(o%60).padStart(2,"0"),e<60)return n&&(e=String(e).padStart(2,"0")),`${e}:${o}`;let t=Math.floor(e/60);return e=String(e%60).padStart(2,"0"),n&&(t=String(t).padStart(2,"0")),`${t}:${e}:${o}`}function G(){if(!document.querySelector("#queue-panel")||document.querySelector("#wmpotify-queue-toolbar")||document.querySelectorAll('div[data-encore-id="tabPanel"]').length>2)return;let a=document.querySelector("#Desktop_PanelContainer_Id"),n=document.querySelector("#Desktop_PanelContainer_Id > div > div:first-child > div:first-child"),o=document.querySelector("#Desktop_PanelContainer_Id > div > div:nth-child(2)"),e=document.createElement("div");e.id="wmpotify-queue-toolbar";let t=document.createElement("button");t.id="wmpotify-queue-playlist-button",t.classList.add("wmpotify-toolbar-button"),t.addEventListener("click",()=>{window.open(Spicetify.Player.data.context.uri)}),t.textContent=document.querySelector('#queue-panel div[data-flip-id*="section-header-"] a')?.textContent||"Now Playing",t.innerHTML+='<span class="expandMark">\u23F7</span>',e.appendChild(t);let r=document.createElement("button");r.id="wmpotify-queue-clear-button",r.classList.add("wmpotify-toolbar-button"),r.addEventListener("click",()=>{Spicetify.Platform.PlayerAPI.clearQueue(),Spicetify.Player.playUri("")}),e.appendChild(r),o.insertAdjacentElement("afterbegin",e);let i=getComputedStyle(document.documentElement).getPropertyValue("--album-art-placeholder").trim().slice(5,-2),u=document.createElement("div");u.id="wmpotify-queue-npv";let d=document.createElement("img");d.id="wmpotify-queue-album-art",d.src=document.querySelector(".main-nowPlayingWidget-coverArt .cover-art img")?.src||i,u.appendChild(d);let s=document.createElement("div");s.id="wmpotify-queue-song-title",s.textContent=document.querySelector(".main-trackInfo-name")?.textContent||"No items",u.appendChild(s),n.insertAdjacentElement("afterbegin",u),ue(),new MutationObserver(ue).observe(document.querySelector("#queue-panel"),{childList:!0});let v=document.querySelectorAll('#Desktop_PanelContainer_Id div[role="tablist"] button'),p=[],h;for(let g of v)p.push({text:g.textContent,click:function(){for(let T of h.menuItems)T.classList.remove("activeStyle");this.classList.add("activeStyle"),g.click()}});p[0].classList=["activeStyle"],document.querySelector("#wmpotifyQueueTabMenuBg")?.remove(),h=W("wmpotifyQueueTab",p);let $=new C(["wmpotifyQueueTab"]);a.addEventListener("contextmenu",g=>{g.preventDefault(),$.openMenu("wmpotifyQueueTab",{left:g.clientX+"px",top:g.clientY+"px"})}),Spicetify.Player.addEventListener("songchange",()=>{t.textContent=Spicetify.Player.data?.context?.metadata?.context_description||"Now Playing",t.innerHTML+='<span class="expandMark">\u23F7</span>',d.src=Spicetify.Player.data?.item?.album?.images?.[0]?.url?.replace("spotify:image:","https://i.scdn.co/image/")||i,s.textContent=Spicetify.Player.data?.item?.name||"No items"})}function ue(){let a=document.querySelectorAll("#queue-panel ul")[1];a&&(ce(),new MutationObserver(ce).observe(a,{childList:!0}))}function ce(){if(!document.querySelector("#queue-panel")||!Spicetify.Queue)return;let a=document.querySelectorAll("#queue-panel li .HeaderArea");for(let n=0;n<a.length;n++){let o=a[n];if(o.querySelector(".wmpotify-queue-duration"))continue;let e=n===0?Spicetify.Queue.track?.contextTrack?.metadata?.duration:Spicetify.Queue.nextTracks?.[n-1]?.contextTrack?.metadata?.duration;if(!e)continue;let t=document.createElement("span");t.classList.add("wmpotify-queue-duration"),t.textContent=R(e),o.appendChild(t)}}function ge(a,n){return this.canvas=this.canvas||document.createElement("canvas"),this.canvas.width=1,this.canvas.height=1,this.context=this.context||this.canvas.getContext("2d"),this.context.fillStyle="#EEF3FA",this.context.filter=`hue-rotate(${a}deg) saturate(${n}%)`,this.context.fillRect(0,0,1,1),"rgba("+this.context.getImageData(0,0,1,1).data+")"}function I(a,n){if(!a&&!n){document.documentElement.style.setProperty("--spice-main","#EEF3FA"),document.documentElement.style.removeProperty("--wmpotify-tint-hue"),document.documentElement.style.removeProperty("--wmpotify-tint-sat");return}document.documentElement.style.setProperty("--spice-main",ge(a,n)),document.documentElement.style.setProperty("--wmpotify-tint-hue",a+"deg"),document.documentElement.style.setProperty("--wmpotify-tint-sat",n/100)}var m=document.createElement("div"),w=null,J=0,b={title:null,hue:null,sat:null};function ve(){if(document.getElementById("wmpotify-config"))return;let a=document.querySelector(".Root__main-view");m.id="wmpotify-config",m.innerHTML=`
        <div id="wmpotify-config-topborder"></div>
        <button id="wmpotify-config-prev"></button>
        <button id="wmpotify-config-next"></button>
        <p id="wmpotify-config-title">Color Chooser</p>
        <button id="wmpotify-config-close"></button>
        <section class="wmpotify-config-tab-content" data-tab-title="Color Chooser" style="display: block;">
            <a href="#" id="wmpotify-config-color-reset">Reset</a><br>
            <label>Hue</label><br>
            <input type="range" id="wmpotify-config-hue" class="wmpotify-aero no-track" min="0" max="360" step="1" value="180"><br>
            <label>Saturation</label><br>
            <input type="range" id="wmpotify-config-sat" class="wmpotify-aero no-track" min="0" max="354" step="1" value="121"><br>
        </section>
        <section class="wmpotify-config-tab-content" data-tab-title="General">
            <label for="wmpotify-config-style">Style</label>
            <select id="wmpotify-config-style" class="wmpotify-aero">
                <option value="xp">XP</option>
                <option value="aero">Aero</option>
                <option value="basic">Basic</option>
            </select><br>
            <label for="wmpotify-config-title-style">Title style</label>
            <select id="wmpotify-config-title-style" class="wmpotify-aero">
                <option value="auto">Auto</option>
                <option value="native">Native</option>
                <option value="custom">Custom</option>
                <option value="spotify">Spotify</option>
                <option value="keepmenu">Keep Menu</option>
            </select><br>
            <input type="checkbox" id="wmpotify-config-show-libx" class="wmpotify-aero">
            <label for="wmpotify-config-show-libx">Show Your Library X on the left sidebar</label><br>
            <button id="wmpotify-config-apply" class="wmpotify-aero">Apply</button>
        </section>
        <section class="wmpotify-config-tab-content" data-tab-title="About">
            <span style="color: lightgray;">WMPotify for Spicetify by Ingan121</span><br>
            <a href="https://github.com/Ingan121/WMPotify" target="_blank">GitHub</a>
        </section>
    `,m.querySelector("#wmpotify-config-close").addEventListener("click",Z),m.querySelector("#wmpotify-config-apply").addEventListener("click",fe),w=m.querySelectorAll(".wmpotify-config-tab-content"),b.title=m.querySelector("#wmpotify-config-title"),b.hue=m.querySelector("#wmpotify-config-hue"),b.sat=m.querySelector("#wmpotify-config-sat"),b.hue.addEventListener("input",de),b.sat.addEventListener("input",de),m.querySelector("#wmpotify-config-color-reset").addEventListener("click",Se),m.querySelector("#wmpotify-config-prev").addEventListener("click",me),m.querySelector("#wmpotify-config-next").addEventListener("click",pe),localStorage.wmpotifyStyle&&(m.querySelector("#wmpotify-config-style").value=localStorage.wmpotifyStyle);let n=m.querySelector("#wmpotify-config-title-style");navigator.userAgent.includes("Windows")||n.querySelector("option[value=keepmenu]").remove(),navigator.userAgent.includes("Linux")&&n.querySelector("option[value=spotify]").remove(),localStorage.wmpotifyTitleStyle&&(n.value=localStorage.wmpotifyTitleStyle),localStorage.wmpotifyShowLibX&&(m.querySelector("#wmpotify-config-show-libx").checked=!0),a.appendChild(m)}function we(){if(w){if(m.style.display==="block"){Z();return}if(m.style.display="block",localStorage.wmpotifyTintColor){let[a,n]=localStorage.wmpotifyTintColor.split(",");b.hue.value=(a+180)%360,b.sat.value=n*121/100}}}function Z(){m.style.display="none"}function ee(a){if(w){for(let n=0;n<w.length;n++){let o=w[n];o.style.display=n===a?"block":"none"}J=a,b.title.textContent=w[a].dataset.tabTitle}}function me(){ee((J-1+w.length)%w.length)}function pe(){ee((J+1)%w.length)}function de(){let a=b.hue.value-180,n=b.sat.value*100/121;b.sat.style.filter=`hue-rotate(${a}deg)`,I(a,n),localStorage.wmpotifyTintColor=a+","+n}function Se(){b.hue.value=180,b.sat.value=121,I(),delete localStorage.wmpotifyTintColor}function fe(){let a=m.querySelector("#wmpotify-config-style").value,n=m.querySelector("#wmpotify-config-title-style").value,o=m.querySelector("#wmpotify-config-show-libx").checked;localStorage.wmpotifyStyle=a,n!=="auto"?localStorage.wmpotifyTitleStyle=n:delete localStorage.wmpotifyTitleStyle,o?localStorage.wmpotifyShowLibX=!0:delete localStorage.wmpotifyShowLibX,location.reload()}var te=Config={init:ve,open:we,close:Z,openTab:ee,prevTab:me,nextTab:pe,apply:fe,isOpen:()=>m.style.display==="block"};(function(){let a=[".Root__globalNav",".main-globalNav-historyButtons",".main-globalNav-searchSection",".main-globalNav-searchContainer > button",".main-globalNav-searchContainer div form button",".main-topBar-searchBar",'.custom-navlinks-scrollable_container div[role="presentation"] > button',".main-topBar-topbarContentRight > .main-actionButtons > button",".main-topBar-topbarContentRight > button:last-child",".Root__main-view",".player-controls__left",'.player-controls__buttons button[data-testid="control-button-skip-back"]','.player-controls__buttons button[data-testid="control-button-repeat"]','.player-controls__buttons button[data-testid="control-button-playpause"]',".player-controls__right",".playback-bar .encore-text",".volume-bar",".volume-bar__icon-button",".volume-bar .progress-bar",".main-nowPlayingBar-left",".Root__right-sidebar div[class]"],n={"Your Library":"Library","Friend Activity":"Friends"};async function o(){switch(localStorage.wmpotifyShowLibX||(document.body.dataset.hideLibx=!0),localStorage.wmpotifyStyle){case"xp":case"aero":break;case void 0:localStorage.wmpotifyStyle="xp";break;case"basic":document.hasFocus()?document.body.style.backgroundColor="var(--active-title)":document.body.style.backgroundColor="var(--inactive-title)",window.addEventListener("focus",()=>{document.body.style.backgroundColor="var(--active-title)"}),window.addEventListener("blur",()=>{document.body.style.backgroundColor="var(--inactive-title)"});break;default:document.body.style.backgroundColor=localStorage.wmpotifyStyle}document.documentElement.dataset.wmpotifyStyle=localStorage.wmpotifyStyle||"xp";let t="spotify";switch(localStorage.wmpotifyTitleStyle&&["native","custom","spotify","keepmenu"].includes(localStorage.wmpotifyTitleStyle)?t=localStorage.wmpotifyTitleStyle:window.outerHeight-window.innerHeight>0?t="native":window.SpotEx&&(t="custom"),t==="keepmenu"&&!navigator.userAgent.includes("Windows")&&(t="spotify"),t==="spotify"&&navigator.userAgent.includes("Linux")&&(t="native"),document.documentElement.dataset.wmpotifyTitleStyle=t,t){case"native":k.setControlHeight(0);break;case"custom":k.setControlHeight(0);case"keepmenu":let l=document.createElement("div");if(l.id="wmpotify-title-buttons",window.SpotEx){let E=document.createElement("button");E.id="wmpotify-minimize-button",E.addEventListener("click",()=>{SpotEx.updateWindow({state:"minimized"})}),l.appendChild(E);let q=document.createElement("button");q.id="wmpotify-maximize-button",q.addEventListener("click",async()=>{(await SpotEx.getWindow()).state==="maximized"?SpotEx.updateWindow({state:"normal"}):SpotEx.updateWindow({state:"maximized"})}),l.appendChild(q),window.addEventListener("resize",async()=>{(await SpotEx.getWindow()).state==="maximized"?q.dataset.maximized=!0:delete q.dataset.maximized})}let c=document.createElement("button");c.id="wmpotify-close-button",c.addEventListener("click",()=>{window.close()}),l.appendChild(c);case"spotify":let f=document.createElement("div");f.id="wmpotify-title-bar";let y=document.createElement("div");y.id="wmpotify-title-icon",y.addEventListener("dblclick",()=>{window.close()}),document.body.appendChild(y);let H=document.createElement("span");H.id="wmpotify-title-text",H.textContent=await Spicetify.AppTitle.get(),f.appendChild(H),(t==="custom"||t==="keepmenu")&&f.appendChild(l),(t==="keepmenu"||t==="spotify")&&k.setControlHeight(25),document.body.appendChild(f),Spicetify.AppTitle.sub(E=>{H.textContent=E});break}if(localStorage.wmpotifyTintColor){let[l,c]=localStorage.wmpotifyTintColor.split(",");I(l,c)}k.init();let r=document.querySelector(".Root__globalNav"),i=document.createElement("div");i.id="wmpotify-tabs-container",r.insertBefore(i,r.querySelector(".main-globalNav-searchSection"));let u=document.querySelector(".main-globalNav-searchContainer > button");O(u);let d=document.querySelector(".main-globalNav-searchContainer div form button");O(d);let s=[u,d],v=document.querySelectorAll('.custom-navlinks-scrollable_container div[role="presentation"] > button');for(let l of v)O(l),s.push(l);let p=document.querySelectorAll(".main-topBar-topbarContentRight > .main-actionButtons > button");for(let l of p)O(l),s.push(l);let h=[];for(let l of s)h.push({text:l.querySelector(".wmpotify-tab-label").textContent,click:()=>l.click()});W("wmpotifyTab",h);let $=new C(["wmpotifyTab"]),g=document.createElement("button");g.id="wmpotify-tabs-overflow-button",g.addEventListener("click",()=>{$.openMenu("wmpotifyTab",{top:"0",left:g.getBoundingClientRect().left+"px"})}),i.appendChild(g),_(),setTimeout(_,1e3),window.addEventListener("resize",_);let T=document.querySelector(".main-topBar-topbarContentRight > button:last-child"),z=document.createElement("span");z.textContent=T.getAttribute("aria-label"),z.classList.add("wmpotify-user-label"),T.appendChild(z);let F=document.createElement("div");F.id="wmpotify-search-container";let B=document.createElement("div");B.id="wmpotify-search-wrapper";let Q=document.querySelector(".main-topBar-searchBar");B.appendChild(Q);let L=document.createElement("button");L.id="wmpotify-search-clear-button",L.setAttribute("aria-label","Clear search"),L.addEventListener("click",()=>{Q.value="",Q.focus(),window.open("spotify:search")}),B.appendChild(L),F.appendChild(B),r.appendChild(F),te.init(),new Spicetify.Menu.Item("WMPotify Properties",!1,te.open).register();let D=document.querySelector(".player-controls__buttons button[data-testid='control-button-playpause']");Spicetify.Player.addEventListener("onplaypause",j),new MutationObserver(j).observe(D,{attributes:!0,attributeFilter:["aria-label"]}),ae(),new MutationObserver(ae).observe(document.querySelector(".main-nowPlayingBar-left"),{childList:!0});let S=document.querySelector(".player-controls__left"),ne=document.querySelector('.player-controls__buttons button[data-testid="control-button-skip-back"]'),oe=document.querySelector('.player-controls__buttons button[data-testid="control-button-repeat"]');S.insertBefore(oe,ne);let P=document.createElement("button");P.setAttribute("aria-label","Stop"),P.id="wmpotify-stop-button",P.addEventListener("click",()=>{Spicetify.Platform.PlayerAPI.clearQueue(),Spicetify.Player.playUri("")}),S.insertBefore(P,ne);let ye=document.querySelector(".player-controls__right"),U=document.querySelector(".volume-bar"),A=U.querySelector(".volume-bar__icon-button"),ie=U.querySelector(".progress-bar");le(),new MutationObserver(le).observe(ie,{attributes:!0,attributeFilter:["style"]}),ye.appendChild(U);let V=document.querySelectorAll(".playback-bar .encore-text"),X=document.createElement("div");X.classList.add("wmpotify-time-text-container");let M=document.createElement("span");M.classList.add("wmpotify-time-text");let x=parseInt(localStorage.wmpotifyTimeTextMode||0);re(),M.dataset.mode=x,M.addEventListener("click",()=>{x=(x+1)%3,M.dataset.mode=x,localStorage.wmpotifyTimeTextMode=x}),X.appendChild(M),S.insertAdjacentElement("afterbegin",X),Spicetify.Player.addEventListener("onprogress",re);let K=new MutationObserver(()=>{let l=S.children.length;l!==4&&(K.disconnect(),S.insertBefore(S.children[l-2],oe),K.observe(S,{childList:!0}))});K.observe(S,{childList:!0}),G(),new MutationObserver(G).observe(document.querySelector(".Root__right-sidebar div[class]"),{childList:!0});function O(l){i.appendChild(l);let c=document.createElement("span"),f=l.getAttribute("aria-label");c.textContent=n[f]||f,c.classList.add("wmpotify-tab-label"),l.appendChild(c)}function _(){let l=document.querySelector(".main-globalNav-historyButtons").getBoundingClientRect().right,c=window.innerWidth-document.querySelector(".main-topBar-topbarContentRight").getBoundingClientRect().left,f=160,y=0;for(;window.innerWidth-l-c-f<i.getBoundingClientRect().width&&y<s.length;)s[s.length-1-y++].dataset.hidden=!0;for(y=document.querySelectorAll("#wmpotify-tabs-container button[data-hidden]").length;y>0&&window.innerWidth-l-c-f>i.getBoundingClientRect().width;)delete s[s.length-y--].dataset.hidden;g.style.display=y>0?"block":""}globalThis.handleTabOverflow=_;function ae(){j();let l=document.querySelector(".main-nowPlayingWidget-trackInfo");if(!l||document.querySelector(".wmpotify-track-info"))return;let c=document.createElement("p");c.classList.add("wmpotify-track-info"),c.textContent=document.querySelector(".main-trackInfo-name")?.textContent||"",l.appendChild(c);let f=1;setInterval(()=>{if(!Spicetify.Player.isPlaying())return;let y=Spicetify.Player.data?.item.metadata;y&&(f===0?c.textContent=y.title:f===1?c.textContent=y.artist_name:f===2&&(c.textContent=y.album_title),f=(f+1)%3)},3e3),Spicetify.Player.addEventListener("songchange",()=>{f=0,c.textContent=Spicetify.Player.data?.item.metadata.title})}function j(){Spicetify.Player.isPlaying()?D.classList.add("playing"):D.classList.remove("playing")}function le(){let l=getComputedStyle(ie).getPropertyValue("--progress-bar-transform").replace("%","")/100;l===0?A.dataset.vol="muted":l<=.3?A.dataset.vol="low":l<=.6?A.dataset.vol="mid":A.dataset.vol="high"}function re(){switch(x){case 0:{let l=Spicetify.Player.data?.item?.metadata?.duration-Spicetify.Player.getProgress();M.textContent=R(l,!0)}break;case 1:{let l=V[0].textContent;(l.length===4||l.length===7)&&(l="0"+l),M.textContent=l}break;case 2:{let l=V[0].textContent;(l.length===4||l.length===7)&&(l="0"+l);let c=V[1].textContent;(c.length===4||c.length===7)&&(c="0"+c),M.textContent=`${l} / ${c}`}break}}}function e(){return window.Spicetify&&window.Spicetify.CosmosAsync&&window.Spicetify.Platform?.PlayerAPI&&window.Spicetify.AppTitle&&window.Spicetify.Player?.origin?._state&&window.Spicetify.Menu&&a.every(t=>document.querySelector(t))}window.addEventListener("load",()=>{let t=0,r=setInterval(()=>{if(e())o(),console.log("WMPotify: Theme loaded"),clearInterval(r);else if(t++>100){alert("[WMPotify] Theme loading failed. Please refresh the page to try again. Please make sure you have compatible Spoitfy version and have global navbar enabled."),clearInterval(r);let i=[];for(let u of a)document.querySelector(u)||i.push(u);console.log("WMPotify: Missing elements:",i)}},100)})})();})();
