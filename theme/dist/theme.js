"use strict";(()=>{var ee=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,i)=>(typeof require<"u"?require:t)[i]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var Ct={identifier:"en-US",UI_OK:"OK",UI_CANCEL:"Cancel",UI_APPLY:"Apply",UI_RESET:"Reset",UI_AUTO:"Auto",UI_CUSTOM:"Custom",UI_CLICK_HERE:"click here",MAIN_MSG_ERROR_LOAD_FAIL:"Theme loading failed. Please refresh the page to try again. Please make sure you have a compatible version of Spotify installed.",MAIN_MSG_ERROR_INIT:"An error occurred during initialization. Please check the console for more information.",MAIN_MSG_ERROR_INCOMPAT_EXT:"Incompatible extension %s detected! Some features of WMPotify will be disabled.",TAB_NOW_PLAYING:"Now Playing",TAB_LIBRARY:"Library",PB_BTN_MINI_MODE:"Mini mode",PB_BTN_FULLSCREEN:"Full screen",LIBX_SIDEBAR_ROOT:"Library",LIBX_HEADER_ROOT:"Music",QUEUE_CURRENT_PLAYLIST_PLACEHOLDER:"Now Playing",MENU_CONF:"WMPotify Properties",CONF_COLOR_TITLE:"Color Chooser",CONF_COLOR_HUE:"Hue",CONF_COLOR_SAT:"Saturation",CONF_COLOR_TINTPB:"Apply color to the now playing bar buttons",CONF_GENERAL_TITLE:"General",CONF_GENERAL_STYLE:"Style",CONF_GENERAL_TITLE_STYLE:"Title style",CONF_GENERAL_TITLE_STYLE_NATIVE:"Native",CONF_GENERAL_TITLE_STYLE_CUSTOM:"Custom",CONF_GENERAL_TITLE_STYLE_KEEPMENU:"Keep Menu",CONF_GENERAL_FONT:"UI font",CONF_GENERAL_CUSTOM_FONT_DLG_TITLE:"Set custom font",CONF_GENERAL_CUSTOM_FONT_MSG:"Enter a valid CSS font-family name",CONF_GENERAL_SHOW_LIBX:"Show Your Library X on the left sidebar",CONF_SPEED_TITLE:"Play speed settings",CONF_SPEED_SLOW:"Slow",CONF_SPEED_NORMAL:"Normal",CONF_SPEED_FAST:"Fast",CONF_SPEED_CURRENT_LABEL:"Play speed",CONF_SPEED_CUSTOM_DLG_TITLE:"Set playback speed",CONF_SPEED_CUSTOM_MSG:"Enter a playback speed (0.5 - 5.0)",CONF_SPEED_NO_CONNECT_MSG:"Cannot change playback speed while playing from another device",CONF_ABOUT_TITLE:"About",CONF_ABOUT_DESC:"A Windows Media Player 11 inspired Spicetify theme for Spotify",CONF_ABOUT_VERSION:"Version",CONF_ABOUT_AUTHOR:"Made by Ingan121",WMPVIS_INSTALL_TITLE:"Install WMPotify NowPlaying?",WMPVIS_INSTALL_DESC:"WMPotify NowPlaying features WMP-like visualization screen and lyrics overlaid on top of it. We recommend installing it for the best experience with WMPotify.",WMPVIS_INSTALL_STEPS:"To install it, please follow these steps:",WMPVIS_INSTALL_STEP1:"Copy the following code:",WMPVIS_INSTALL_STEP2:"Press Win+R to open the Run dialog",WMPVIS_INSTALL_STEP3:"Paste the code and press Enter",WMPVIS_INSTALL_MORE_INFO:"Or %s for more information, including manual installation instructions.",WMPVIS_INSTALL_HIDE:"If you don't want to install it, %s to hide this button.",WMPVIS_INSTALL_CODE_COPY:"Code copied to clipboard!"},Ze=Ct;var vt={identifier:"ko-KR",UI_OK:"\uD655\uC778",UI_CANCEL:"\uCDE8\uC18C",UI_APPLY:"\uC801\uC6A9",UI_RESET:"\uC7AC\uC124\uC815",UI_AUTO:"\uC790\uB3D9",UI_CUSTOM:"\uC0AC\uC6A9\uC790 \uC815\uC758",UI_CLICK_HERE:"\uC5EC\uAE30\uB97C \uD074\uB9AD",MAIN_MSG_ERROR_LOAD_FAIL:"\uD14C\uB9C8 \uB85C\uB4DC\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4. \uD398\uC774\uC9C0\uB97C \uC0C8\uB85C \uACE0\uCCD0 \uB2E4\uC2DC \uC2DC\uB3C4\uD558\uC2ED\uC2DC\uC624. \uD638\uD658 \uAC00\uB2A5\uD55C \uBC84\uC804\uC758 Spotify\uAC00 \uC124\uCE58\uB418\uC5B4 \uC788\uB294\uC9C0 \uD655\uC778\uD558\uC2ED\uC2DC\uC624.",MAIN_MSG_ERROR_INIT:"\uD14C\uB9C8 \uB85C\uB4DC \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4. \uC790\uC138\uD55C \uB0B4\uC6A9\uC740 \uCF58\uC194\uC744 \uD655\uC778\uD558\uC2ED\uC2DC\uC624.",MAIN_MSG_ERROR_INCOMPAT_EXT:"\uD638\uD658\uB418\uC9C0 \uC54A\uB294 \uD655\uC7A5 \uD504\uB85C\uADF8\uB7A8 %s\uC774(\uAC00) \uAC10\uC9C0\uB418\uC5C8\uC2B5\uB2C8\uB2E4! WMPotify\uC758 \uC77C\uBD80 \uAE30\uB2A5\uC774 \uBE44\uD65C\uC131\uD654\uB429\uB2C8\uB2E4.",TAB_NOW_PLAYING:"\uC9C0\uAE08 \uC7AC\uC0DD",TAB_LIBRARY:"\uB77C\uC774\uBE0C\uB7EC\uB9AC",PB_BTN_MINI_MODE:"\uBBF8\uB2C8 \uBAA8\uB4DC",PB_BTN_FULLSCREEN:"\uC804\uCCB4 \uD654\uBA74",LIBX_SIDEBAR_ROOT:"\uB77C\uC774\uBE0C\uB7EC\uB9AC",LIBX_HEADER_ROOT:"\uC74C\uC545",QUEUE_CURRENT_PLAYLIST_PLACEHOLDER:"\uC9C0\uAE08 \uC7AC\uC0DD",MENU_CONF:"WMPotify \uC18D\uC131",CONF_COLOR_TITLE:"\uC0C9 \uC120\uD0DD",CONF_COLOR_HUE:"\uC0C9\uC0C1",CONF_COLOR_SAT:"\uCC44\uB3C4",CONF_COLOR_TINTPB:"\uC9C0\uAE08 \uC7AC\uC0DD \uB9C9\uB300\uC758 \uBC84\uD2BC\uC5D0 \uC0C9\uC0C1 \uC801\uC6A9",CONF_GENERAL_TITLE:"\uC77C\uBC18",CONF_GENERAL_STYLE:"\uC2A4\uD0C0\uC77C",CONF_GENERAL_TITLE_STYLE:"\uC81C\uBAA9 \uC2A4\uD0C0\uC77C",CONF_GENERAL_TITLE_STYLE_NATIVE:"\uAE30\uBCF8",CONF_GENERAL_TITLE_STYLE_CUSTOM:"\uC0AC\uC6A9\uC790 \uC815\uC758",CONF_GENERAL_TITLE_STYLE_KEEPMENU:"\uBA54\uB274 \uC720\uC9C0",CONF_GENERAL_FONT:"UI \uAE00\uAF34",CONF_GENERAL_CUSTOM_FONT_DLG_TITLE:"\uC0AC\uC6A9\uC790 \uC815\uC758 \uAE00\uAF34 \uC124\uC815",CONF_GENERAL_CUSTOM_FONT_MSG:"\uC62C\uBC14\uB978 CSS font-family \uC774\uB984 \uC785\uB825",CONF_GENERAL_SHOW_LIBX:"\uC67C\uCABD \uC0AC\uC774\uB4DC\uBC14\uC5D0 \uB77C\uC774\uBE0C\uB7EC\uB9AC X \uD45C\uC2DC",CONF_SPEED_TITLE:"\uC7AC\uC0DD \uC18D\uB3C4 \uC124\uC815",CONF_SPEED_SLOW:"\uB290\uB9AC\uAC8C",CONF_SPEED_NORMAL:"\uBCF4\uD1B5",CONF_SPEED_FAST:"\uBE60\uB974\uAC8C",CONF_SPEED_CURRENT_LABEL:"\uC7AC\uC0DD \uC18D\uB3C4",CONF_SPEED_CUSTOM_DLG_TITLE:"\uC7AC\uC0DD \uC18D\uB3C4 \uC124\uC815",CONF_SPEED_CUSTOM_MSG:"\uC7AC\uC0DD \uC18D\uB3C4\uB97C \uC785\uB825\uD558\uC2ED\uC2DC\uC624 (0.5 - 5.0)",CONF_SPEED_NO_CONNECT_MSG:"\uB2E4\uB978 \uC7A5\uCE58\uC5D0\uC11C \uC7AC\uC0DD \uC911\uC77C \uB54C\uB294 \uC7AC\uC0DD \uC18D\uB3C4\uB97C \uBCC0\uACBD\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4",CONF_ABOUT_TITLE:"\uC815\uBCF4",CONF_ABOUT_DESC:"Spotify\uC6A9 Windows Media Player 11 \uD14C\uB9C8",CONF_ABOUT_VERSION:"\uBC84\uC804",CONF_ABOUT_AUTHOR:"\uC81C\uC791: Ingan121",WMPVIS_INSTALL_TITLE:"WMPotify NowPlaying\uC744 \uC124\uCE58\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?",WMPVIS_INSTALL_DESC:"WMPotify NowPlaying\uC740 WMP\uC640 \uAC19\uC740 \uC2DC\uAC01\uD654 \uD654\uBA74\uACFC \uADF8 \uC704\uC5D0 \uD45C\uC2DC\uB418\uB294 \uAC00\uC0AC \uCC3D\uC744 \uC81C\uACF5\uD569\uB2C8\uB2E4. WMPotify\uB97C \uCD5C\uC0C1\uC758 \uACBD\uD5D8\uC73C\uB85C \uC0AC\uC6A9\uD558\uB824\uBA74 WMPotify NowPlaying \uC124\uCE58\uB97C \uAD8C\uC7A5\uD569\uB2C8\uB2E4.",WMPVIS_INSTALL_STEPS:"\uC124\uCE58\uD558\uB824\uBA74 \uB2E4\uC74C \uB2E8\uACC4\uB97C \uB530\uB974\uC2ED\uC2DC\uC624:",WMPVIS_INSTALL_STEP1:"\uB2E4\uC74C \uCF54\uB4DC\uB97C \uBCF5\uC0AC\uD558\uC2ED\uC2DC\uC624:",WMPVIS_INSTALL_STEP2:"Win+R\uC744 \uB20C\uB7EC \uC2E4\uD589 \uB300\uD654 \uC0C1\uC790\uB97C \uC5FD\uB2C8\uB2E4",WMPVIS_INSTALL_STEP3:"\uCF54\uB4DC\uB97C \uBD99\uC5EC\uB123\uACE0 \uC5D4\uD130 \uD0A4\uB97C \uB204\uB985\uB2C8\uB2E4",WMPVIS_INSTALL_MORE_INFO:"\uB610\uB294 \uC218\uB3D9 \uC124\uCE58 \uC9C0\uCE68\uC744 \uD3EC\uD568\uD55C \uC790\uC138\uD55C \uC815\uBCF4\uB97C \uBCF4\uB824\uBA74 %s\uD558\uC2ED\uC2DC\uC624.",WMPVIS_INSTALL_HIDE:"\uC124\uCE58\uD558\uC9C0 \uC54A\uC73C\uB824\uBA74 %s\uD558\uC5EC \uC774 \uBC84\uD2BC\uC744 \uC228\uAE30\uC2ED\uC2DC\uC624.",WMPVIS_INSTALL_CODE_COPY:"\uCF54\uB4DC\uAC00 \uD074\uB9BD\uBCF4\uB4DC\uC5D0 \uBCF5\uC0AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4!"},et=vt;var Pe={"en-US":"English","ko-KR":"\uD55C\uAD6D\uC5B4"},X=navigator.language;if(!(X in Pe)){for(let e in Pe)if(X.slice(0,2)===e.slice(0,2)){X=e;break}X in Pe||(X="en-US")}var me={"en-US":Ze,"ko-KR":et},te=me[X]||me["en-US"];te.getString=Lt;te.processString=xe;var u=te;function Lt(e){return te[e]?xe(te[e],...Array.from(arguments).slice(1)):me["en-US"][e]?(console.info(`Fallback string used for locId ${e}`),xe(me["en-US"][e],...Array.from(arguments).slice(1))):(console.error(`No string found for locId ${e}`),e)}function xe(e){if(e=e.replace(/&([^&])/g,"<u>$1</u>").replace(/\\&/g,"&"),arguments.length>1)for(let t=1;t<arguments.length;t++)e=e.replace(/%s/,arguments[t]),e=e.replace(`%${t}s`,arguments[t]);return e}var fe=1,Tt={setControlHeight(e){fe=e||1},init(){if(Spicetify.Config.extensions.includes("noControls.js")){Spicetify.showNotification("[WMPotify] "+u.getString("MAIN_MSG_ERROR_INCOMPAT_EXT","No Controls"));return}let e=o=>{o&&(o._updateUiClient?.updateTitlebarHeight&&o._updateUiClient.updateTitlebarHeight({height:fe}),o._updateUiClient?.setButtonsVisibility&&fe<=1&&o._updateUiClient.setButtonsVisibility(!1),window.addEventListener("beforeunload",()=>{o._updateUiClient?.setButtonsVisibility&&o._updateUiClient.setButtonsVisibility({showButtons:!0})})),Spicetify.CosmosAsync.post("sp://messages/v1/container/control",{type:"update_titlebar",height:fe+"px"})};e(Spicetify.Platform.ControlMessageAPI),e(Spicetify.Platform.UpdateAPI);async function t(){e(Spicetify.Platform.ControlMessageAPI),e(Spicetify.Platform.UpdateAPI)}let i=setInterval(t,100);setTimeout(()=>{clearInterval(i)},1e4);let n=()=>{e(Spicetify.Platform.ControlMessageAPI),e(Spicetify.Platform.UpdateAPI)};document.addEventListener("fullscreenchange",n),window.addEventListener("resize",()=>{setTimeout(()=>{n()},100)})}},Y=Tt;var Oe=document.createElement("canvas");Oe.width=1;Oe.height=1;var pe=Oe.getContext("2d");function _t(e,t){return pe.fillStyle="#EEF3FA",pe.filter=`hue-rotate(${e}deg) saturate(${t}%)`,pe.fillRect(0,0,1,1),"rgba("+pe.getImageData(0,0,1,1).data+")"}function ne(e,t,i){if(!e&&!t){document.documentElement.style.setProperty("--spice-main","#EEF3FA"),document.documentElement.style.removeProperty("--wmpotify-tint-hue"),document.documentElement.style.removeProperty("--wmpotify-tint-sat");return}let n=document.querySelector(".main-nowPlayingBar-nowPlayingBar");n&&(i?n.classList.add("tinted"):n.classList.remove("tinted")),document.documentElement.style.setProperty("--spice-main",_t(e,t)),document.documentElement.style.setProperty("--wmpotify-tint-hue",e+"deg"),document.documentElement.style.setProperty("--wmpotify-tint-sat",t/100)}var y=null,Ne=1,Mt={init(){return It()},query(){return y?y.query():null},extendFrame(e,t,i,n){y?.extendFrame&&([e,t,i,n]=[e,t,i,n].map(o=>Math.round(o*window.devicePixelRatio)),Ne>1&&([e,t]=[e&&e-1,t&&t-1],[i,n]=[i&&i-1,n&&n-1]),y.extendFrame(e,t,i,n))},minimize(){y?.minimize&&y.minimize()},maximizeRestore(){y?.maximizeRestore&&y.maximizeRestore()},close(){y?.close&&y.close()},setLayered(e,t,i){y?.setLayered&&y.setLayered(e,t,i)},setBackdrop(e){y?.setBackdrop&&y.setBackdrop(e)},resizeTo(e,t){y?.resizeTo&&y.resizeTo(e,t)},setMinSize(e,t){y?.setMinSize&&([e,t]=[e,t].map(i=>Math.round(i*window.devicePixelRatio)),y.setMinSize(e,t))},setTopMost(e){y?.setTopMost&&y.setTopMost(e)},setTitle(e){y?.setTitle&&y.setTitle(e)},lockTitle(e){y?.lockTitle&&y.lockTitle(e)},openSpotifyMenu(){y?.openSpotifyMenu&&y.openSpotifyMenu()},setPlaybackSpeed(e){y?.setPlaybackSpeed&&y.setPlaybackSpeed(parseFloat(e))},available(){return!!y},getModule(){return y}};function It(){if(navigator.userAgent.includes("Windows"))try{y=window.cancelEsperantoCall("ctewh"),Ne=y.query().dpi/96;let{version:e,initialOptions:t}=y;return console.log(`CEF/Spotify Tweaks Windhawk mod available, Version: ${e}`),window.addEventListener("resize",()=>{Ne=y.query().dpi/96}),{version:e,initialOptions:t}}catch{y=null,console.log("Windhawk mod not available")}}var p=Mt;async function nt(e){let t=p.query();switch(e){case"native":Y.setControlHeight(0);break;case"custom":Y.setControlHeight(0);case"keepmenu":let i=document.createElement("div");if(i.id="wmpotify-title-buttons",window.SpotEx||t){let l=document.createElement("button");l.id="wmpotify-minimize-button",l.addEventListener("click",()=>{window.SpotEx?SpotEx.updateWindow({state:"minimized"}):p.minimize()}),i.appendChild(l);let s=document.createElement("button");s.id="wmpotify-maximize-button",s.addEventListener("click",async()=>{window.SpotEx?(await SpotEx.getWindow()).state==="maximized"?SpotEx.updateWindow({state:"normal"}):SpotEx.updateWindow({state:"maximized"}):p.maximizeRestore()}),i.appendChild(s),window.addEventListener("resize",async()=>{window.SpotEx?(await SpotEx.getWindow()).state==="maximized"?s.dataset.maximized=!0:delete s.dataset.maximized:p.query().isMaximized?s.dataset.maximized=!0:delete s.dataset.maximized})}let n=document.createElement("button");n.id="wmpotify-close-button",n.addEventListener("click",()=>{tt()}),i.appendChild(n);case"spotify":let o=document.createElement("div");o.id="wmpotify-title-bar";let a=document.createElement("div");a.id="wmpotify-title-icon",a.addEventListener("dblclick",()=>{tt()}),o.appendChild(a);let r=document.createElement("span");r.id="wmpotify-title-text",r.textContent=await Spicetify.AppTitle.get(),o.appendChild(r),(e==="custom"||e==="keepmenu")&&o.appendChild(i),(e==="keepmenu"||e==="spotify")&&Y.setControlHeight(25),document.body.appendChild(o),Spicetify.AppTitle.sub(l=>{r.textContent=l});break}}async function tt(){p.available()?p.close():window.close()}var K=class{constructor(t=[],i=[]){this.menuOrder=t,this.submenus=i,this.openedMenu=null,this.mouseOverMenu=!1,this.mouseOverSubmenu=!1,this.handlingPointerEvent=!1,this.handlingKeyEvent=!1,this.boundMenuNavigationHandler=this.menuNavigationHandler.bind(this),this.submenuOpenTimer=null,this.submenuCloseTimer=null,this.shouldNotCloseSubmenu=!1,this.menuHierarchy={},this.beforeMenuOpenEvent=new Event("beforemenuopen"),this.afterMenuCloseEvent=new Event("aftermenuclose");for(let n of t){this.menuHierarchy[n]=[];let o=document.getElementById(n+"MenuBg"),a=o.querySelectorAll(".contextMenuItem");for(let r of a)r.dataset.submenu&&this.menuHierarchy[n].push(r.dataset.submenu),r.addEventListener("pointerover",()=>{for(let l of a)delete l.dataset.active;r.dataset.active=!0,clearTimeout(this.submenuOpenTimer),r.dataset.submenu?this.submenuOpenTimer=setTimeout(()=>{this.openMenu(r.dataset.submenu)},300):this.menuHierarchy[n].length>0&&this.delayedCloseMenu(this.menuHierarchy[n][0])}),r.addEventListener("pointerleave",()=>{this.mouseOverSubmenu||(delete r.dataset.active,clearTimeout(this.submenuOpenTimer),r.dataset.submenu&&this.delayedCloseMenu(r.dataset.submenu))}),r.addEventListener("click",()=>{r.dataset.submenu&&!r.classList.contains("disabled")?this.openedMenu.id!==r.dataset.submenu+"MenuBg"?this.openMenu(r.dataset.submenu):document.getElementById(r.dataset.submenu+"MenuBg").focus():r.dataset.noClose||this.closeMenu(n)});o.addEventListener("focusout",r=>{top.ignoreFocusLoss||r.relatedTarget&&r.relatedTarget.dataset.submenuOf===n||this.closeMenu(n)}),o.addEventListener("pointermove",r=>{(r.clientX>0||r.clientY>0)&&(o.style.animation="none")})}for(let n of i){let o=document.getElementById(n+"MenuBg"),a=o.querySelectorAll(".contextMenuItem"),r=document.getElementById(o.dataset.submenuOf+"MenuBg"),l=Array.from(r.querySelectorAll(".contextMenuItem")).findIndex(c=>c.dataset.submenu===n),s=r.querySelectorAll(".contextMenuItem")[l];for(let c of a)c.addEventListener("pointerover",()=>{for(let d of a)delete d.dataset.active;c.dataset.active=!0}),c.addEventListener("pointerleave",()=>{delete c.dataset.active}),c.addEventListener("click",()=>{this.shouldNotCloseSubmenu=!1,this.closeMenu(n),this.closeMenu(o.dataset.submenuOf)});o.addEventListener("pointerover",()=>{this.mouseOverMenu=!0,this.mouseOverSubmenu=!0,this.shouldNotCloseSubmenu=!0,clearTimeout(this.submenuCloseTimer),s.dataset.active=!0}),o.addEventListener("pointerleave",()=>{this.mouseOverMenu=!1,this.mouseOverSubmenu=!1,this.shouldNotCloseSubmenu=!1}),o.addEventListener("focusout",c=>{if(top.ignoreFocusLoss||o.style.display==="none")return;this.shouldNotCloseSubmenu=!1;let d=!!o.dataset.openStandalone;c.relatedTarget&&c.relatedTarget.id&&c.relatedTarget.id===r.id||(this.closeMenu(n),!(c.relatedTarget&&c.relatedTarget.id&&c.relatedTarget.dataset.submenuOf===o.dataset.submenuOf)&&(d||this.closeMenu(o.dataset.submenuOf)))})}}openMenu(t,i){let n=document.getElementById(t+"MenuBg"),o=document.getElementById(t+"Menu"),a=!!n.dataset.submenuOf,r,l,s,c=n.querySelectorAll(".contextMenuItem.debug");if(localStorage.wmpotifyDebugMode){s=n.querySelectorAll(".contextMenuItem:not([data-hidden])");for(let m of c)m.style.display=""}else{s=n.querySelectorAll(".contextMenuItem:not([data-hidden]):not(.debug)");for(let m of c)m.style.display="none"}if(n.dispatchEvent(this.beforeMenuOpenEvent),i)n.dataset.openStandalone=!0;else{if(a){if(this.menuHierarchy[n.dataset.submenuOf].length>1)for(let S of this.menuHierarchy[n.dataset.submenuOf])S!==t&&this.closeMenu(S);if(r=document.getElementById(n.dataset.submenuOf+"MenuBg"),r.style.display==="none")return;let m=Array.from(r.querySelectorAll(".contextMenuItem")).findIndex(S=>S.dataset.submenu===t);if(l=r.querySelectorAll(".contextMenuItem")[m],l.classList.contains("disabled"))return}else for(let m of this.menuOrder)m!==t&&document.getElementById(m+"MenuBg").style.display==="block"&&this.closeMenu(m);delete n.dataset.openStandalone}n.style.animation="";for(let m of s)delete m.dataset.active;if(i)i.top&&(n.style.top=i.top),i.left&&(n.style.left=i.left),i.right&&(n.style.right=i.right),i.bottom&&(n.style.bottom=i.bottom);else{let m="",S=0;a&&(m=r.offsetTop+l.offsetTop,S=r.offsetLeft+r.offsetWidth-6),n.style.top=m+"px",n.style.left=S+"px"}n.style.display="block";let d=this.calcMenuWidth(t);n.style.width=d+")",n.style.minWidth=0,o.style.width=d+" - 2px)",n.style.height=this.calcMenuHeight(t)+"px",i||a&&(l.dataset.active=!0),n.focus(),this.openedMenu=n,document.addEventListener("keydown",this.boundMenuNavigationHandler)}closeMenu(t){let i=document.getElementById(t+"MenuBg"),n=!!i.dataset.openStandalone,o=!!i.dataset.submenuOf&&!n;if(o&&this.shouldNotCloseSubmenu)return;let a,r;if(!n&&o){a=document.getElementById(i.dataset.submenuOf+"MenuBg");let l=Array.from(a.querySelectorAll(".contextMenuItem")).findIndex(s=>s.dataset.submenu===t);r=a.querySelectorAll(".contextMenuItem")[l]}this.submenuCloseTimer&&clearTimeout(this.submenuCloseTimer),i.style.display="none",n?delete i.dataset.openStandalone:o&&delete r.dataset.active,i.dispatchEvent(this.afterMenuCloseEvent),o&&a.style.display!=="none"?(a.focus(),this.openedMenu=a):(this.openedMenu=null,document.removeEventListener("keydown",this.boundMenuNavigationHandler))}delayedCloseMenu(t){this.submenuCloseTimer=setTimeout(()=>{this.closeMenu(t)},300)}menuNavigationHandler(t){if(!this.openedMenu)return;let i;localStorage.wmpotifyDebugMode?i=this.openedMenu.querySelectorAll(".contextMenuItem"):i=this.openedMenu.querySelectorAll(".contextMenuItem:not(.debug)");let n=this.openedMenu.querySelector(".contextMenuItem[data-active]"),o=Array.from(i).indexOf(n),a;switch(this.openedMenu.dataset.submenuOf&&(a=document.getElementById(this.openedMenu.dataset.submenuOf+"MenuBg").querySelector(".contextMenuItem[data-active]")),this.handlingKeyEvent=!0,this.openedMenu.style.animation="none",t.key){case"Escape":this.mouseOverMenu=!1,this.openedMenu.blur();break;case"ArrowUp":n?(delete n.dataset.active,o>0?i[o-1].dataset.active=!0:i[i.length-1].dataset.active=!0):i[i.length-1].dataset.active=!0;break;case"ArrowDown":n?(delete n.dataset.active,o<i.length-1?i[o+1].dataset.active=!0:i[0].dataset.active=!0):i[0].dataset.active=!0;break;case"ArrowLeft":if(this.openedMenu.dataset.submenuOf){this.closeMenu(this.openedMenu.id.slice(0,-6),!0),a.dataset.active=!0;break}if(this.menuOrder.length===1)break;let r=this.menuOrder[(this.menuOrder.indexOf(this.openedMenu.id.slice(0,-6))+this.menuOrder.length-1)%this.menuOrder.length];this.closeMenu(this.openedMenu.id.slice(0,-6)),this.openMenu(r),this.openedMenu.querySelector(".contextMenuItem").dataset.active=!0;break;case"ArrowRight":if(n&&n.dataset.submenu){this.openMenu(n.dataset.submenu),this.openedMenu.querySelector(".contextMenuItem").dataset.active=!0;break}if(this.menuOrder.length===1)break;let l;this.openedMenu.dataset.submenuOf?(l=this.menuOrder[(this.menuOrder.indexOf(this.openedMenu.dataset.submenuOf)+1)%this.menuOrder.length],this.closeMenu(this.openedMenu.id.slice(0,-6))):(l=this.menuOrder[(this.menuOrder.indexOf(this.openedMenu.id.slice(0,-6))+1)%this.menuOrder.length],this.closeMenu(this.openedMenu.id.slice(0,-6))),this.openMenu(l),this.openedMenu.querySelector(".contextMenuItem").dataset.active=!0;break;case"Enter":if(n)n.click();else{this.openedMenu.blur();break}break;default:let s=this.openedMenu.getElementsByTagName("u");for(let c of s)if(t.key===c.textContent.toLowerCase()){c.parentElement.click();break}}this.handlingKeyEvent=!1,t.preventDefault(),t.stopPropagation()}calcMenuWidth(t){let i=document.getElementById(t+"MenuBg"),n;localStorage.wmpotifyDebugMode?n=i.querySelectorAll(".contextMenuItem:not([data-hidden])"):n=i.querySelectorAll(".contextMenuItem:not([data-hidden]):not(.debug)"),i.style.minWidth="";let o=parseInt(getComputedStyle(i).minWidth)||0;return`calc(${Array.from(n).reduce((r,l)=>{let s=l.textContent,c=Ae(s);return Math.max(o,r,c)},0)}px + 4.5em`}calcMenuHeight(t){let i=document.getElementById(t+"MenuBg"),n=i.querySelectorAll("hr"),o;localStorage.wmpotifyDebugMode?o=i.querySelectorAll(".contextMenuItem:not([data-hidden])"):o=i.querySelectorAll(".contextMenuItem:not([data-hidden]):not(.debug)");let a=o[0].offsetHeight,r=0;if(n.length>0){let s=getComputedStyle(n[0]);r=n[0].offsetHeight+parseFloat(s.marginTop)+parseFloat(s.marginBottom)}return parseInt(o.length*a+n.length*r)}};function ye(e,t,i){let n=document.createElement("div");return n.id=e+"MenuBg",n.className="contextMenuBg",n.tabIndex=-1,n.style.display="none",n.innerHTML=`<div id="${e}Menu" class="contextMenu"></div>`,i&&(n.dataset.submenuOf=i),t.forEach(o=>{if(o.hr){let r=document.createElement("hr");n.querySelector(".contextMenu").appendChild(r);return}let a=document.createElement("div");a.className="contextMenuItem",o.args?a.innerHTML="<p>"+it(o.text,...o.args)+"</p>":a.innerHTML="<p>"+it(o.text)+"</p>",o.classList&&a.classList.add(...o.classList),o.disabled&&a.classList.add("disabled"),o.hidden&&(a.dataset.hidden=!0),o.submenu&&(a.dataset.submenu=o.submenu,a.innerHTML+='<p class="submenuMark">\u23F5</p>'),o.noClose&&(a.dataset.noClose=!0),a.addEventListener("click",o.click),n.querySelector(".contextMenu").appendChild(a)}),document.body.appendChild(n),{menuBg:n,menu:n.querySelector(".contextMenu"),menuItems:n.querySelectorAll(".contextMenuItem")}}function Ae(e,t=getComputedStyle(document.documentElement).getPropertyValue("--menu-font")){let n=(Ae.canvas||(Ae.canvas=document.createElement("canvas"))).getContext("2d");return n.font=t,n.measureText(e).width}function it(e){if(e=e.replace(/&([^&])/g,"<u>$1</u>").replace(/\\&/g,"&"),arguments.length>1)for(let t=1;t<arguments.length;t++)e=e.replace(/%s/,arguments[t]),e=e.replace(`%${t}s`,arguments[t]);return e}var H,F=[],Q,Pt={"Friend Activity":"Friends"};function ot(){let e=document.querySelector(".Root__globalNav");H=document.createElement("div"),H.id="wmpotify-tabs-container",e.insertBefore(H,e.querySelector(".main-globalNav-searchSection"));let t=document.querySelector('.custom-navlinks-scrollable_container div[role="presentation"] > button:has(#wmpotify-nowplaying-icon)');t||(t=document.createElement("button"),t.addEventListener("click",()=>{if(Spicetify.Config.custom_apps.includes("wmpvis"))Spicetify.Platform.History.push({pathname:"/wmpvis"});else{let b=document.createElement("div");b.id="wmpotify-wmpvis-install-dialog",b.innerHTML=`
                    <p>${u.WMPVIS_INSTALL_DESC}</p><br>
                    <img src="https://www.ingan121.com/files3/Spotify_aVCKRF1XOt.png" alt="WMPotify NowPlaying screenshot"><br><br>
                    <p>${u.WMPVIS_INSTALL_STEPS}</p><br>
                    <ol>
                        <li>1. ${u.WMPVIS_INSTALL_STEP1}</li>
                        <div class="wmpotify-code-container">
                            <button id="wmpotify-copy-code">
                                <svg viewBox="0 0 16 16" fill="currentColor" width="16" height="16">
                                    ${Spicetify.SVGIcons.copy}
                                </svg>
                            </button>
                            <code>powershell -command "$install=\\"wmpvis\\";iwr -useb <a href='https://raw.githubusercontent.com/Ingan121/WMPotify/master/install/install.ps1'>https://raw.githubusercontent.com/Ingan121/WMPotify/master/install/install.ps1</a> | iex"</code>
                        </div>
                        <li>2. ${u.WMPVIS_INSTALL_STEP2}</li>
                        <li>3. ${u.WMPVIS_INSTALL_STEP3}</li>
                    </ol><br>
                    <p>${u.getString("WMPVIS_INSTALL_MORE_INFO",`<a href="https://github.com/Ingan121/WMPotify">${u.UI_CLICK_HERE}</a>`)}</p>
                    <p>${u.getString("WMPVIS_INSTALL_HIDE",`<a href="javascript:localStorage.wmpotifyNoWmpvis=true;document.querySelector('#wmpotify-tabs-container button[data-identifier=now-playing]').dataset.hidden=true;Spicetify.PopupModal.hide()">${u.UI_CLICK_HERE}</a>`)}</p>
                `,Spicetify.PopupModal.display({title:u.WMPVIS_INSTALL_TITLE,content:b}),document.querySelector("#wmpotify-copy-code").addEventListener("click",()=>{Spicetify.Platform.ClipboardAPI.copy('powershell -command "$install=\\"wmpvis\\";iwr -useb https://raw.githubusercontent.com/Ingan121/WMPotify/master/install/install.ps1 | iex"'),Spicetify.showNotification("Code copied to clipboard!")})}}),localStorage.wmpotifyNoWmpvis&&!Spicetify.Config.custom_apps.includes("wmpvis")&&(t.dataset.hidden=!0)),t.setAttribute("aria-label",u.TAB_NOW_PLAYING),t.dataset.identifier="now-playing",j(t);let i=document.querySelector(".main-globalNav-searchContainer > button");i.dataset.identifier="home",j(i);let n=document.querySelector(".main-globalNav-searchContainer div form button");n.dataset.identifier="search",n.addEventListener("click",b=>{window.open("spotify:search"),b.preventDefault(),b.stopPropagation()}),j(n);let o=document.createElement("button");o.id="wmpotify-library-button",o.dataset.identifier="library",o.setAttribute("aria-label",u.TAB_LIBRARY),o.addEventListener("click",()=>{Spicetify.Platform.History.push({pathname:"/wmpotify-standalone-libx"})}),j(o),F=[t,i,n,o];let a=document.querySelectorAll('.custom-navlinks-scrollable_container div[role="presentation"] > button');for(let b of a)j(b),F.push(b);let r=document.querySelectorAll(".main-topBar-topbarContentRight > .main-actionButtons > button");for(let b of r)j(b),F.push(b);let l=[];for(let b of F)l.push({text:b.querySelector(".wmpotify-tab-label").textContent,click:()=>b.click()});ye("wmpotifyTab",l);let s=new K(["wmpotifyTab"]);Q=document.createElement("button"),Q.id="wmpotify-tabs-overflow-button",Q.addEventListener("click",()=>{s.openMenu("wmpotifyTab",{top:"0",left:Q.getBoundingClientRect().left+"px"})}),H.appendChild(Q),he(),setTimeout(he,1e3),window.addEventListener("resize",he),document.addEventListener("fullscreenchange",he);let c=document.querySelector(".main-topBar-topbarContentRight > button:last-child"),d=document.createElement("span");d.textContent=c.getAttribute("aria-label"),d.classList.add("wmpotify-user-label"),c.appendChild(d);let m=document.createElement("div");m.id="wmpotify-search-container";let S=document.createElement("div");S.id="wmpotify-search-wrapper";let L=document.querySelector('.main-globalNav-searchContainer div form input[type="search"]');S.appendChild(L);let x=document.createElement("button");x.id="wmpotify-search-clear-button",x.setAttribute("aria-label","Clear search"),x.addEventListener("click",()=>{L.value="",L.focus(),window.open("spotify:search")}),S.appendChild(x),m.appendChild(S),e.appendChild(m),e.addEventListener("pointerdown",b=>{b.button===2&&!b.target.closest("input")&&p.openSpotifyMenu()});let g=getComputedStyle(document.documentElement).getPropertyValue("--right-sidebar-width");g&&document.documentElement.style.setProperty("--panel-width",g)}function j(e){H.appendChild(e);let t=document.createElement("span"),i=e.getAttribute("aria-label");t.textContent=Pt[i]||i,t.classList.add("wmpotify-tab-label"),e.appendChild(t)}function he(){let e=document.querySelector(".main-globalNav-historyButtons").getBoundingClientRect().right,t=window.innerWidth-document.querySelector(".main-topBar-topbarContentRight").getBoundingClientRect().left,i=160,n=0;for(;window.innerWidth-e-t-i<H.getBoundingClientRect().width&&n<F.length;)F[F.length-1-n++].dataset.hidden=!0;for(n=document.querySelectorAll("#wmpotify-tabs-container button[data-hidden]").length;n>0&&window.innerWidth-e-t-i>H.getBoundingClientRect().width;)delete F[F.length-n--].dataset.hidden;Q.style.display=n>0?"block":""}function Se(e,t){if(!e||isNaN(e))return"00:00";let i=Math.floor(e/1e3),n=Math.floor(i/60);if(i=String(i%60).padStart(2,"0"),n<60)return t&&(n=String(n).padStart(2,"0")),`${n}:${i}`;let o=Math.floor(n/60);return n=String(n%60).padStart(2,"0"),t&&(o=String(o).padStart(2,"0")),`${o}:${n}:${i}`}function Be(e,t,i,n){return new Promise((o,a)=>{let r=document.createElement("div");r.id="wmpotify-prompt-modal";let l=document.createElement("p");l.textContent=t,r.appendChild(l);let s=document.createElement("input");s.classList.add("wmpotify-aero"),s.type="text",s.value=i,s.placeholder=n,s.style.width="100%",r.appendChild(s);let c=document.createElement("div");c.classList.add("wmpotify-modal-bottom-buttons");let d=document.createElement("button");d.classList.add("wmpotify-aero"),d.textContent="OK",d.addEventListener("click",()=>{o(s.value),Spicetify.PopupModal.hide()}),c.appendChild(d);let m=document.createElement("button");m.classList.add("wmpotify-aero"),m.textContent="Cancel",m.addEventListener("click",()=>{o(null),Spicetify.PopupModal.hide()}),c.appendChild(m),r.appendChild(c),Spicetify.PopupModal.display({title:e,content:r});let S=new MutationObserver(()=>{document.contains(r)||(S.disconnect(),o(null))});S.observe(document.body,{childList:!0})})}var at={};(function e(t,i,n){function o(l,s){if(!i[l]){if(!t[l]){var c=typeof ee=="function"&&ee;if(!s&&c)return c(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var m=i[l]={exports:{}};t[l][0].call(m.exports,function(S){var L=t[l][1][S];return o(L||S)},m,m.exports,e,t,i,n)}return i[l].exports}for(var a=typeof ee=="function"&&ee,r=0;r<n.length;r++)o(n[r]);return o})({1:[function(e,t,i){var n,o,a;n=function(r,l){var s;return s=setTimeout(l,r),{stop:function(){return clearTimeout(s)}}},a=function(r,l){var s;return s=setInterval(l,r),{stop:function(){return clearInterval(s)}}},o=function(r){return/in/.test(document.readyState)?n(10,function(){return o(r)}):r()},function(r){var l,s,c,d,m,S,L,x,g,b,$;return l=r.FontDetective={},S=["serif","sans-serif","cursive","fantasy","monospace"],x="Helvetica,Lucida Grande,Lucida Sans,Tahoma,Arial,Geneva,Monaco,Verdana,Microsoft Sans Serif,Trebuchet MS,Courier New,Times New Roman,Courier,Lucida Bright,Lucida Sans Typewriter,URW Chancery L,Comic Sans MS,Georgia,Palatino Linotype,Lucida Sans Unicode,Times,Century Schoolbook L,URW Gothic L,Franklin Gothic Medium,Lucida Console,Impact,URW Bookman L,Helvetica Neue,Nimbus Sans L,URW Palladio L,Nimbus Mono L,Nimbus Roman No9 L,Arial Black,Sylfaen,MV Boli,Estrangelo Edessa,Tunga,Gautami,Raavi,Mangal,Shruti,Latha,Kartika,Vrinda,Arial Narrow,Century Gothic,Garamond,Book Antiqua,Bookman Old Style,Calibri,Cambria,Candara,Corbel,Monotype Corsiva,Cambria Math,Consolas,Constantia,MS Reference Sans Serif,MS Mincho,Segoe UI,Arial Unicode MS,Tempus Sans ITC,Kristen ITC,Mistral,Meiryo UI,Juice ITC,Papyrus,Bradley Hand ITC,French Script MT,Malgun Gothic,Microsoft YaHei,Gisha,Leelawadee,Microsoft JhengHei,Haettenschweiler,Microsoft Himalaya,Microsoft Uighur,MoolBoran,Jokerman,DFKai-SB,KaiTi,SimSun-ExtB,Freestyle Script,Vivaldi,FangSong,MingLiU-ExtB,MingLiU_HKSCS,MingLiU_HKSCS-ExtB,PMingLiU-ExtB,Copperplate Gothic Light,Copperplate Gothic Bold,Copperplate Gothic,Franklin Gothic Book,Maiandra GD,Perpetua,Eras Demi ITC,Felix Titling,Franklin Gothic Demi,Pristina,Edwardian Script ITC,OCR A Extended,OCR A,Engravers MT,Eras Light ITC,Franklin Gothic Medium Cond,Rockwell Extra Bold,Rockwell,Curlz MT,Blackadder ITC,Franklin Gothic Heavy,Franklin Gothic Demi Cond,Lucida Handwriting,Segoe UI Light,Segoe UI Semibold,Lucida Calligraphy,Cooper Black,Viner Hand ITC,Britannic Bold,Wide Latin,Old English Text MT,Broadway,Footlight MT Light,Harrington,Snap ITC,Onyx,Playbill,Bauhaus 93,Baskerville Old Face,Algerian,Matura MT Script Capitals,Stencil,Batang,Chiller,Harlow Solid Italic,Kunstler Script,Bernard MT Condensed,Informal Roman,Vladimir Script,Bell MT,Colonna MT,High Tower Text,Californian FB,Ravie,Segoe Script,Brush Script MT,SimSun,Arial Rounded MT Bold,Berlin Sans FB,Centaur,Niagara Solid,Showcard Gothic,Niagara Engraved,Segoe Print,Gabriola,Gill Sans MT,Iskoola Pota,Calisto MT,Script MT Bold,Century Schoolbook,Berlin Sans FB Demi,Magneto,Arabic Typesetting,DaunPenh,Mongolian Baiti,DokChampa,Euphemia,Kalinga,Microsoft Yi Baiti,Nyala,Bodoni MT Poster Compressed,Goudy Old Style,Imprint MT Shadow,Gill Sans MT Condensed,Gill Sans Ultra Bold,Palace Script MT,Lucida Fax,Gill Sans MT Ext Condensed Bold,Goudy Stout,Eras Medium ITC,Rage Italic,Rockwell Condensed,Castellar,Eras Bold ITC,Forte,Gill Sans Ultra Bold Condensed,Perpetua Titling MT,Agency FB,Tw Cen MT,Gigi,Tw Cen MT Condensed,Aparajita,Gloucester MT Extra Condensed,Tw Cen MT Condensed Extra Bold,PMingLiU,Bodoni MT,Bodoni MT Black,Bodoni MT Condensed,MS Gothic,GulimChe,MS UI Gothic,MS PGothic,Gulim,MS PMincho,BatangChe,Dotum,DotumChe,Gungsuh,GungsuhChe,MingLiU,NSimSun,SimHei,DejaVu Sans,DejaVu Sans Condensed,DejaVu Sans Mono,DejaVu Serif,DejaVu Serif Condensed,Eurostile,Matisse ITC,Bitstream Vera Sans Mono,Bitstream Vera Sans,Staccato222 BT,Bitstream Vera Serif,Broadway BT,ParkAvenue BT,Square721 BT,Calligraph421 BT,MisterEarl BT,Cataneo BT,Ruach LET,Rage Italic LET,La Bamba LET,Blackletter686 BT,John Handy LET,Scruff LET,Westwood LET,Yu Gothic,Yu Gothic UI".split(",").sort(),$=[],d=!1,g=!1,c=document.createElement("div"),c.id="font-detective",s=function(){function E(T,C,w){this.name=T,this.type=C,this.style=w}return E.prototype.toString=function(){return'"'+this.name.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},E}(),m=function(){var E,T,C,w;return E=["monospace","sans-serif","serif"],w=document.createElement("span"),w.innerHTML="mmmmmmmmmmlli",w.style.fontSize="72px",C={},T={},{init:function(){var _,M,q,O;for(document.body.appendChild(c),O=[],M=0,q=E.length;M<q;M++)_=E[M],w.style.fontFamily=_,c.appendChild(w),C[_]=w.offsetWidth,T[_]=w.offsetHeight,O.push(c.removeChild(w));return O},check:function(_){var M,q,O,D;for(O=0,D=E.length;O<D;O++)if(M=E[O],w.style.fontFamily=_+", "+M,c.appendChild(w),q=w.offsetWidth!==C[M]||w.offsetHeight!==T[M],c.removeChild(w),q)return!0;return!1}}}(),L=function(){if(!g)return g=!0,l.incomplete=!0,o(function(E){return function(){var T;return b(function(){var C,w,_;for(_=[],C=0,w=x.length;C<w;C++)T=x[C],_.push(new s(T));return _}())}}(this))},b=function(E){var T,C;return m.init(),T=0,C=a(20,function(){var w,_,M,q,O,D,Qe,Je,Me,Ie;for(q=0;q<=5;q++){if(M=E[T],w=m.check(M),w)for($.push(M),Me=l.each.callbacks,O=0,Qe=Me.length;O<Qe;O++)_=Me[O],_(M);if(T++,T>=E.length){for(C.stop(),Ie=l.all.callbacks,D=0,Je=Ie.length;D<Je;D++)_=Ie[D],_($);l.all.callbacks=[],l.each.callbacks=[],d=!0;return}}})},l.preload=L,l.each=function(E){var T,C,w;for(C=0,w=$.length;C<w;C++)T=$[C],E(T);if(!d)return l.each.callbacks.push(E),L()},l.each.callbacks=[],l.all=function(E){return d?E($):(l.all.callbacks.push(E),L())},l.all.callbacks=[]}(at)},{}]},{},[1]);var rt=at.FontDetective;var h=document.createElement("div"),R=null,qe=0,be=null,f={title:null,hue:null,sat:null};function xt(){if(document.getElementById("wmpotify-config"))return;let e=document.querySelector(".Root__main-view");if(h.id="wmpotify-config",h.innerHTML=`
        <div id="wmpotify-config-topborder" class="wmpotify-tintable"></div>
        <button id="wmpotify-config-prev"></button>
        <button id="wmpotify-config-next"></button>
        <p id="wmpotify-config-title">${u.CONF_COLOR_TITLE}</p>
        <button id="wmpotify-config-close"></button>
        <section class="wmpotify-config-tab-content" data-tab-title="${u.CONF_COLOR_TITLE}" style="display: block;">
            <section class="field-row">
                <a href="#" id="wmpotify-config-color-reset">${u.UI_RESET}</a>
                <input type="checkbox" id="wmpotify-config-tint-playerbar" class="wmpotify-aero">
                <label for="wmpotify-config-tint-playerbar">${u.CONF_COLOR_TINTPB}</label>
            </section>
            <label>${u.CONF_COLOR_HUE}</label><br>
            <input type="range" id="wmpotify-config-hue" class="wmpotify-aero no-track" min="0" max="360" step="1" value="180"><br>
            <label>${u.CONF_COLOR_SAT}</label><br>
            <input type="range" id="wmpotify-config-sat" class="wmpotify-aero no-track" min="0" max="354" step="1" value="121"><br>
        </section>
        <section class="wmpotify-config-tab-content" data-tab-title="${u.CONF_GENERAL_TITLE}">
            <label for="wmpotify-config-style">${u.CONF_GENERAL_STYLE}</label>
            <select id="wmpotify-config-style" class="wmpotify-aero">
                <option value="auto">${u.UI_AUTO}</option>
                <option value="xp">XP</option>
                <option value="aero">Aero</option>
                <option value="basic">Basic</option>
            </select>
            <label for="wmpotify-config-title-style">${u.CONF_GENERAL_TITLE_STYLE}</label>
            <select id="wmpotify-config-title-style" class="wmpotify-aero">
                <option value="auto">${u.UI_AUTO}</option>
                <option value="native">${u.CONF_GENERAL_TITLE_STYLE_NATIVE}</option>
                <option value="custom">${u.CONF_GENERAL_TITLE_STYLE_CUSTOM}</option>
                <option value="spotify">Spotify</option>
                <option value="keepmenu">${u.CONF_GENERAL_TITLE_STYLE_KEEPMENU}</option>
            </select><br>
            <label for="wmpotify-config-font">${u.CONF_GENERAL_FONT}</label>
            <select id="wmpotify-config-font" class="wmpotify-aero">
                <option value="custom">${u.UI_CUSTOM}</option>
            </select><br>
            <input type="checkbox" id="wmpotify-config-show-libx" class="wmpotify-aero">
            <label for="wmpotify-config-show-libx">${u.CONF_GENERAL_SHOW_LIBX}</label><br>
            <button id="wmpotify-config-apply" class="wmpotify-aero">${u.UI_APPLY}</button>
        </section>
        <section class="wmpotify-config-tab-content" data-tab-title="${u.CONF_SPEED_TITLE}" data-wh-speedmod-required="true">
            <a href="#" id="wmpotify-config-speed-slow">${u.CONF_SPEED_SLOW}</a>
            <a href="#" id="wmpotify-config-speed-normal">${u.CONF_SPEED_NORMAL}</a>
            <a href="#" id="wmpotify-config-speed-fast">${u.CONF_SPEED_FAST}</a><br>
            <input type="range" id="wmpotify-config-speed" class="wmpotify-aero" min="0.5" max="2.0" step="0.1" value="1"><br>
            ${u.CONF_SPEED_CURRENT_LABEL}: <span id="wmpotify-config-speed-value">1.0</span>
        </section>
        <section class="wmpotify-config-tab-content" data-tab-title="${u.CONF_ABOUT_TITLE}">
            <div id="wmpotify-about-logo"></div>
            <p id="wmpotify-about-title">WMPotify</p><br>
            <p>${u.CONF_ABOUT_DESC}</p>
            <p>${u.CONF_ABOUT_VERSION}: 1.0 Alpha 1</p>
            <p>${u.CONF_ABOUT_AUTHOR} - <a href="https://www.ingan121.com/" target="_blank">www.ingan121.com</a></p>
            <a href="https://github.com/Ingan121/WMPotify" target="_blank">GitHub</a>
        </section>
    `,f.topborder=h.querySelector("#wmpotify-config-topborder"),f.fontSelector=h.querySelector("#wmpotify-config-font"),f.fontCustom=h.querySelector("#wmpotify-config-font option"),f.fontSelector.addEventListener("change",async()=>{if(f.fontSelector.value==="custom"){let o=await Be(u.CONF_GENERAL_CUSTOM_FONT_DLG_TITLE,u.CONF_GENERAL_CUSTOM_FONT_MSG,"",localStorage.wmpotifyFont||"Segoe UI");if(!o){f.fontSelector.value=localStorage.wmpotifyFont||"Segoe UI";return}f.fontCustom.textContent=o,localStorage.wmpotifyFont=o}else f.fontCustom.textContent=u.UI_CUSTOM,localStorage.wmpotifyFont=f.fontSelector.value;document.documentElement.style.setProperty("--ui-font",localStorage.wmpotifyFont)}),f.showLibX=h.querySelector("#wmpotify-config-show-libx"),f.showLibX.addEventListener("change",()=>{f.showLibX.checked?(localStorage.wmpotifyShowLibX=!0,delete document.body.dataset.hideLibx):(delete localStorage.wmpotifyShowLibX,document.body.dataset.hideLibx=!0,Spicetify.Platform.LocalStorageAPI.setItem("ylx-sidebar-state",1))}),h.querySelector("#wmpotify-config-close").addEventListener("click",Fe),h.querySelector("#wmpotify-config-apply").addEventListener("click",ct),!p.query()?.speedModSupported)h.querySelector("[data-wh-speedmod-required=true]").remove();else{f.speed=h.querySelector("#wmpotify-config-speed"),f.speedValue=h.querySelector("#wmpotify-config-speed-value"),f.speed.addEventListener("pointerup",At),h.querySelector("#wmpotify-config-speed-slow").addEventListener("click",ie.bind(null,.5)),h.querySelector("#wmpotify-config-speed-normal").addEventListener("click",ie.bind(null,1)),h.querySelector("#wmpotify-config-speed-fast").addEventListener("click",ie.bind(null,1.4));let o=p.query()?.playbackSpeed||1;f.speedValue.textContent=Number.isInteger(o)?o+".0":o,f.speedValue.addEventListener("click",async()=>{let a=await Be(u.CONF_SPEED_CUSTOM_DLG_TITLE,u.CONF_SPEED_CUSTOM_MSG,o.toString(),"1.0");a&&ie(a)})}R=h.querySelectorAll(".wmpotify-config-tab-content"),f.title=h.querySelector("#wmpotify-config-title"),f.hue=h.querySelector("#wmpotify-config-hue"),f.sat=h.querySelector("#wmpotify-config-sat"),f.tintPb=h.querySelector("#wmpotify-config-tint-playerbar"),f.hue.addEventListener("input",ke),f.sat.addEventListener("input",ke),f.tintPb.addEventListener("change",ke),h.querySelector("#wmpotify-config-color-reset").addEventListener("click",Nt),h.querySelector("#wmpotify-config-prev").addEventListener("click",lt),h.querySelector("#wmpotify-config-next").addEventListener("click",st),rt.each(o=>{let a=document.createElement("option");a.textContent=o.name,a.value=o.name,o.name===(localStorage.wmpotifyFont||"Segoe UI")&&(a.selected=!0),o.name==="Segoe UI"?f.fontSelector.insertBefore(a,f.fontSelector.firstChild):f.fontSelector.insertBefore(a,f.fontCustom)}),localStorage.wmpotifyStyle&&(h.querySelector("#wmpotify-config-style").value=localStorage.wmpotifyStyle);let t=h.querySelector("#wmpotify-config-title-style");navigator.userAgent.includes("Windows")||t.querySelector("option[value=keepmenu]").remove(),navigator.userAgent.includes("Linux")&&t.querySelector("option[value=spotify]").remove(),localStorage.wmpotifyTitleStyle&&(t.value=localStorage.wmpotifyTitleStyle),localStorage.wmpotifyShowLibX&&(h.querySelector("#wmpotify-config-show-libx").checked=!0);let i=0,n=!1;f.topborder.addEventListener("pointerdown",function(){n=!0,i=h.getBoundingClientRect().bottom,document.body.style.cursor="ns-resize"},!0),document.addEventListener("pointerup",function(){n=!1,document.body.style.cursor="",localStorage.wmpotifyConfigHeight=h.style.height},!0),document.addEventListener("pointermove",function(o){n&&(h.style.height=i-o.clientY+"px")},!0),e.appendChild(h)}function Ot(){if(R){if(document.body.dataset.wmpotifyLibPageOpen)Spicetify.Config.custom_apps.includes("wmpvis")?Spicetify.Platform.History.push({pathname:"/wmpvis"}):document.querySelector("#wmpotify-tabs-container button[data-identifier='home']")?.click();else if(h.style.display==="block"){Fe();return}if(h.style.display="block",localStorage.wmpotifyTintColor){let[e,t,i]=localStorage.wmpotifyTintColor.split(",");f.hue.value=parseInt(e)+180,f.sat.value=parseInt(t)*121/100,i&&(f.tintPb.checked=!0)}}}function Fe(){h.style.display="none"}function Re(e){if(R){for(let t=0;t<R.length;t++){let i=R[t];i.style.display=t===e?"block":"none"}qe=e,f.title.textContent=R[e].dataset.tabTitle}}function lt(){Re((qe-1+R.length)%R.length)}function st(){Re((qe+1)%R.length)}function ke(){let e=f.hue.value-180,t=f.sat.value*100/121;ne(e,t,f.tintPb.checked),localStorage.wmpotifyTintColor=e+","+t+","+(f.tintPb.checked?"1":"")}function Nt(){f.hue.value=180,f.sat.value=121,ne(),delete localStorage.wmpotifyTintColor}function At(){f.speedValue.textContent=Number.isInteger(parseFloat(f.speed.value))?f.speed.value+".0":f.speed.value,be&&clearTimeout(be),be=setTimeout(()=>{ie(f.speed.value),be=null},500)}function ie(e){if(Spicetify.Platform.ConnectAPI.state.connectionStatus==="connected"){Spicetify.showNotification(u.CONF_SPEED_NO_CONNECT_MSG);return}e=parseFloat(e);let t=p.query().playbackSpeed||1;if(e!==t){f.speed.value=e,f.speedValue.textContent=Number.isInteger(e)?e+".0":e;try{p.setPlaybackSpeed(e)}catch(i){Spicetify.showNotification(i.message)}}}function ct(){let e=h.querySelector("#wmpotify-config-style").value,t=h.querySelector("#wmpotify-config-title-style").value,i=f.showLibX.checked;e!=="auto"?localStorage.wmpotifyStyle=e:delete localStorage.wmpotifyStyle,t!=="auto"?localStorage.wmpotifyTitleStyle=t:delete localStorage.wmpotifyTitleStyle,i?localStorage.wmpotifyShowLibX=!0:delete localStorage.wmpotifyShowLibX,location.reload()}var Bt={init:xt,open:Ot,close:Fe,openTab:Re,prevTab:lt,nextTab:st,apply:ct,isOpen:()=>h.style.display==="block"},oe=Bt;var ut=null;function kt(){if(p.available())if(window.innerWidth<360&&window.innerHeight<262){let e=localStorage.wmpotifyPreMiniModeSize?.split(",");e&&e.length===2&&window.resizeTo(parseInt(e[0]),parseInt(e[1]))}else document.fullscreenElement&&document.exitFullscreen(),localStorage.wmpotifyPreMiniModeSize=[window.innerWidth,window.innerHeight],p.resizeTo(358,60)}function qt(){if(document.fullscreenElement)document.exitFullscreen(),ge();else{if(Spicetify.Config.custom_apps.includes("wmpvis"))Spicetify.Platform.History.push({pathname:"/wmpvis"});else{let e=document.querySelector('.main-nowPlayingBar-extraControls button[data-testid="lyrics-button"]');e&&e.click()}oe.close(),document.documentElement.requestFullscreen(),document.body.classList.add("wmpotify-playerbar-visible"),setTimeout(()=>{document.addEventListener("pointermove",We),We()},200)}document.addEventListener("fullscreenchange",()=>{document.fullscreenElement||ge()},{once:!0}),document.addEventListener("resize",()=>{ge()},{once:!0})}function We(){if(!document.fullscreenElement){ge();return}document.body.classList.add("wmpotify-playerbar-visible"),clearTimeout(ut),ut=setTimeout(()=>{document.body.classList.remove("wmpotify-playerbar-visible")},2e3)}function ge(){document.body.classList.remove("wmpotify-playerbar-visible"),document.removeEventListener("pointermove",We)}var Ft={toggleMiniMode:kt,toggleFullscreen:qt},Ue=Ft;var De,re,He,we,G,I,dt=null,ae=!1;function yt(){let e=document.querySelector(".main-nowPlayingBar-nowPlayingBar");De=document.querySelector(".player-controls__buttons button[data-testid='control-button-playpause']"),Spicetify.Player.addEventListener("onplaypause",le),new MutationObserver(le).observe(De,{attributes:!0,attributeFilter:["aria-label"]}),mt(),new MutationObserver(mt).observe(document.querySelector(".main-nowPlayingBar-left"),{childList:!0});let t=document.querySelector(".player-controls__left"),i=document.querySelector('.player-controls__buttons button[data-testid="control-button-skip-forward"]'),n=document.querySelector('.player-controls__buttons button[data-testid="control-button-repeat"]');t.appendChild(n);let o=p.query();o?.speedModSupported&&o.immediateSpeedChange&&(i.addEventListener("pointerdown",()=>{i.disabled||Spicetify.Platform.ConnectAPI.state.connectionStatus==="connected"||(dt=setTimeout(()=>{i.dataset.fastForward=!0,p.setPlaybackSpeed(5),Spicetify.Player.play()},1e3))}),i.addEventListener("click",g=>{clearTimeout(dt),i.dataset.fastForward&&(delete i.dataset.fastForward,p.setPlaybackSpeed(1),g.preventDefault(),g.stopPropagation())}));let a=document.createElement("button");a.setAttribute("aria-label","Stop"),a.id="wmpotify-stop-button",a.addEventListener("click",()=>{Spicetify.Platform.PlayerAPI.clearQueue(),Spicetify.Player.playUri("")}),t.appendChild(a);let r=document.querySelector(".player-controls__right"),l=document.querySelector(".volume-bar");re=l.querySelector(".volume-bar__icon-button"),He=l.querySelector(".progress-bar"),ft(),new MutationObserver(ft).observe(He,{attributes:!0,attributeFilter:["style"]}),r.appendChild(l);let s=document.querySelector(".volume-bar__slider-container"),c=s.children[0];s.addEventListener("click",()=>{if(window.innerWidth<750){c.dataset.visible=!0;let g=setTimeout(()=>{delete c.dataset.visible},5e3);c.addEventListener("pointerup",()=>{clearTimeout(g),setTimeout(()=>{delete c.dataset.visible},100)},{once:!0})}}),we=document.querySelectorAll(".playback-bar [class*=encore-text]");let d=document.createElement("div");d.classList.add("wmpotify-time-text-container"),I=document.createElement("span"),I.classList.add("wmpotify-time-text"),G=parseInt(localStorage.wmpotifyTimeTextMode||0),pt(),I.dataset.mode=G,I.addEventListener("click",()=>{G=(G+1)%3,I.dataset.mode=G,localStorage.wmpotifyTimeTextMode=G}),d.appendChild(I),e.insertAdjacentElement("afterbegin",d),Spicetify.Player.addEventListener("onprogress",pt);let m=document.querySelector("#wmpotify-title-bar"),S=document.querySelector("#wmpotify-title-buttons");if(m&&(x(),window.addEventListener("resize",x)),o){let g=document.querySelector('.main-nowPlayingBar-extraControls button[data-testid="pip-toggle-button"]');g&&(g.style.display="none");let b=new Spicetify.Playbar.Button(u.PB_BTN_MINI_MODE,"",()=>Ue.toggleMiniMode());b.element.id="wmpotify-mini-mode-button"}let L=new Spicetify.Playbar.Button(u.PB_BTN_FULLSCREEN,"",()=>Ue.toggleFullscreen());L.element.id="wmpotify-fullscreen-button";function x(){window.innerWidth<800?m.contains(I)||(S?m.insertBefore(I,S):m.appendChild(I)):e.contains(I)||d.appendChild(I)}}async function mt(){le();let e=!!document.querySelector("#wmpotify-title-bar"),t=p.available(),i=await Spicetify.AppTitle.get(),n=document.querySelector("#wmpotify-title-text"),o=document.querySelector(".main-nowPlayingWidget-trackInfo");if(!o||document.querySelector(".wmpotify-track-info"))return;let a=document.createElement("p");a.classList.add("wmpotify-track-info"),a.textContent=document.querySelector(".main-trackInfo-name")?.textContent||"",o.appendChild(a),window.innerWidth<420&&window.innerHeight<(e?92:62)&&(e?n.textContent=a.textContent:t&&p.setTitle(a.textContent),ae=!0);let r=1;setInterval(()=>{if(!Spicetify.Player.isPlaying())return;let l=Spicetify.Player.data?.item.metadata;l&&(r===0?a.textContent=l.title:r===1?a.textContent=l.artist_name:r===2&&(a.textContent=l.album_title),r=(r+1)%3,window.innerWidth<420&&window.innerHeight<(e?92:62)?(e?n.textContent=a.textContent:t&&(p.lockTitle(!0),p.setTitle(a.textContent)),ae=!0):ae&&(ae=!1,e&&(n.textContent=i),p.lockTitle(!1),Spicetify.Player.isPlaying()?p.setTitle(l.artist_name+" - "+l.title):p.setTitle(i)))},3e3),Spicetify.Player.addEventListener("songchange",()=>{r=0,a.textContent=Spicetify.Player.data?.item.metadata.title,window.innerWidth<420&&window.innerHeight<(e?92:62)&&(e?n.textContent=a.textContent:t&&p.setTitle(a.textContent),ae=!0)})}function le(){De?.classList.toggle("playing",Spicetify.Player.isPlaying());let e=document.querySelector(`.playlist-playlist-playlist[data-test-uri="${Spicetify.Player.data?.context?.uri}"]`);e&&e.classList.toggle("playing",Spicetify.Player.isPlaying())}function ft(){let e=getComputedStyle(He).getPropertyValue("--progress-bar-transform").replace("%","")/100;e===0?re.dataset.vol="muted":e<=.3?re.dataset.vol="low":e<=.6?re.dataset.vol="mid":re.dataset.vol="high"}function pt(){switch(G){case 0:{let e=Spicetify.Player.data?.item?.metadata?.duration-Spicetify.Player.getProgress();I.textContent=Se(e,!0)}break;case 1:{let e=we[0].textContent;(e.length===4||e.length===7)&&(e="0"+e),I.textContent=e}break;case 2:{let e=we[0].textContent;(e.length===4||e.length===7)&&(e="0"+e);let t=we[1].textContent;(t.length===4||t.length===7)&&(t="0"+t),I.textContent=`${e} / ${t}`}break}}var se=new MutationObserver(ce),Rt=new ResizeObserver(ce.bind(null,!0)),Wt={init(){se.observe(document.documentElement,{attributes:!0,attributeFilter:["style"]}),Rt.observe(document.querySelector(".Root__right-sidebar")),window.addEventListener("resize",ce),window.addEventListener("load",ce)},updateSidebarWidth:ce};function ce(e){if(!Spicetify.Platform.History.location.pathname.startsWith("/wmpotify-standalone-libx")&&!e){let n=getComputedStyle(document.documentElement).getPropertyValue("--right-sidebar-width");n&&(se.disconnect(),document.documentElement.style.setProperty("--panel-width",n),se.observe(document.documentElement,{attributes:!0,attributeFilter:["style"]}));return}se.disconnect();let t=document.querySelector(".Root__right-sidebar aside");document.documentElement.style.setProperty("--panel-width",t?t.offsetWidth:8),getComputedStyle(document.documentElement).getPropertyValue("--right-sidebar-width")&&document.documentElement.style.setProperty("--right-sidebar-width",t?t.offsetWidth:8),se.observe(document.documentElement,{attributes:!0,attributeFilter:["style"]})}var Ee=Wt;var Ge;function Ce(){console.log("WMPotify: Trying to initialize queue panel");let e=document.querySelector(".Root__right-sidebar > div > div > div:has(aside)");if(e&&!Ge&&(Ge=new MutationObserver(Ce),Ge.observe(e,{childList:!0})),!document.querySelector("#queue-panel")||document.querySelector("#wmpotify-queue-toolbar")||document.querySelectorAll('div[data-encore-id="tabPanel"]').length>2)return;let t=document.querySelector("#Desktop_PanelContainer_Id");t.classList.add("spotify-queue-panel");let i=document.querySelector("#Desktop_PanelContainer_Id > div > div:first-child > div:first-child"),n=document.querySelector("#Desktop_PanelContainer_Id > div > div:nth-child(2)");n.id="spotify-queue-panel-content";let o=document.createElement("div");o.id="wmpotify-queue-toolbar";let a=document.createElement("button");a.id="wmpotify-queue-playlist-button",a.classList.add("wmpotify-toolbar-button"),a.addEventListener("click",()=>{let g=Spicetify.Player.data?.context?.uri;g&&window.open(g)}),a.textContent=document.querySelector('#queue-panel div[data-flip-id*="section-header-"] a')?.textContent||u.QUEUE_CURRENT_PLAYLIST_PLACEHOLDER,a.innerHTML+='<span class="expandMark">\u23F7</span>',o.appendChild(a);let r=document.createElement("button");r.id="wmpotify-queue-clear-button",r.classList.add("wmpotify-toolbar-button"),r.addEventListener("click",()=>{Spicetify.Platform.PlayerAPI.clearQueue(),Spicetify.Player.playUri("")}),o.appendChild(r),n.insertAdjacentElement("afterbegin",o);let l=getComputedStyle(document.documentElement).getPropertyValue("--album-art-placeholder").trim().slice(5,-2),s=document.createElement("div");s.id="wmpotify-queue-npv";let c=document.createElement("img");c.id="wmpotify-queue-album-art",c.src=document.querySelector(".main-nowPlayingWidget-coverArt .cover-art img")?.src||l,s.appendChild(c);let d=document.createElement("div");d.id="wmpotify-queue-song-title",d.textContent=document.querySelector(".main-trackInfo-name")?.textContent||"No items",s.appendChild(d),i.insertAdjacentElement("afterbegin",s),ht(),new MutationObserver(ht).observe(document.querySelector("#queue-panel"),{childList:!0});let m=document.querySelectorAll('#Desktop_PanelContainer_Id div[role="tablist"] button'),S=[],L;for(let g of m)S.push({text:g.textContent,click:function(){for(let b of L.menuItems)b.classList.remove("activeStyle");this.classList.add("activeStyle"),g.click()}});S[0].classList=["activeStyle"],document.querySelector("#wmpotifyQueueTabMenuBg")?.remove(),L=ye("wmpotifyQueueTab",S);let x=new K(["wmpotifyQueueTab"]);t.addEventListener("contextmenu",g=>{g.preventDefault(),x.openMenu("wmpotifyQueueTab",{left:g.clientX+"px",top:g.clientY+"px"})}),Spicetify.Player.addEventListener("songchange",()=>{a.textContent=Spicetify.Player.data?.context?.metadata?.context_description||"Now Playing",a.innerHTML+='<span class="expandMark">\u23F7</span>',c.src=Spicetify.Player.data?.item?.album?.images?.[0]?.url?.replace("spotify:image:","https://i.scdn.co/image/")||l,d.textContent=Spicetify.Player.data?.item?.name||"No items"})}function ht(){let e=document.querySelectorAll("#queue-panel ul")[1];e&&(St(),new MutationObserver(St).observe(e,{childList:!0}))}function St(){if(!document.querySelector("#queue-panel")||!Spicetify.Queue)return;let e=document.querySelectorAll("#queue-panel li .HeaderArea");for(let t=0;t<e.length;t++){let i=e[t];if(i.querySelector(".wmpotify-queue-duration"))continue;let n=t===0?Spicetify.Queue.track?.contextTrack?.metadata?.duration:Spicetify.Queue.nextTracks?.[t-1]?.contextTrack?.metadata?.duration;if(!n)continue;let o=document.createElement("span");o.classList.add("wmpotify-queue-duration"),o.textContent=Se(n),i.appendChild(o)}}var Ut={getItem(e){let t=Spicetify._platform?.initialUser?.username,i=localStorage.getItem(t+":"+e);return isNaN(i)?i:parseFloat(i)},setItem(e,t){let i=Spicetify._platform?.initialUser?.username;localStorage.setItem(i+":"+e,t)},removeItem(e){let t=Spicetify._platform?.initialUser?.username;localStorage.removeItem(t+":"+e)}},W=Ut;var v,N=[],P={},k=new MutationObserver(Ye),bt=new MutationObserver(Ht),A=!1,Xe=!1,ze=[],Ve=[],Dt={async init(){if(document.querySelector("#wmpotify-libx-sidebar"))return!1;Object.keys(Spicetify.Platform.Translations).filter(n=>n.startsWith("shared.library.filter.")).forEach(n=>{let o=Spicetify.Platform.Translations[n];P[n.split(".").pop()]={loc_id:n,value:o}}),N.length===0&&(N.push({identifier:"playlist",localized:P.playlist.value,elem:null}),N.push({identifier:"album",localized:P.album.value,elem:null}),N.push({identifier:"artist",localized:P.artist.value,elem:null}));let t=document.createElement("div");t.id="wmpotify-libx-header",document.querySelector(".main-yourLibraryX-libraryContainer").insertAdjacentElement("afterbegin",t);let i=document.createElement("div");return i.id="wmpotify-libx-sidebar",document.querySelector(".main-yourLibraryX-libraryItemContainer").insertAdjacentElement("afterbegin",i),await zt(),v=document.querySelector('.main-yourLibraryX-filterArea .search-searchCategory-categoryGrid [role="presentation"]'),Ye(),k.observe(v,{childList:!0}),bt.observe(document.querySelector(".main-yourLibraryX-filterArea"),{childList:!0}),!0},uninit(){document.querySelector("#wmpotify-libx-header")?.remove(),document.querySelector("#wmpotify-libx-sidebar")?.remove(),k.disconnect(),bt.disconnect()},go(e){e||(e=Spicetify.Platform.History.location.pathname.split("/").slice(2)),e[0]!==void 0&&Gt(e)}};function $e(){let e=document.querySelector("#wmpotify-libx-header");e.innerHTML="";let t=document.createElement("div");t.classList.add("wmpotify-libx-header-root-icon"),t.classList.add("wmpotify-toolbar-button"),e.appendChild(t);let i=document.createElement("button");i.classList.add("wmpotify-libx-header-root-text"),i.classList.add("wmpotify-toolbar-button"),i.textContent=u.LIBX_HEADER_ROOT,i.addEventListener("click",V),e.appendChild(i);let n=Ke();if(n.forEach((o,a)=>{let r=document.createElement("button");r.classList.add("wmpotify-libx-header-category-text"),r.classList.add("wmpotify-toolbar-button"),r.textContent=o,r.addEventListener("click",async()=>{if(!r.nextElementSibling)return;A&&(ue(),await de()),k.disconnect();let l=N.find(s=>s.localized===o);if(a===0)V(),await U();else{if(!l)return;let s=N.find(c=>c.localized===n[a-1]);(!gt(s)||!document.contains(l.elem))&&(J()||(V(),await U()),s.elem.click(),await U())}z(l),l.elem.click(),k.observe(v,{childList:!0})}),e.appendChild(r)}),A){let o=document.querySelector(".main-yourLibraryX-collapseButton > div").textContent,a=document.createElement("button");a.classList.add("wmpotify-libx-header-category-text"),a.classList.add("wmpotify-toolbar-button"),a.textContent=o,e.appendChild(a)}}function Ye(){A=document.querySelector(".main-yourLibraryX-collapseButton").childElementCount>1;let e=Ke(!0);if(A){let n=Spicetify.Platform.LocalStorageAPI.getItem("opened-folder-uri");e.push(n)}if(!Xe){let n="/wmpotify-standalone-libx/"+e.join("/");Spicetify.Platform.History.location.pathname==="/wmpotify-standalone-libx"?Spicetify.Platform.History.location.pathname=n:Spicetify.Platform.History.location.pathname!==n&&Spicetify.Platform.History.push({pathname:"/wmpotify-standalone-libx/"+e.join("/")})}if(A){$e();return}let t=!v.querySelector('button[class*="ChipClear"]:first-child'),i=Array.from(v.querySelectorAll("button"));if(t)i.forEach((n,o)=>{let a={};a.localized=n.textContent,a.identifier=Object.keys(P).find(r=>P[r].value===a.localized),a.elem=n,N.some(r=>r.localized===a.localized)||N.push(a)});else{i.shift();let n=i[0].textContent,o=N.find(a=>a.localized===n);if(!o){let a={};a.localized=n,a.identifier=Object.keys(P).find(r=>P[r].value===a.localized),a.elem=i[0],N.push(a),o=a}o.children||(o.children=[]),i.shift(),i.forEach((a,r)=>{let l={};l.localized=a.textContent,l.identifier=Object.keys(P).find(s=>P[s].value===l.localized),l.elem=a,o.children.some(s=>s.localized===l.localized)||o.children.push(l)})}$e(),wt()}function Ht(){k.disconnect(),v=document.querySelector('.main-yourLibraryX-filterArea .search-searchCategory-categoryGrid [role="presentation"]'),Ye(),k.observe(v,{childList:!0})}function z(e){if(!document.contains(e.elem)){for(let t of v.querySelectorAll("button"))if(t.textContent===e.localized){e.elem=t;break}}}function J(){return!v.querySelector('button[class*="ChipClear"]:first-child')}function gt(e){return J()?!1:Array.from(v.querySelectorAll("button"))[1].textContent===e.localized}async function V(){A&&(ue(),await de()),v.querySelector('button[class*="ChipClear"]:first-child')?.click()}function ue(){Xe=!0,document.querySelectorAll(".main-yourLibraryX-collapseButton button")?.[1]?.click()}function Ke(e=!1){let t=[];if(A=document.querySelector(".main-yourLibraryX-collapseButton").childElementCount>1,A)return e?Ve:ze;if(J())return ze=[],Ve=[],t;{let n=Array.from(v.querySelectorAll("button")).slice(1)[0].textContent;e&&(n=Object.keys(P).find(a=>P[a].value===n)),t.push(n);let o=v.querySelector('button[class*="secondary-selected"]');o&&(e?t.push(Object.keys(P).find(a=>P[a].value===o.textContent)):t.push(o.textContent)),e?Ve=structuredClone(t):ze=structuredClone(t)}return t}async function Gt(e){if(A&&(ue(),await de()),k.disconnect(),!J()){if(V(),e.length===0)return;await U()}for(let t=0;t<e.length;t++)if(e[t].startsWith("spotify:user:"))await Vt(),document.querySelector('.main-yourLibraryX-libraryRootlist .main-rootlist-wrapper div[role="button"][aria-labelledby*="listrow-title-'+e[t]+'"]').click();else if(t===0){let i=N.find(n=>n.identifier===e[t]);if(!i)return;z(i),i.elem.click(),await U()}else{let i=N.find(o=>o.identifier===e[t-1]);if(!i)return;let n=i.children.find(o=>o.identifier===e[t]);if(!n)return;z(n),n.elem.click(),await U()}$e(),wt(),k.observe(v,{childList:!0})}function wt(){let e=document.querySelector("#wmpotify-libx-sidebar");e.innerHTML="";let t=document.createElement("div");t.classList.add("wmpotify-libx-sidebar-item-container");let i=document.createElement("button");i.classList.add("wmpotify-libx-sidebar-item"),i.id="wmpotify-libx-sidebar-root",i.textContent=u.LIBX_SIDEBAR_ROOT,i.addEventListener("click",V);let n=document.createElement("div");n.classList.add("wmpotify-libx-sidebar-chevron"),n.addEventListener("click",()=>{e.classList.toggle("rootCollapsed")}),t.appendChild(n),t.appendChild(i),e.appendChild(t),N.forEach(a=>{let r=document.createElement("div");r.classList.add("wmpotify-libx-sidebar-item-container");let l=document.createElement("button");if(l.classList.add("wmpotify-libx-sidebar-item"),l.textContent=a.localized,l.dataset.identifier=a.identifier,l.addEventListener("click",async()=>{l.classList.contains("active")&&!A||(A&&(ue(),await de()),k.disconnect(),J()||(V(),await U()),z(a),a.elem.click(),k.observe(v,{childList:!0}))}),r.appendChild(l),e.appendChild(r),a.children&&a.children.length>0){let s=document.createElement("div");s.classList.add("wmpotify-libx-sidebar-chevron"),s.addEventListener("click",()=>{r.classList.toggle("collapsed")}),r.insertBefore(s,l);let c=document.createElement("div");c.classList.add("wmpotify-libx-sidebar-downlevel"),a.children.forEach(d=>{let m=document.createElement("button");m.classList.add("wmpotify-libx-sidebar-item"),m.textContent=d.localized,m.dataset.identifier=d.identifier,m.addEventListener("click",async()=>{m.classList.contains("active")&&!A||(A&&(ue(),await de()),k.disconnect(),z(d),(!gt(a)||!document.contains(d.elem))&&(J()||(V(),await U()),z(a),a.elem.click(),await U()),z(d),d.elem.click(),k.observe(v,{childList:!0}))}),c.appendChild(m)}),e.appendChild(c)}});let o=Ke();if(o.length>0){let a=o.pop();Array.from(e.querySelectorAll(".wmpotify-libx-sidebar-item")).find(l=>l.textContent===a).classList.add("active")}else i.classList.add("active")}function zt(){if(!document.querySelector('.main-yourLibraryX-filterArea .search-searchCategory-categoryGrid [role="presentation"]'))return new Promise(e=>{let t=new MutationObserver(()=>{document.querySelector('.main-yourLibraryX-filterArea .search-searchCategory-categoryGrid [role="presentation"]')&&(e(),t.disconnect())});t.observe(document.querySelector(".main-yourLibraryX-libraryItemContainer"),{childList:!0,subtree:!0})})}function U(){return new Promise(e=>{let t=new MutationObserver(()=>{v.querySelector("button")&&(e(),t.disconnect())});t.observe(v,{childList:!0})})}function de(){return new Promise(e=>{let t=new MutationObserver(()=>{Xe=!1,e(),t.disconnect()});t.observe(document.querySelector(".main-yourLibraryX-filterArea"),{childList:!0})})}function Vt(){if(!document.querySelector('.main-yourLibraryX-libraryRootlist .main-rootlist-wrapper [role="presentation"]:not([class])'))return new Promise(e=>{let t=new MutationObserver(()=>{document.querySelector('.main-yourLibraryX-libraryRootlist .main-rootlist-wrapper [role="presentation"]:not([class])')&&(e(),t.disconnect())});t.observe(document.querySelector(".main-yourLibraryX-libraryRootlist"),{childList:!0,subtree:!0})})}var ve=Dt;async function Le(e){let t=document.querySelector('section[data-testid="artist-page"]');if(!t){e&&(await Te.waitForPageRender(),Le(!1));return}if(await $t(t),t.querySelector(".artist-artistDiscography-cardGrid"))return;let i=t.querySelector(".artist-artistDiscography-topBar a").textContent,n=t.dataset.testUri,o=t.querySelectorAll(".artist-artistDiscography-headerContainer");for(let l of o){if(l.querySelector(".artist-artistDiscography-headerTitle + div a"))continue;let s=l.querySelector(".main-entityHeader-image");if(!s)continue;s.addEventListener("dblclick",()=>{l.querySelector(".artist-artistDiscography-headerButtons div button").click()}),s.addEventListener("contextmenu",async d=>{l.querySelector(".artist-artistDiscography-headerButtons > button:last-child").click(),d.preventDefault(),d.stopPropagation(),await Xt();let m=document.querySelector("[data-tippy-root]");m.dataset.wmpotifyForceTransform=!0,m.style.setProperty("--tippy-force-transform",`translate(${d.clientX}px, ${d.clientY}px)`)});let c=document.createElement("a");c.href=n,c.textContent=i,l.querySelector(".artist-artistDiscography-headerTitle + div").appendChild(c)}let a=t.querySelectorAll(".artist-artistDiscography-tracklist");for(let l of a){if(l.querySelector(".wmpotify-discography-trackList-header"))continue;let s=l.querySelector('[role="grid"]');if(!s)continue;let c=s.getAttribute("aria-label"),d=document.createElement("div");d.className="wmpotify-discography-trackList-header",d.textContent=c,l.insertAdjacentElement("afterbegin",d)}let r=new MutationObserver(()=>{Le(!1),r.disconnect()});r.observe(t.querySelector('[data-testid="infinite-scroll-list"]'),{childList:!0})}function $t(e){if(!e.querySelector(".artist-artistDiscography-tracklist"))return new Promise(t=>{let i=new MutationObserver(()=>{e.querySelector(".artist-artistDiscography-tracklist")&&(i.disconnect(),t())});i.observe(e,{childList:!0,subtree:!0})})}function Xt(){return new Promise(e=>{let t=new MutationObserver(()=>{document.querySelector("[data-tippy-root]")&&(t.disconnect(),e())});t.observe(document.body,{childList:!0})})}var je=0,_e={waitForPageRender(){return new Promise(e=>{let t=new MutationObserver(()=>{document.querySelector(".main-loadingPage-container")||(e(),t.disconnect())});t.observe(document.querySelector(".main-view-container__scroll-node-child main"),{childList:!0})})},async handleLocChange(e){if(e?.pathname&&!(je&&Date.now()-je<2e3)){if(Ee.updateSidebarWidth(),e.pathname.startsWith("/wmpotify-standalone-libx")){document.body.dataset.wmpotifyLibPageOpen=!0;let t=W.getItem("ylx-sidebar-state"),i=W.getItem("ylx-expanded-state-nav-bar-width");Spicetify.Platform.LocalStorageAPI.setItem("ylx-sidebar-state",2),Spicetify.Platform.LocalStorageAPI.setItem("ylx-expanded-state-nav-bar-width",0),W.setItem("ylx-sidebar-state",t),W.setItem("ylx-expanded-state-nav-bar-width",i),await ve.init()||Spicetify.Platform.History.action==="POP"&&ve.go()}else if(document.body.dataset.wmpotifyLibPageOpen)if(delete document.body.dataset.wmpotifyLibPageOpen,ve.uninit(),localStorage.wmpotifyShowLibX){let t=W.getItem("ylx-sidebar-state");W.removeItem("ylx-sidebar-state");let i=W.getItem("ylx-expanded-state-nav-bar-width");W.removeItem("ylx-expanded-state-nav-bar-width"),Spicetify.Platform.LocalStorageAPI.setItem("ylx-sidebar-state",parseInt(t)),Spicetify.Platform.LocalStorageAPI.setItem("ylx-expanded-state-nav-bar-width",parseInt(i))}else Spicetify.Platform.LocalStorageAPI.setItem("ylx-sidebar-state",1);e.pathname.match("/artist/.*/discography/.*")?Le(!0):e.pathname.startsWith("/playlist/")&&(document.querySelector(".playlist-playlist-playlist")||await _e.waitForPageRender(),le())}},init(){_e.handleLocChange(Spicetify.Platform.History.location),je=Date.now(),Spicetify.Platform.History.listen(e=>_e.handleLocChange(e))}},Te=_e;var Et=[".Root__globalNav",".main-globalNav-historyButtons",".main-globalNav-searchSection",".main-globalNav-searchContainer > button",".main-globalNav-searchContainer div form button",'.main-globalNav-searchContainer div form input[type="search"]',".main-topBar-topbarContentRight > .main-actionButtons > button",".main-topBar-topbarContentRight > button:last-child",".Root__main-view",".main-view-container__scroll-node-child main",".main-nowPlayingBar-nowPlayingBar",".player-controls__left",'.player-controls__buttons button[data-testid="control-button-repeat"]','.player-controls__buttons button[data-testid="control-button-playpause"]',".player-controls__right",".playback-bar [class*=encore-text]",".volume-bar",".volume-bar__icon-button",".volume-bar .progress-bar",".main-nowPlayingBar-left"],Z="xp",B="spotify";function Yt(){localStorage.wmpotifyShowLibX||(document.body.dataset.hideLibx=!0),p.init();let e=p.query();switch(localStorage.wmpotifyTitleStyle&&["native","custom","spotify","keepmenu"].includes(localStorage.wmpotifyTitleStyle)?B=localStorage.wmpotifyTitleStyle:(console.log("WMPotify EarlyInit:",window.SpotEx,e),window.outerHeight-window.innerHeight>0||e?.options?.showframe||navigator.userAgent.includes("Linux")?B="native":(window.SpotEx||e)&&(e?.options?.showmenu&&!e.options.showcontrols?B="keepmenu":B="custom")),B==="keepmenu"&&!navigator.userAgent.includes("Windows")&&(B="spotify"),B==="spotify"&&navigator.userAgent.includes("Linux")&&(B="native"),document.documentElement.dataset.wmpotifyTitleStyle=B,e&&!localStorage.wmpotifyStyle&&B==="native"&&e.isThemingEnabled&&(e.options.transparentrendering&&e.isDwmEnabled?Z="aero":e.isDwmEnabled||(Z="basic")),localStorage.wmpotifyStyle&&["xp","aero","basic"].includes(localStorage.wmpotifyStyle)&&(Z=localStorage.wmpotifyStyle),p.setMinSize(358,B==="native"?60:90),p.setBackdrop("mica"),Z){case"xp":p.extendFrame(0,0,0,0);break;case"aero":p.extendFrame(0,0,0,60);break;case"basic":p.extendFrame(0,0,0,0),document.hasFocus()?document.body.style.backgroundColor="#b9d1ea":document.body.style.backgroundColor="#d7e4f2",window.addEventListener("focus",()=>{document.body.style.backgroundColor="#b9d1ea"}),window.addEventListener("blur",()=>{document.body.style.backgroundColor="#d7e4f2"});break}document.documentElement.dataset.wmpotifyStyle=Z,window.addEventListener("resize",()=>{Z==="aero"&&(window.innerHeight<62?p.extendFrame(-1,-1,-1,-1):p.extendFrame(0,0,0,60)),p.setMinSize(358,B==="native"?60:90)}),localStorage.wmpotifyFont&&document.documentElement.style.setProperty("--ui-font",localStorage.wmpotifyFont)}Yt();async function Kt(){if(await nt(B),localStorage.wmpotifyShowLibX||Spicetify.Platform.LocalStorageAPI.setItem("ylx-sidebar-state",1),localStorage.wmpotifyTintColor){let[e,t,i]=localStorage.wmpotifyTintColor.split(",");ne(e,t,i)}Y.init(),Te.init(),Ee.init(),oe.init(),new Spicetify.Menu.Item(u.MENU_CONF,!1,oe.open).register(),ot(),yt(),Ce(),new MutationObserver(Ce).observe(document.querySelector(".XOawmCGZcQx4cesyNfVO")||document.querySelector(".Root__right-sidebar > div > div[class]:first-child")||document.querySelector(".Root__right-sidebar div[class]"),{childList:!0})}function jt(){return window.Spicetify?.CosmosAsync&&window.Spicetify.Platform?.PlayerAPI&&window.Spicetify.AppTitle&&window.Spicetify.Player?.origin?._state&&window.Spicetify.Menu&&window.Spicetify.Platform.History?.listen&&window.Spicetify.Platform.LocalStorageAPI&&window.Spicetify.Platform.Translations&&Et.every(e=>document.querySelector(e))}window.addEventListener("load",()=>{let e=0,t=setInterval(async()=>{if(jt()){clearInterval(t);try{await Kt()}catch(i){(window.Spicetify?.showNotification||window.alert)("[WMPotify] "+u.MAIN_MSG_ERROR_INIT),console.error("WMPotify: Error during init:",i)}console.log("WMPotify: Theme loaded")}else if(e++>80){(window.Spicetify?.showNotification||window.alert)("[WMPotify] "+u.MAIN_MSG_ERROR_LOAD_FAIL),clearInterval(t);let i=[];for(let n of Et)document.querySelector(n)||i.push(n);console.log("WMPotify: Missing elements:",i)}},100)});document.addEventListener("scroll",function(){document.documentElement.scrollTo(0,0)});})();
